(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9267],{63:(e,t,r)=>{"use strict";var n=r(7260);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},739:(e,t,r)=>{Promise.resolve().then(r.bind(r,1736))},1736:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(5155),l=r(2115),a=r(2619),o=r.n(a),i=r(63),s=r(3596),u=r(9678);let d=null;function c(){var e;let t=(0,i.useSearchParams)(),r=(0,i.useRouter)(),a=null!=(e=t.get("orderId"))?e:"",[c,m]=(0,l.useState)(null),[p,h]=(0,l.useState)(!0),f=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!1;return async function(){try{var t,n,l,o;if(!a){m("orderId manquant."),h(!1);return}let i="pk_test_51T4GeDICe2MXmgkNYUcWJ5A1bNEZYb85ygFJRw21oKJqKWQClQni7nnMNt9R0pgqknOteIhZZS5KLYDZjYqFW7pq00Q9AD5qyR";if(!i){m("Configuration Stripe incompl\xe8te."),h(!1);return}if(await new Promise((e,t)=>{if(window.Stripe)return void e();let r=document.querySelector("script[data-stripe-js='1']");if(r){r.addEventListener("load",()=>e(),{once:!0}),r.addEventListener("error",()=>t(Error("Stripe script load failed")),{once:!0});return}let n=document.createElement("script");n.src="https://js.stripe.com/v3/",n.async=!0,n.dataset.stripeJs="1",n.onload=()=>e(),n.onerror=()=>t(Error("Stripe script load failed")),document.head.appendChild(n)}),!window.Stripe)throw Error("Stripe indisponible");let c=window.Stripe(i);d||(d=c.initEmbeddedCheckout({fetchClientSecret:async()=>{var e,t;let n=await (0,u.v)("/api/payments/stripe/embedded-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:a})}),l=await n.json();if(!n.ok||!(null==(e=l.data)?void 0:e.clientSecret)){if(401===n.status)throw(0,s.Tp)(),r.push("/connexion?next=%2Fpanier&from=cart"),Error("Unauthorized");throw Error(null!=(t=l.error)?t:"Impossible d'initialiser Stripe")}return l.data.clientSecret}}).finally(()=>{d=null}));let p=await d;if(e)return;null==(n=f.current)||null==(t=n.unmount)||t.call(n),null==(o=f.current)||null==(l=o.destroy)||l.call(o),p.mount("#stripe-embedded-checkout"),f.current=p,h(!1)}catch(t){h(!1);let e=t instanceof Error?t.message:"Erreur Stripe.";e.includes("multiple Embedded Checkout objects")?m("Session de paiement d\xe9j\xe0 ouverte. Rechargez la page et r\xe9essayez."):m(e)}}(),()=>{var t,r,n,l;e=!0,null==(r=f.current)||null==(t=r.unmount)||t.call(r),null==(l=f.current)||null==(n=l.destroy)||n.call(l),f.current=null}},[a,r]),(0,n.jsxs)("main",{className:"mx-auto min-h-screen w-full max-w-4xl px-4 py-10 sm:px-6",children:[(0,n.jsx)("p",{className:"mb-3 text-xs font-bold uppercase tracking-[0.2em] text-[#8d895e]",children:"SENAME EDITIONâ€™S"}),(0,n.jsx)("h1",{className:"mb-2 text-2xl font-black text-[#181810] sm:text-3xl",children:"Paiement Stripe"}),(0,n.jsx)("p",{className:"mb-6 text-sm text-[#6b6959]",children:"Validez votre commande via Stripe Embedded Checkout."}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(o(),{href:"/commande/annulee?provider=stripe&orderId=".concat(encodeURIComponent(a)),className:"inline-flex rounded-lg border border-[#d8d7d0] px-4 py-2 text-sm font-bold uppercase",children:"Annuler et retourner au panier"})}),p?(0,n.jsx)("p",{className:"text-sm text-[#6b6959]",children:"Chargement du paiement..."}):null,c?(0,n.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:[(0,n.jsx)("p",{children:c}),(0,n.jsx)(o(),{href:"/panier",className:"mt-3 inline-block rounded-lg bg-primary px-4 py-2 font-bold uppercase",children:"Retour panier"})]}):null,(0,n.jsx)("div",{id:"stripe-embedded-checkout"})]})}},3596:(e,t,r)=>{"use strict";r.d(t,{NR:()=>l,Tp:()=>o,_5:()=>i,c4:()=>a});let n="livreo_auth_token";function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if("session"===t){window.sessionStorage.setItem(n,e),window.localStorage.removeItem(n);return}window.localStorage.setItem(n,e),window.sessionStorage.removeItem(n)}function a(){let e=window.sessionStorage.getItem(n);return e||window.localStorage.getItem(n)}function o(){window.localStorage.removeItem(n),window.sessionStorage.removeItem(n)}function i(){let e=a();if(!e)return null;let t=e.split(".");if(3!==t.length||!t[1])return null;try{let e=JSON.parse(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=t+"=".repeat((4-t.length%4)%4);return window.atob(r)}(t[1]));if(e.exp<=Math.floor(Date.now()/1e3))return null;return e}catch(e){return null}}},9678:(e,t,r)=>{"use strict";r.d(t,{v:()=>l});var n=r(3596);async function l(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(0,n.c4)(),a=new Headers(null!=(t=r.headers)?t:{});return l&&a.set("Authorization","Bearer ".concat(l)),fetch(e,{...r,headers:a})}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=739)),_N_E=e.O()}]);