"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6061],{63:(e,t,a)=>{var s=a(7260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},3596:(e,t,a)=>{a.d(t,{NR:()=>r,Tp:()=>i,_5:()=>o,c4:()=>n});let s="livreo_auth_token";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if("session"===t){window.sessionStorage.setItem(s,e),window.localStorage.removeItem(s);return}window.localStorage.setItem(s,e),window.sessionStorage.removeItem(s)}function n(){let e=window.sessionStorage.getItem(s);return e||window.localStorage.getItem(s)}function i(){window.localStorage.removeItem(s),window.sessionStorage.removeItem(s)}function o(){let e=n();if(!e)return null;let t=e.split(".");if(3!==t.length||!t[1])return null;try{let e=JSON.parse(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),a=t+"=".repeat((4-t.length%4)%4);return window.atob(a)}(t[1]));if(e.exp<=Math.floor(Date.now()/1e3))return null;return e}catch(e){return null}}},4835:(e,t,a)=>{a.d(t,{o:()=>s});function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";return!e||!e.startsWith("/")||e.startsWith("//")?t:e}},6061:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var s=a(5155),r=a(2619),n=a.n(r),i=a(2115),o=a(63),l=a(9678),d=a(3596),c=a(4835);function u(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"").slice(0,120)}let m=["pending","paid","cancelled","refunded"],p=["pending","paid","refunded"],x=["client","admin"],h=[{key:"dashboard",label:"Tableau de bord",icon:"dashboard",href:"/admin"},{key:"ouvrages",label:"Ouvrages",icon:"menu_book",href:"/admin/ouvrages"},{key:"users",label:"Utilisateurs",icon:"group",href:"/admin/users"},{key:"orders",label:"Commandes",icon:"receipt_long",href:"/admin/orders"},{key:"contributions",label:"Contributions",icon:"rocket_launch",href:"/admin/contributions"},{key:"marketing",label:"Marketing",icon:"local_offer",href:"/admin/marketing"}];function b(){var e,t;let a=(0,o.usePathname)(),r=(0,o.useRouter)(),b=(0,o.useSearchParams)(),[A,T]=(0,i.useState)(!0),[M,E]=(0,i.useState)(null),[I,P]=(0,i.useState)(null),[R,L]=(0,i.useState)(null),[O,D]=(0,i.useState)([]),[F,U]=(0,i.useState)([]),[_,V]=(0,i.useState)([]),[q,G]=(0,i.useState)([]),[J,H]=(0,i.useState)([]),[W,B]=(0,i.useState)([]),[Y,z]=(0,i.useState)({code:"",type:"percent",value:"",minSubtotal:"0",maxDiscount:"",usageLimit:"",expiresAt:""}),[K,$]=(0,i.useState)({title:"",slug:"",subtitle:"",description:"",price:"",saleType:"direct",releaseDate:"",isbn:"",coverVariant:"standard",stock:"",fundingGoal:"",fundingRaised:"0"}),[Q,X]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)({users:"",orders:"",contributions:"",ouvrages:"",promos:""}),[et,ea]=(0,i.useState)({users:1,orders:1,contributions:1,ouvrages:1,promos:1}),es=(0,i.useMemo)(()=>a.startsWith("/admin/ouvrages")?"ouvrages":a.startsWith("/admin/users")?"users":a.startsWith("/admin/orders")?"orders":a.startsWith("/admin/contributions")?"contributions":a.startsWith("/admin/marketing")?"marketing":"dashboard",[a]),er={dashboard:{title:"Tableau de bord",subtitle:"Vue globale de l'interface d'administration SENALE EDITION'S"},ouvrages:{title:"Ouvrages",subtitle:"Ajout, \xe9dition et suivi du catalogue"},users:{title:"Utilisateurs",subtitle:"Comptes, r\xf4les et permissions"},orders:{title:"Commandes",subtitle:"Historique et statut des commandes"},contributions:{title:"Contributions",subtitle:"Campagnes participatives et suivi des soutiens"},marketing:{title:"Marketing",subtitle:"Codes promo, newsletters et relances"}}[es],en=(0,i.useMemo)(()=>F.filter(e=>"pending"===e.status).length,[F]),ei=(0,i.useMemo)(()=>F.slice(0,4),[F]),eo=null!=(t=null==R||null==(e=R.campaignFunding)?void 0:e[0])?t:null,el=(0,i.useMemo)(()=>O.filter(e=>"".concat(e.name," ").concat(e.email," ").concat(e.role).toLowerCase().includes(Z.users.toLowerCase())),[O,Z.users]),ed=(0,i.useMemo)(()=>F.filter(e=>"".concat(e.id," ").concat(e.userId," ").concat(e.saleType," ").concat(e.status).toLowerCase().includes(Z.orders.toLowerCase())),[F,Z.orders]),ec=(0,i.useMemo)(()=>_.filter(e=>{var t,a;return"".concat(e.id," ").concat(e.bookId," ").concat(null!=(t=e.userId)?t:""," ").concat(e.status," ").concat(null!=(a=e.reward)?a:"").toLowerCase().includes(Z.contributions.toLowerCase())}),[_,Z.contributions]),eu=(0,i.useMemo)(()=>q.filter(e=>"".concat(e.title," ").concat(e.slug," ").concat(e.saleType).toLowerCase().includes(Z.ouvrages.toLowerCase())),[q,Z.ouvrages]),em=(0,i.useMemo)(()=>J.filter(e=>"".concat(e.code," ").concat(e.type," ").concat(e.value," ").concat(e.active?"active":"inactive").toLowerCase().includes(Z.promos.toLowerCase())),[J,Z.promos]),ep=g(el,et.users,8),ex=g(ed,et.orders,8),eh=g(ec,et.contributions,8),eb=g(eu,et.ouvrages,8),eg=g(em,et.promos,8);async function ef(){T(!0),E(null);let e=(0,d._5)();if(!e){let e=b.toString(),t=(0,c.o)("".concat(a).concat(e?"?".concat(e):""),"/admin");r.replace("/connexion?next=".concat(encodeURIComponent(t)));return}if("admin"!==e.role){E("Acc\xe8s refus\xe9: r\xf4le admin requis."),T(!1);return}try{var t,s,n,i,o,u,m;let[e,a,r,d,c,p,x]=await Promise.all([(0,l.v)("/api/admin/stats"),(0,l.v)("/api/admin/users"),(0,l.v)("/api/admin/orders"),(0,l.v)("/api/admin/contributions"),(0,l.v)("/api/admin/books"),(0,l.v)("/api/admin/promos"),(0,l.v)("/api/admin/audit")]),[h,b,g,f,v,j,y]=await Promise.all([e.json(),a.json(),r.json(),d.json(),c.json(),p.json(),x.json()]);if(!e.ok||!a.ok||!r.ok||!d.ok||!c.ok||!p.ok||!x.ok){E(h.error||b.error||g.error||f.error||v.error||j.error||y.error||"Erreur de chargement admin"),T(!1);return}L(null!=(t=h.data)?t:null),D(null!=(s=b.data)?s:[]),U(null!=(n=g.data)?n:[]),V(null!=(i=f.data)?i:[]),G(null!=(o=v.data)?o:[]),H(null!=(u=j.data)?u:[]),B(null!=(m=y.data)?m:[])}catch(e){E("Erreur r\xe9seau")}finally{T(!1)}}async function ev(e,t){let a=await (0,l.v)("".concat(e,"?format=csv"));if(!a.ok){var s;P(null!=(s=(await a.json()).error)?s:"Export CSV impossible");return}let r=new Blob([await a.text()],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(n)}async function ej(){let e=await (0,l.v)("/api/admin/notifications/run",{method:"POST"}),t=await e.json();if(!e.ok||!t.data){var a;P(null!=(a=t.error)?a:"Ex\xe9cution des notifications impossible");return}P("Notifications envoy\xe9es: pr\xe9commandes ".concat(t.data.preorderEmailsSent,", campagnes ").concat(t.data.campaignEmailsSent)),ef()}async function ey(e,t){let a=await (0,l.v)("/api/admin/users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,role:t})}),s=await a.json();if(!a.ok||!s.data){var r;P(null!=(r=s.error)?r:"Impossible de mettre \xe0 jour le r\xf4le");return}D(t=>t.map(t=>t.id===e?s.data:t)),P("R\xf4le utilisateur mis \xe0 jour")}async function eN(e,t){let a=await (0,l.v)("/api/admin/orders",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,status:t})}),s=await a.json();if(!a.ok||!s.data){var r;P(null!=(r=s.error)?r:"Impossible de mettre \xe0 jour la commande");return}U(t=>t.map(t=>t.id===e?s.data:t)),P("Statut de commande mis \xe0 jour")}async function ew(e,t){let a=await (0,l.v)("/api/admin/contributions",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({contributionId:e,status:t})}),s=await a.json();if(!a.ok||!s.data){var r;P(null!=(r=s.error)?r:"Impossible de mettre \xe0 jour la contribution");return}V(t=>t.map(t=>t.id===e?s.data:t)),P("Contribution mise \xe0 jour")}async function eC(e){let t=await (0,l.v)("/api/admin/books",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookId:e})}),a=await t.json();if(!t.ok||!a.data){var s;P(null!=(s=a.error)?s:"Impossible de supprimer l'ouvrage");return}G(e=>e.filter(e=>e.id!==a.data.id)),P("Ouvrage supprim\xe9")}async function ek(e){e.preventDefault();let t=await (0,l.v)("/api/admin/promos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:Y.code,type:Y.type,value:Number(Y.value),minSubtotal:Number(Y.minSubtotal||"0"),maxDiscount:Y.maxDiscount?Number(Y.maxDiscount):void 0,usageLimit:Y.usageLimit?Number(Y.usageLimit):void 0,expiresAt:Y.expiresAt||void 0})}),a=await t.json();if(!t.ok||!a.data){var s;P(null!=(s=a.error)?s:"Impossible de cr\xe9er le code promo");return}H(e=>[a.data,...e]),z({code:"",type:"percent",value:"",minSubtotal:"0",maxDiscount:"",usageLimit:"",expiresAt:""}),P("Code promo cr\xe9\xe9")}async function eS(e){let t=await (0,l.v)("/api/admin/promos",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({promoId:e.id,active:!e.active})}),a=await t.json();if(!t.ok||!a.data){var s;P(null!=(s=a.error)?s:"Impossible de mettre \xe0 jour le code promo");return}H(t=>t.map(t=>t.id===e.id?a.data:t)),P("Code promo mis \xe0 jour")}async function eA(e){if(e.preventDefault(),("direct"===K.saleType||"preorder"===K.saleType)&&""===K.stock.trim())return void P("Le stock est obligatoire pour Achat direct / Pr\xe9commande.");if("crowdfunding"===K.saleType&&""===K.fundingGoal.trim())return void P("L'objectif de financement est obligatoire pour le financement participatif.");let t=function(e){let{title:t,subtitle:a,saleType:s,variant:r}=e,n=t.trim()||"Nouvel ouvrage",i=(null!=a?a:"").trim(),o=j(s),l=n.split(/\s+/).slice(0,6),d=l.slice(0,Math.ceil(l.length/2)).join(" "),c=l.slice(Math.ceil(l.length/2)).join(" ");if("featured"===r){let e='\n<svg xmlns="http://www.w3.org/2000/svg" width="900" height="1350" viewBox="0 0 900 1350">\n  <defs>\n    <style>\n      .brand-small { font: 500 16px Manrope, Arial, sans-serif; fill: #6b7280; letter-spacing: 1px; }\n      .brand-main { font: 800 58px Manrope, Arial, sans-serif; fill: #111111; }\n      .meta { font: 700 22px Manrope, Arial, sans-serif; fill: #4b5563; letter-spacing: 2px; }\n      .footer { font: 700 12px Manrope, Arial, sans-serif; fill: #111111; letter-spacing: 3px; }\n    </style>\n  </defs>\n  <rect x="0" y="0" width="900" height="1350" fill="#ececec"/>\n  <rect x="12" y="12" width="876" height="1326" fill="none" stroke="#ced70d" stroke-width="8"/>\n  <text x="280" y="92" class="brand-small">'.concat(y("SEYDOU KOFFI ABODJINOU"),'</text>\n  <text x="548" y="92" class="brand-small">').concat(y("Sename d'Afrique"),'</text>\n  <text x="512" y="248" class="brand-small" style="font-size:56px;font-weight:700;fill:#6b7280;">sename</text>\n  <foreignObject x="140" y="350" width="620" height="340">\n    <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;flex-direction:column;gap:6px;">\n      <div style="font:700 72px Manrope, Arial, sans-serif;line-height:1.02;color:#111111;">').concat(y(d),'</div>\n      <div style="font:800 88px Manrope, Arial, sans-serif;line-height:1.02;color:#111111;">').concat(y(c||n),'</div>\n      <div style="margin-top:14px;font:600 50px Manrope, Arial, sans-serif;color:#b7b7b7;letter-spacing:2px;">').concat(y(i||"CARNETS DE CONFINEMENT"),'</div>\n    </div>\n  </foreignObject>\n  <text x="190" y="760" class="meta">#1. RESTAURER LE R\xc9EL   #2. DYSTOPIE CONCR\xc8TE</text>\n  <text x="450" y="1140" class="footer" text-anchor="middle">').concat(y(o.toUpperCase()),'</text>\n  <text x="450" y="1166" class="footer" text-anchor="middle">ESSAI</text>\n  <text x="450" y="1192" class="footer" text-anchor="middle">LITT\xc9RAIRE</text>\n  <rect x="430" y="1225" width="40" height="40" fill="#111"/>\n  <text x="800" y="1295" class="brand-small">51</text>\n</svg>');return"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(e))}let u='\n<svg xmlns="http://www.w3.org/2000/svg" width="900" height="1350" viewBox="0 0 900 1350">\n  <defs>\n    <style>\n      .brand-small { font: 700 34px Manrope, Arial, sans-serif; fill: #111111; letter-spacing: 1px; }\n      .title { font: 800 84px Manrope, Arial, sans-serif; fill: #3f3f46; }\n      .subtitle { font: 600 30px Manrope, Arial, sans-serif; fill: #444; }\n      .meta { font: 700 14px Manrope, Arial, sans-serif; fill: #4b5563; letter-spacing: 3px; }\n    </style>\n  </defs>\n  <rect x="0" y="0" width="900" height="1350" fill="#ececec"/>\n  <rect x="0" y="0" width="900" height="18" fill="#ced70d"/>\n  <text x="450" y="96" class="brand-small" text-anchor="middle">sename</text>\n  <foreignObject x="140" y="360" width="620" height="360">\n    <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;flex-direction:column;gap:12px;align-items:center;text-align:center;">\n      <div style="font:800 84px Manrope, Arial, sans-serif;line-height:1.1;color:#3f3f46;word-wrap:break-word;">\n        '.concat(y(d),'\n      </div>\n      <div style="font:800 84px Manrope, Arial, sans-serif;line-height:1.1;color:#3f3f46;word-wrap:break-word;">\n        ').concat(y(c),'\n      </div>\n      <div style="font:600 30px Manrope, Arial, sans-serif;line-height:1.3;color:#444;">').concat(y(i||"Livre d'une sortie au jour"),'</div>\n    </div>\n  </foreignObject>\n  <text x="450" y="860" class="meta" text-anchor="middle">').concat(y(o.toUpperCase()),'</text>\n  <text x="450" y="886" class="meta" text-anchor="middle">ESSAI</text>\n  <text x="450" y="912" class="meta" text-anchor="middle">LITT\xc9RAIRE</text>\n  <rect x="430" y="960" width="40" height="40" fill="#111"/>\n  <text x="850" y="1310" class="meta">1</text>\n</svg>');return"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(u))}({title:K.title,subtitle:K.subtitle,saleType:K.saleType,variant:K.coverVariant}),a={title:K.title,description:K.description,price:Number(K.price),saleType:K.saleType,coverImage:t};K.slug.trim()&&(a.slug=K.slug.trim()),K.subtitle.trim()&&(a.subtitle=K.subtitle.trim()),K.releaseDate&&(a.releaseDate=K.releaseDate),K.isbn.trim()&&(a.isbn=K.isbn.trim()),"featured"===K.coverVariant&&(a.tags=["featured"]),""!==K.stock.trim()&&(a.stock=Number(K.stock)),""!==K.fundingGoal.trim()&&(a.fundingGoal=Number(K.fundingGoal)),""!==K.fundingRaised.trim()&&(a.fundingRaised=Number(K.fundingRaised));let s=await (0,l.v)("/api/books",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await s.json();if(!s.ok){var n;P(null!=(n=r.error)?n:"Impossible de cr\xe9er l'ouvrage");return}$({title:"",slug:"",subtitle:"",description:"",price:"",saleType:"direct",releaseDate:"",isbn:"",coverVariant:"standard",stock:"",fundingGoal:"",fundingRaised:"0"}),X(!1),P("Ouvrage cr\xe9\xe9"),ef()}return(0,i.useEffect)(()=>{ef()},[]),(0,s.jsx)("main",{className:"min-h-screen bg-[#f3f4f6] text-[#181810] md:h-screen md:overflow-hidden",children:(0,s.jsxs)("div",{className:"flex min-h-screen flex-col md:h-screen md:flex-row",children:[(0,s.jsxs)("aside",{className:"w-full border-b border-[#e5e7eb] bg-white p-4 sm:p-5 md:w-72 md:border-b-0 md:border-r md:h-screen md:shrink-0 md:overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex size-8 items-center justify-center rounded-full bg-black text-primary",children:(0,s.jsx)("span",{className:"material-symbols-outlined text-xl",children:"menu_book"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-extrabold uppercase leading-tight tracking-tight text-[#181810] sm:text-lg",children:"SENAME EDITION’S"}),(0,s.jsx)("p",{className:"text-xs font-semibold text-[#6b7280] uppercase tracking-wide mt-1",children:"administration"})]})]}),(0,s.jsx)("nav",{className:"mt-6 space-y-2",children:h.map(e=>(0,s.jsxs)(n(),{href:e.href,className:"flex w-full items-center gap-3 rounded-xl px-4 py-3 text-left text-sm font-semibold transition ".concat(es===e.key?"bg-primary text-black":"text-[#4b5563] hover:bg-[#f4f5f7]"),children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-lg",children:e.icon}),(0,s.jsx)("span",{children:e.label})]},e.key))}),(0,s.jsx)("div",{className:"mt-10",children:(0,s.jsxs)("button",{type:"button",onClick:function(){(0,d.Tp)(),fetch("/api/auth/logout",{method:"POST",keepalive:!0}),window.location.replace("/")},className:"flex w-full items-center justify-center gap-2 rounded-lg border border-red-200 bg-white px-4 py-3 text-sm font-semibold text-red-600 transition hover:bg-[#fef2f2]",children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-base",children:"logout"}),"D\xe9connexion"]})})]}),(0,s.jsxs)("section",{className:"flex-1 p-4 sm:p-6 md:p-8 md:h-screen md:overflow-y-auto",children:[(0,s.jsx)("header",{className:"mb-6 flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-black sm:text-3xl",children:er.title}),(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:er.subtitle})]})}),A?(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:"Chargement..."}):null,M?(0,s.jsx)("p",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:M}):null,I?(0,s.jsx)("p",{className:"mb-4 rounded-xl border border-[#e5e7eb] bg-white px-4 py-3 text-sm",children:I}):null,A||M||!R?null:(0,s.jsxs)("div",{className:"space-y-6",children:["dashboard"===es?(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsx)(C,{icon:"group",label:"Utilisateurs",value:R.usersCount}),(0,s.jsx)(C,{icon:"receipt_long",label:"Commandes",value:R.ordersCount}),(0,s.jsx)(C,{icon:"rocket_launch",label:"Contributions",value:R.contributionsCount}),(0,s.jsx)(C,{icon:"euro",label:"Chiffre d'affaires",value:"".concat(R.paidRevenue.toFixed(2)," €")})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[(0,s.jsxs)("div",{className:"rounded-2xl border border-[#e5e7eb] bg-white p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-black",children:"Campagne crowdfunding"}),(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:"Suivi des collectes et campagnes actives"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>void ej(),className:"rounded-lg bg-primary px-3 py-2 text-xs font-bold uppercase",children:"Ex\xe9cuter notifications"})]}),(0,s.jsx)("div",{className:"mt-6 space-y-5",children:eo?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-[#181810]",children:eo.title}),(0,s.jsxs)("span",{className:"text-xs text-[#6b7280]",children:[Math.min(eo.collected/eo.goal*100,100).toFixed(0),"%"]})]}),(0,s.jsx)("div",{className:"h-2 rounded-full bg-[#f2f3f5]",children:(0,s.jsx)("div",{className:"h-2 rounded-full bg-primary",style:{width:"".concat(Math.min(eo.collected/eo.goal*100,100),"%")}})}),(0,s.jsxs)("p",{className:"text-xs text-[#6b7280] mt-2",children:[eo.collected.toFixed(2)," € collect\xe9s / ",eo.goal.toFixed(2)," € objectif"]})]}):(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:"Aucune campagne en cours."})})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-[#e5e7eb] bg-white p-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-black",children:"Statut contributions"}),(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:"Synth\xe8se des contributions et des collectes"}),(0,s.jsxs)("div",{className:"mt-6 space-y-3 text-sm text-[#171717]",children:[(0,s.jsxs)("p",{children:["Total collect\xe9: ",R.paidContributions.toFixed(2)," €"]}),(0,s.jsxs)("p",{children:["Campagnes suivies: ",R.campaignFunding.length]}),(0,s.jsxs)("p",{children:["Codes promo actifs: ",J.length]})]})]})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-[#e5e7eb] bg-white p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-black",children:"Commandes r\xe9centes"}),(0,s.jsxs)("p",{className:"text-sm text-[#6b7280]",children:[en," commande(s) en attente — focus sur les 4 derni\xe8res commandes"]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>void r.push("/admin/orders"),className:"text-xs font-bold text-[#6b7280] uppercase",children:"Voir tout"})]}),(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,s.jsx)("thead",{className:"text-xs uppercase tracking-wider text-[#6b7280]",children:(0,s.jsxs)("tr",{className:"border-b border-[#eceff2]",children:[(0,s.jsx)("th",{className:"py-3",children:"Commande"}),(0,s.jsx)("th",{className:"py-3",children:"Montant"}),(0,s.jsx)("th",{className:"py-3",children:"Type"}),(0,s.jsx)("th",{className:"py-3",children:"Statut"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-[#f2f4f7] text-sm",children:ei.length?ei.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-[#f8f8f5]",children:[(0,s.jsxs)("td",{className:"py-3 font-semibold",children:["#",e.id.slice(-6)]}),(0,s.jsxs)("td",{className:"py-3",children:[e.total.toFixed(2)," €"]}),(0,s.jsx)("td",{className:"py-3",children:j(e.saleType)}),(0,s.jsx)("td",{className:"py-3 uppercase text-xs text-[#181810]",children:N(e.status)})]},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"py-6 text-center text-sm text-[#6b7280]",children:"Pas de commandes \xe0 afficher."})})})]})})]})]}):null,"users"===es&&(0,s.jsxs)(k,{title:"Utilisateurs",subtitle:"Comptes, r\xf4les et permissions",actions:(0,s.jsx)("button",{type:"button",onClick:()=>void ev("/api/admin/users","users.csv"),className:"rounded border border-[#d8d7d0] px-3 py-1 text-xs font-semibold",children:"Exporter CSV"}),children:[(0,s.jsx)(f,{value:Z.users,onChange:e=>{ee(t=>({...t,users:e})),ea(e=>({...e,users:1}))},placeholder:"Rechercher nom, e-mail, r\xf4le..."}),(0,s.jsx)(S,{headers:["Nom","E-mail","R\xf4le","Action"],rows:ep.items.map(e=>[e.name,e.email,w(e.role),(0,s.jsx)("select",{className:"rounded border border-[#d8d7d0] px-2 py-1",value:e.role,onChange:t=>void ey(e.id,t.target.value),children:x.map(e=>(0,s.jsx)("option",{value:e,children:w(e)},e))},e.id)])}),(0,s.jsx)(v,{page:et.users,totalPages:ep.totalPages,onChange:e=>ea(t=>({...t,users:e}))})]}),"orders"===es&&(0,s.jsxs)(k,{id:"orders-section",title:"Commandes",subtitle:"Historique et mise \xe0 jour des statuts",actions:(0,s.jsx)("button",{type:"button",onClick:()=>void ev("/api/admin/orders","orders.csv"),className:"rounded border border-[#d8d7d0] px-3 py-1 text-xs font-semibold",children:"Exporter CSV"}),children:[(0,s.jsx)(f,{value:Z.orders,onChange:e=>{ee(t=>({...t,orders:e})),ea(e=>({...e,orders:1}))},placeholder:"Rechercher id, user, type, statut..."}),(0,s.jsx)(S,{headers:["Commande","Utilisateur","Total","Type","Statut"],rows:ex.items.map(e=>["".concat(e.id.slice(0,10),"..."),"".concat(e.userId.slice(0,10),"..."),"".concat(e.total.toFixed(2)," €"),j(e.saleType),(0,s.jsx)("select",{className:"rounded border border-[#d8d7d0] px-2 py-1",value:e.status,onChange:t=>void eN(e.id,t.target.value),children:m.map(e=>(0,s.jsx)("option",{value:e,children:N(e)},e))},e.id)])}),(0,s.jsx)(v,{page:et.orders,totalPages:ex.totalPages,onChange:e=>ea(t=>({...t,orders:e}))})]}),"contributions"===es&&(0,s.jsxs)(k,{title:"Contributions",subtitle:"Campagnes participatives et suivi des statuts",actions:(0,s.jsx)("button",{type:"button",onClick:()=>void ev("/api/admin/contributions","contributions.csv"),className:"rounded border border-[#d8d7d0] px-3 py-1 text-xs font-semibold",children:"Exporter CSV"}),children:[(0,s.jsx)(f,{value:Z.contributions,onChange:e=>{ee(t=>({...t,contributions:e})),ea(e=>({...e,contributions:1}))},placeholder:"Rechercher id, livre, user, statut..."}),(0,s.jsx)(S,{headers:["Contribution","Livre","Utilisateur","Montant","Statut"],rows:eh.items.map(e=>["".concat(e.id.slice(0,10),"..."),"".concat(e.bookId.slice(0,10),"..."),e.userId?"".concat(e.userId.slice(0,10),"..."):"Anonyme","".concat(e.amount.toFixed(2)," €"),(0,s.jsx)("select",{className:"rounded border border-[#d8d7d0] px-2 py-1",value:e.status,onChange:t=>void ew(e.id,t.target.value),children:p.map(e=>{var t;return(0,s.jsx)("option",{value:e,children:"pending"===(t=e)?"En attente":"paid"===t?"Pay\xe9e":"Rembours\xe9e"},e)})},e.id)])}),(0,s.jsx)(v,{page:et.contributions,totalPages:eh.totalPages,onChange:e=>ea(t=>({...t,contributions:e}))})]}),"ouvrages"===es&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k,{title:"Ajouter un ouvrage",subtitle:"Pr\xe9pare les prochains titres",children:(0,s.jsxs)("form",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",onSubmit:eA,children:[(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Titre",value:K.title,onChange:e=>{var t;return t=e.target.value,void $(e=>({...e,title:t,slug:Q?e.slug:u(t)}))},required:!0}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Slug (auto depuis le titre)",value:K.slug,onChange:e=>{var t;return t=e.target.value,void(X(!0),$(e=>({...e,slug:u(t)})))}}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2 md:col-span-2",placeholder:"Sous-titre (optionnel)",value:K.subtitle,onChange:e=>$(t=>({...t,subtitle:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Prix",type:"number",min:0,step:"0.01",value:K.price,onChange:e=>$(t=>({...t,price:e.target.value})),required:!0}),(0,s.jsxs)("select",{className:"rounded border border-[#d8d7d0] px-3 py-2",value:K.saleType,onChange:e=>$(t=>({...t,saleType:e.target.value})),children:[(0,s.jsx)("option",{value:"direct",children:"Achat direct"}),(0,s.jsx)("option",{value:"preorder",children:"Pr\xe9commande"}),(0,s.jsx)("option",{value:"crowdfunding",children:"Financement participatif"})]}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Date de sortie (YYYY-MM-DD)",type:"date",value:K.releaseDate,onChange:e=>$(t=>({...t,releaseDate:e.target.value}))}),(0,s.jsxs)("select",{className:"rounded border border-[#d8d7d0] px-3 py-2",value:K.coverVariant,onChange:e=>$(t=>({...t,coverVariant:e.target.value})),children:[(0,s.jsx)("option",{value:"featured",children:"Style couverture: Vedette"}),(0,s.jsx)("option",{value:"standard",children:"Style couverture: Standard"})]}),(0,s.jsx)("p",{className:"rounded border border-[#d8d7d0] bg-[#f8f8f5] px-3 py-2 text-xs text-[#6b7280] md:col-span-2",children:"La couverture est g\xe9n\xe9r\xe9e automatiquement selon le style choisi."}),(0,s.jsx)("textarea",{className:"rounded border border-[#d8d7d0] px-3 py-2 md:col-span-2",placeholder:"Description",value:K.description,onChange:e=>$(t=>({...t,description:e.target.value})),required:!0}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"ISBN (optionnel)",value:K.isbn,onChange:e=>$(t=>({...t,isbn:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Stock (achat direct/precommande)",type:"number",min:0,required:"crowdfunding"!==K.saleType,value:K.stock,onChange:e=>$(t=>({...t,stock:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Objectif financement (crowdfunding)",type:"number",min:0,required:"crowdfunding"===K.saleType,value:K.fundingGoal,onChange:e=>$(t=>({...t,fundingGoal:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Montant collecte (suivi)",type:"number",min:0,value:K.fundingRaised,onChange:e=>$(t=>({...t,fundingRaised:e.target.value}))}),(0,s.jsx)("button",{className:"rounded-lg bg-primary px-4 py-2 text-sm font-bold uppercase md:col-span-2",children:"Cr\xe9er ouvrage"})]})}),(0,s.jsxs)(k,{title:"Catalogue en ligne",subtitle:"Stock, prix et collecte",children:[(0,s.jsx)(f,{value:Z.ouvrages,onChange:e=>{ee(t=>({...t,ouvrages:e})),ea(e=>({...e,ouvrages:1}))},placeholder:"Rechercher titre, slug, type..."}),(0,s.jsx)(S,{headers:["Titre","Slug","Type","Prix","Stock/Objectif","Collect\xe9","Actions"],rows:eb.items.map(e=>{var t,a,r;return[e.title,e.slug,j(e.saleType),"".concat(e.price.toFixed(2)," €"),"crowdfunding"===e.saleType?"".concat((null!=(t=e.fundingGoal)?t:0).toFixed(0)):"".concat((null!=(a=e.stock)?a:0).toFixed(0)),"".concat((null!=(r=e.fundingRaised)?r:0).toFixed(0)),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n(),{href:"/ouvrages/".concat(e.slug),className:"rounded border border-[#d8d7d0] px-2 py-1 text-xs font-semibold",target:"_blank",children:"Voir"}),(0,s.jsx)("button",{type:"button",onClick:()=>void eC(e.id),className:"rounded border border-red-200 px-2 py-1 text-xs font-semibold text-red-700",children:"Supprimer"})]},e.id)]})}),(0,s.jsx)(v,{page:et.ouvrages,totalPages:eb.totalPages,onChange:e=>ea(t=>({...t,ouvrages:e}))})]})]}),"marketing"===es&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k,{title:"Cr\xe9er un code promo",subtitle:"Campagnes de fid\xe9lisation",children:(0,s.jsxs)("form",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",onSubmit:ek,children:[(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",placeholder:"Code (ex: SENAME15)",value:Y.code,onChange:e=>z(t=>({...t,code:e.target.value.toUpperCase()})),required:!0}),(0,s.jsxs)("select",{className:"rounded border border-[#d8d7d0] px-3 py-2",value:Y.type,onChange:e=>z(t=>({...t,type:e.target.value})),children:[(0,s.jsx)("option",{value:"percent",children:"Pourcentage"}),(0,s.jsx)("option",{value:"fixed",children:"Montant fixe"})]}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",type:"number",min:0,step:"0.01",placeholder:"Valeur",value:Y.value,onChange:e=>z(t=>({...t,value:e.target.value})),required:!0}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",type:"number",min:0,step:"0.01",placeholder:"Minimum panier",value:Y.minSubtotal,onChange:e=>z(t=>({...t,minSubtotal:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",type:"number",min:0,step:"0.01",placeholder:"Plafond remise (optionnel)",value:Y.maxDiscount,onChange:e=>z(t=>({...t,maxDiscount:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2",type:"number",min:1,placeholder:"Limite d'utilisation (optionnel)",value:Y.usageLimit,onChange:e=>z(t=>({...t,usageLimit:e.target.value}))}),(0,s.jsx)("input",{className:"rounded border border-[#d8d7d0] px-3 py-2 md:col-span-2",type:"date",value:Y.expiresAt,onChange:e=>z(t=>({...t,expiresAt:e.target.value}))}),(0,s.jsx)("button",{className:"rounded-lg bg-primary px-4 py-2 text-sm font-bold uppercase",children:"Cr\xe9er le code promo"})]})}),(0,s.jsxs)(k,{title:"Codes promo",subtitle:"Actifs et statuts",children:[(0,s.jsx)(f,{value:Z.promos,onChange:e=>{ee(t=>({...t,promos:e})),ea(e=>({...e,promos:1}))},placeholder:"Rechercher code, type, statut..."}),(0,s.jsx)(S,{headers:["Code","Type","Valeur","Usage","Minimum","Expiration","Actif"],rows:eg.items.map(e=>[e.code,"percent"===e.type?"Pourcentage":"Fixe","percent"===e.type?"".concat(e.value,"%"):"".concat(e.value.toFixed(2)," €"),"".concat(e.usedCount).concat(e.usageLimit?" / ".concat(e.usageLimit):""),"".concat(e.minSubtotal.toFixed(2)," €"),e.expiresAt?new Date(e.expiresAt).toLocaleDateString("fr-FR"):"-",(0,s.jsx)("button",{type:"button",onClick:()=>void eS(e),className:"rounded border px-2 py-1 text-xs font-semibold ".concat(e.active?"border-green-200 text-green-700":"border-[#d8d7d0] text-[#6b7280]"),children:e.active?"Actif":"Inactif"},e.id)])}),(0,s.jsx)(v,{page:et.promos,totalPages:eg.totalPages,onChange:e=>ea(t=>({...t,promos:e}))})]})]})]})]})]})})}function g(e,t,a){let s=Math.max(1,Math.ceil(e.length/a)),r=(Math.min(Math.max(1,t),s)-1)*a;return{items:e.slice(r,r+a),totalPages:s}}function f(e){let{value:t,onChange:a,placeholder:r}=e;return(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{className:"w-full rounded border border-[#d8d7d0] px-3 py-2 text-sm",value:t,onChange:e=>a(e.target.value),placeholder:r})})}function v(e){let{page:t,totalPages:a,onChange:r}=e;return(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,s.jsx)("button",{onClick:()=>r(Math.max(1,t-1)),disabled:t<=1,className:"rounded border border-[#d8d7d0] px-3 py-1 text-xs font-semibold disabled:opacity-50",children:"Pr\xe9c\xe9dent"}),(0,s.jsxs)("span",{className:"text-xs text-[#6b7280]",children:["Page ",t," / ",a]}),(0,s.jsx)("button",{onClick:()=>r(Math.min(a,t+1)),disabled:t>=a,className:"rounded border border-[#d8d7d0] px-3 py-1 text-xs font-semibold disabled:opacity-50",children:"Suivant"})]})}function j(e){return"direct"===e?"Achat direct":"preorder"===e?"Pr\xe9commande":"Financement participatif"}function y(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function N(e){return"pending"===e?"En attente":"paid"===e?"Pay\xe9e":"cancelled"===e?"Annul\xe9e":"Rembours\xe9e"}function w(e){return"admin"===e?"Administrateur":"Client"}function C(e){let{icon:t,label:a,value:r}=e;return(0,s.jsxs)("div",{className:"rounded-2xl border border-[#e5e7eb] bg-white p-5",children:[(0,s.jsx)("div",{className:"mb-3 flex h-10 w-10 items-center justify-center rounded-xl bg-[#fff8b5]",children:(0,s.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:t})}),(0,s.jsx)("p",{className:"text-sm text-[#6b7280]",children:a}),(0,s.jsx)("p",{className:"mt-1 text-3xl font-black",children:r})]})}function k(e){let{title:t,subtitle:a,actions:r,id:n,children:i}=e;return(0,s.jsxs)("section",{id:n,className:"rounded-2xl border border-[#e5e7eb] bg-white p-4 sm:p-6",children:[(0,s.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-black sm:text-2xl",children:t}),a?(0,s.jsx)("p",{className:"text-xs text-[#6b7280] sm:text-sm",children:a}):null]}),r?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:r}):null]}),i]})}function S(e){let{headers:t,rows:a}=e;return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full min-w-[760px] text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"border-b border-[#eceff2] text-left text-xs uppercase tracking-wider text-[#6b7280]",children:t.map(e=>(0,s.jsx)("th",{className:"py-2",children:e},e))})}),(0,s.jsx)("tbody",{children:a.map((e,t)=>(0,s.jsx)("tr",{className:"border-b border-[#f2f4f7]",children:e.map((e,t)=>(0,s.jsx)("td",{className:"py-2",children:e},t))},t))})]})})}},9678:(e,t,a)=>{a.d(t,{v:()=>r});var s=a(3596);async function r(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,s.c4)(),n=new Headers(null!=(t=a.headers)?t:{});return r&&n.set("Authorization","Bearer ".concat(r)),fetch(e,{...a,headers:n})}}}]);