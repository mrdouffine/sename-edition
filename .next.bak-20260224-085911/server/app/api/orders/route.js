/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/orders/route";
exports.ids = ["app/api/orders/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Forders%2Froute&page=%2Fapi%2Forders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Forders%2Froute.ts&appDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Forders%2Froute&page=%2Fapi%2Forders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Forders%2Froute.ts&appDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var _home_moucharif_Documents_IAI_COURS_PersonalProject_ProjetV_Livreo_src_app_api_orders_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./src/app/api/orders/route.ts */ \"(rsc)/./src/app/api/orders/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/orders/route\",\n        pathname: \"/api/orders\",\n        filename: \"route\",\n        bundlePath: \"app/api/orders/route\"\n    },\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"/home/moucharif/Documents/IAI-COURS/PersonalProject/ProjetV/Livreo/src/app/api/orders/route.ts\",\n    nextConfigOutput,\n    userland: _home_moucharif_Documents_IAI_COURS_PersonalProject_ProjetV_Livreo_src_app_api_orders_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/orders/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZvcmRlcnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9yZGVycyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9yZGVycyUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGbW91Y2hhcmlmJTJGRG9jdW1lbnRzJTJGSUFJLUNPVVJTJTJGUGVyc29uYWxQcm9qZWN0JTJGUHJvamV0ViUyRkxpdnJlbyUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGaG9tZSUyRm1vdWNoYXJpZiUyRkRvY3VtZW50cyUyRklBSS1DT1VSUyUyRlBlcnNvbmFsUHJvamVjdCUyRlByb2pldFYlMkZMaXZyZW8maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QmaXNHbG9iYWxOb3RGb3VuZEVuYWJsZWQ9ISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNkO0FBQ1M7QUFDTztBQUNLO0FBQ21DO0FBQ2pEO0FBQ087QUFDZjtBQUNzQztBQUN6QjtBQUNNO0FBQ0M7QUFDaEI7QUFDeUQ7QUFDM0g7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsYUFBYSxPQUFvQyxJQUFJLENBQUU7QUFDdkQsd0JBQXdCLE1BQXVDO0FBQy9EO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGO0FBQ25GO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQixDQUFDO0FBQ047QUFDQTtBQUNBO0FBQ0EsK0JBQStCLEtBQXdDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9KQUFvSjtBQUNoSyw4QkFBOEIsNkZBQWdCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiw2RkFBZTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiw0RUFBUztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsOEJBQThCLDZFQUFjO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw0RUFBZTtBQUMzQyw0QkFBNEIsNkVBQWdCO0FBQzVDLG9CQUFvQix5R0FBa0Isa0NBQWtDLGlIQUFzQjtBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGdGQUFjO0FBQy9FLCtEQUErRCx5Q0FBeUM7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxFQUFFLE1BQU07QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQkFBa0I7QUFDbEIsdUNBQXVDLFFBQVEsRUFBRSxRQUFRO0FBQ3pEO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxvQkFBb0I7QUFDbkU7QUFDQSx5QkFBeUIsNkVBQWM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxzRkFBeUI7QUFDakU7QUFDQSxvQ0FBb0MsNEVBQXNCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0pBQXNKLG9FQUFjO0FBQ3BLLDBJQUEwSSxvRUFBYztBQUN4SjtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsNkVBQWU7QUFDckQ7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBLDhCQUE4Qiw2RUFBWTtBQUMxQztBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLDJGQUFtQjtBQUNqRTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGtFQUFTO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUlBQXFJLDZFQUFlO0FBQ3BKO0FBQ0EsMkdBQTJHLGlIQUFpSDtBQUM1TjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUIsNkVBQWM7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHdGQUEyQjtBQUN2RCxrQkFBa0IsNkVBQWM7QUFDaEMsK0JBQStCLDRFQUFzQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QywwRkFBcUI7QUFDbEU7QUFDQSxrQkFBa0IsNkVBQVk7QUFDOUI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ04sNkJBQTZCLDZGQUFlO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDJGQUFtQjtBQUNyRDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2RUFBWTtBQUMxQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUEiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgeyBnZXRSZXF1ZXN0TWV0YSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JlcXVlc3QtbWV0YVwiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IG5vcm1hbGl6ZUFwcFBhdGggfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvcm91dGVyL3V0aWxzL2FwcC1wYXRoc1wiO1xuaW1wb3J0IHsgTm9kZU5leHRSZXF1ZXN0LCBOb2RlTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYmFzZS1odHRwL25vZGVcIjtcbmltcG9ydCB7IE5leHRSZXF1ZXN0QWRhcHRlciwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi9zcGVjLWV4dGVuc2lvbi9hZGFwdGVycy9uZXh0LXJlcXVlc3RcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgZ2V0UmV2YWxpZGF0ZVJlYXNvbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2luc3RydW1lbnRhdGlvbi91dGlsc1wiO1xuaW1wb3J0IHsgc2VuZFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvc2VuZC1yZXNwb25zZVwiO1xuaW1wb3J0IHsgZnJvbU5vZGVPdXRnb2luZ0h0dHBIZWFkZXJzLCB0b05vZGVPdXRnb2luZ0h0dHBIZWFkZXJzIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvd2ViL3V0aWxzXCI7XG5pbXBvcnQgeyBnZXRDYWNoZUNvbnRyb2xIZWFkZXIgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvY2FjaGUtY29udHJvbFwiO1xuaW1wb3J0IHsgSU5GSU5JVEVfQ0FDSEUsIE5FWFRfQ0FDSEVfVEFHU19IRUFERVIgfSBmcm9tIFwibmV4dC9kaXN0L2xpYi9jb25zdGFudHNcIjtcbmltcG9ydCB7IE5vRmFsbGJhY2tFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2hhcmVkL2xpYi9uby1mYWxsYmFjay1lcnJvci5leHRlcm5hbFwiO1xuaW1wb3J0IHsgQ2FjaGVkUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcmVzcG9uc2UtY2FjaGVcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2FwcC9hcGkvb3JkZXJzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9vcmRlcnMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9vcmRlcnNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL29yZGVycy9yb3V0ZVwiXG4gICAgfSxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcmVsYXRpdmVQcm9qZWN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfUFJPSkVDVF9ESVIgfHwgJycsXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2FwcC9hcGkvb3JkZXJzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMsIGN0eCkge1xuICAgIHZhciBfbmV4dENvbmZpZ19leHBlcmltZW50YWw7XG4gICAgbGV0IHNyY1BhZ2UgPSBcIi9hcGkvb3JkZXJzL3JvdXRlXCI7XG4gICAgLy8gdHVyYm9wYWNrIGRvZXNuJ3Qgbm9ybWFsaXplIGAvaW5kZXhgIGluIHRoZSBwYWdlIG5hbWVcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRvIHByb2Nlc3MgZHluYW1pYyByb3V0ZXMgcHJvcGVybHlcbiAgICAvLyBUT0RPOiBmaXggdHVyYm9wYWNrIHByb3ZpZGluZyBkaWZmZXJpbmcgdmFsdWUgZnJvbSB3ZWJwYWNrXG4gICAgaWYgKHByb2Nlc3MuZW52LlRVUkJPUEFDSykge1xuICAgICAgICBzcmNQYWdlID0gc3JjUGFnZS5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJykgfHwgJy8nO1xuICAgIH0gZWxzZSBpZiAoc3JjUGFnZSA9PT0gJy9pbmRleCcpIHtcbiAgICAgICAgLy8gd2UgYWx3YXlzIG5vcm1hbGl6ZSAvaW5kZXggc3BlY2lmaWNhbGx5XG4gICAgICAgIHNyY1BhZ2UgPSAnLyc7XG4gICAgfVxuICAgIGNvbnN0IG11bHRpWm9uZURyYWZ0TW9kZSA9IHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREU7XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZSxcbiAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlXG4gICAgfSk7XG4gICAgaWYgKCFwcmVwYXJlUmVzdWx0KSB7XG4gICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgICAgICByZXMuZW5kKCdCYWQgUmVxdWVzdCcpO1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB7IGJ1aWxkSWQsIHBhcmFtcywgbmV4dENvbmZpZywgaXNEcmFmdE1vZGUsIHByZXJlbmRlck1hbmlmZXN0LCByb3V0ZXJTZXJ2ZXJDb250ZXh0LCBpc09uRGVtYW5kUmV2YWxpZGF0ZSwgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQsIHJlc29sdmVkUGF0aG5hbWUgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgY29uc3Qgbm9ybWFsaXplZFNyY1BhZ2UgPSBub3JtYWxpemVBcHBQYXRoKHNyY1BhZ2UpO1xuICAgIGxldCBpc0lzciA9IEJvb2xlYW4ocHJlcmVuZGVyTWFuaWZlc3QuZHluYW1pY1JvdXRlc1tub3JtYWxpemVkU3JjUGFnZV0gfHwgcHJlcmVuZGVyTWFuaWZlc3Qucm91dGVzW3Jlc29sdmVkUGF0aG5hbWVdKTtcbiAgICBpZiAoaXNJc3IgJiYgIWlzRHJhZnRNb2RlKSB7XG4gICAgICAgIGNvbnN0IGlzUHJlcmVuZGVyZWQgPSBCb29sZWFuKHByZXJlbmRlck1hbmlmZXN0LnJvdXRlc1tyZXNvbHZlZFBhdGhuYW1lXSk7XG4gICAgICAgIGNvbnN0IHByZXJlbmRlckluZm8gPSBwcmVyZW5kZXJNYW5pZmVzdC5keW5hbWljUm91dGVzW25vcm1hbGl6ZWRTcmNQYWdlXTtcbiAgICAgICAgaWYgKHByZXJlbmRlckluZm8pIHtcbiAgICAgICAgICAgIGlmIChwcmVyZW5kZXJJbmZvLmZhbGxiYWNrID09PSBmYWxzZSAmJiAhaXNQcmVyZW5kZXJlZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb0ZhbGxiYWNrRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgY2FjaGVLZXkgPSBudWxsO1xuICAgIGlmIChpc0lzciAmJiAhcm91dGVNb2R1bGUuaXNEZXYgJiYgIWlzRHJhZnRNb2RlKSB7XG4gICAgICAgIGNhY2hlS2V5ID0gcmVzb2x2ZWRQYXRobmFtZTtcbiAgICAgICAgLy8gZW5zdXJlIC9pbmRleCBhbmQgLyBpcyBub3JtYWxpemVkIHRvIG9uZSBrZXlcbiAgICAgICAgY2FjaGVLZXkgPSBjYWNoZUtleSA9PT0gJy9pbmRleCcgPyAnLycgOiBjYWNoZUtleTtcbiAgICB9XG4gICAgY29uc3Qgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UgPSAvLyBJZiB3ZSdyZSBpbiBkZXZlbG9wbWVudCwgd2UgYWx3YXlzIHN1cHBvcnQgZHluYW1pYyBIVE1MXG4gICAgcm91dGVNb2R1bGUuaXNEZXYgPT09IHRydWUgfHwgLy8gSWYgdGhpcyBpcyBub3QgU1NHIG9yIGRvZXMgbm90IGhhdmUgc3RhdGljIHBhdGhzLCB0aGVuIGl0IHN1cHBvcnRzXG4gICAgLy8gZHluYW1pYyBIVE1MLlxuICAgICFpc0lzcjtcbiAgICAvLyBUaGlzIGlzIGEgcmV2YWxpZGF0aW9uIHJlcXVlc3QgaWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljXG4gICAgLy8gcGFnZSBhbmQgaXQgaXMgbm90IGJlaW5nIHJlc3VtZWQgZnJvbSBhIHBvc3Rwb25lZCByZW5kZXIgYW5kXG4gICAgLy8gaXQgaXMgbm90IGEgZHluYW1pYyBSU0MgcmVxdWVzdCB0aGVuIGl0IGlzIGEgcmV2YWxpZGF0aW9uXG4gICAgLy8gcmVxdWVzdC5cbiAgICBjb25zdCBpc1JldmFsaWRhdGUgPSBpc0lzciAmJiAhc3VwcG9ydHNEeW5hbWljUmVzcG9uc2U7XG4gICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICBjb25zdCBhY3RpdmVTcGFuID0gdHJhY2VyLmdldEFjdGl2ZVNjb3BlU3BhbigpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICAgIHBhcmFtcyxcbiAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgIHJlbmRlck9wdHM6IHtcbiAgICAgICAgICAgIGV4cGVyaW1lbnRhbDoge1xuICAgICAgICAgICAgICAgIGNhY2hlQ29tcG9uZW50czogQm9vbGVhbihuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbC5jYWNoZUNvbXBvbmVudHMpLFxuICAgICAgICAgICAgICAgIGF1dGhJbnRlcnJ1cHRzOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmF1dGhJbnRlcnJ1cHRzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlLFxuICAgICAgICAgICAgaW5jcmVtZW50YWxDYWNoZTogZ2V0UmVxdWVzdE1ldGEocmVxLCAnaW5jcmVtZW50YWxDYWNoZScpLFxuICAgICAgICAgICAgY2FjaGVMaWZlUHJvZmlsZXM6IChfbmV4dENvbmZpZ19leHBlcmltZW50YWwgPSBuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbC5jYWNoZUxpZmUsXG4gICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICB3YWl0VW50aWw6IGN0eC53YWl0VW50aWwsXG4gICAgICAgICAgICBvbkNsb3NlOiAoY2IpPT57XG4gICAgICAgICAgICAgICAgcmVzLm9uKCdjbG9zZScsIGNiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkFmdGVyVGFza0Vycm9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBvbkluc3RydW1lbnRhdGlvblJlcXVlc3RFcnJvcjogKGVycm9yLCBfcmVxdWVzdCwgZXJyb3JDb250ZXh0KT0+cm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnJvciwgZXJyb3JDb250ZXh0LCByb3V0ZXJTZXJ2ZXJDb250ZXh0KVxuICAgICAgICB9LFxuICAgICAgICBzaGFyZWRDb250ZXh0OiB7XG4gICAgICAgICAgICBidWlsZElkXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IG5vZGVOZXh0UmVxID0gbmV3IE5vZGVOZXh0UmVxdWVzdChyZXEpO1xuICAgIGNvbnN0IG5vZGVOZXh0UmVzID0gbmV3IE5vZGVOZXh0UmVzcG9uc2UocmVzKTtcbiAgICBjb25zdCBuZXh0UmVxID0gTmV4dFJlcXVlc3RBZGFwdGVyLmZyb21Ob2RlTmV4dFJlcXVlc3Qobm9kZU5leHRSZXEsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UocmVzKSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PntcbiAgICAgICAgICAgIHJldHVybiByb3V0ZU1vZHVsZS5oYW5kbGUobmV4dFJlcSwgY29udGV4dCkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBoYW5kbGVSZXNwb25zZSA9IGFzeW5jIChjdXJyZW50U3Bhbik9PntcbiAgICAgICAgICAgIHZhciBfY2FjaGVFbnRyeV92YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlR2VuZXJhdG9yID0gYXN5bmMgKHsgcHJldmlvdXNDYWNoZUVudHJ5IH0pPT57XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpICYmIGlzT25EZW1hbmRSZXZhbGlkYXRlICYmIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkICYmICFwcmV2aW91c0NhY2hlRW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb24tZGVtYW5kIHJldmFsaWRhdGUgYWx3YXlzIHNldHMgdGhpcyBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ3gtbmV4dGpzLWNhY2hlJywgJ1JFVkFMSURBVEVEJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKCdUaGlzIHBhZ2UgY291bGQgbm90IGJlIGZvdW5kJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGN1cnJlbnRTcGFuKTtcbiAgICAgICAgICAgICAgICAgICAgcmVxLmZldGNoTWV0cmljcyA9IGNvbnRleHQucmVuZGVyT3B0cy5mZXRjaE1ldHJpY3M7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwZW5kaW5nV2FpdFVudGlsID0gY29udGV4dC5yZW5kZXJPcHRzLnBlbmRpbmdXYWl0VW50aWw7XG4gICAgICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdXNpbmcgcHJvdmlkZWQgd2FpdFVudGlsIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIG5vdCB3ZSBmYWxsYmFjayB0byBzZW5kUmVzcG9uc2UncyBoYW5kbGluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ1dhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN0eC53YWl0VW50aWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgud2FpdFVudGlsKHBlbmRpbmdXYWl0VW50aWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdXYWl0VW50aWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGVUYWdzID0gY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFRhZ3M7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZXF1ZXN0IGlzIGZvciBhIHN0YXRpYyByZXNwb25zZSwgd2UgY2FuIGNhY2hlIGl0IHNvIGxvbmdcbiAgICAgICAgICAgICAgICAgICAgLy8gYXMgaXQncyBub3QgZWRnZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSXNyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgaGVhZGVycyBmcm9tIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSB0b05vZGVPdXRnb2luZ0h0dHBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlVGFncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbTkVYVF9DQUNIRV9UQUdTX0hFQURFUl0gPSBjYWNoZVRhZ3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddICYmIGJsb2IudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gYmxvYi50eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV2YWxpZGF0ZSA9IHR5cGVvZiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGUgPj0gSU5GSU5JVEVfQ0FDSEUgPyBmYWxzZSA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwaXJlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmUgPT09ICd1bmRlZmluZWQnIHx8IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmUgPj0gSU5GSU5JVEVfQ0FDSEUgPyB1bmRlZmluZWQgOiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBjYWNoZSBlbnRyeSBmb3IgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBraW5kOiBDYWNoZWRSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogQnVmZmVyLmZyb20oYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVDb250cm9sOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVFbnRyeTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgcmVzcG9uc2Ugd2l0aG91dCBjYWNoaW5nIGlmIG5vdCBJU1JcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIHJlc3BvbnNlLCBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgYmFja2dyb3VuZCByZXZhbGlkYXRlIHdlIG5lZWQgdG8gcmVwb3J0XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSByZXF1ZXN0IGVycm9yIGhlcmUgYXMgaXQgd29uJ3QgYmUgYnViYmxlZFxuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNDYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiBwcmV2aW91c0NhY2hlRW50cnkuaXNTdGFsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJLaW5kOiAnQXBwIFJvdXRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVQYXRoOiBzcmNQYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlVHlwZTogJ3JvdXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRlUmVhc29uOiBnZXRSZXZhbGlkYXRlUmVhc29uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCByb3V0ZXJTZXJ2ZXJDb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSBhd2FpdCByb3V0ZU1vZHVsZS5oYW5kbGVSZXNwb25zZSh7XG4gICAgICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgICAgIG5leHRDb25maWcsXG4gICAgICAgICAgICAgICAgY2FjaGVLZXksXG4gICAgICAgICAgICAgICAgcm91dGVLaW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICAgICAgICAgIGlzRmFsbGJhY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHByZXJlbmRlck1hbmlmZXN0LFxuICAgICAgICAgICAgICAgIGlzUm91dGVQUFJFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICByZXZhbGlkYXRlT25seUdlbmVyYXRlZCxcbiAgICAgICAgICAgICAgICByZXNwb25zZUdlbmVyYXRvcixcbiAgICAgICAgICAgICAgICB3YWl0VW50aWw6IGN0eC53YWl0VW50aWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gd2UgZG9uJ3QgY3JlYXRlIGEgY2FjaGVFbnRyeSBmb3IgSVNSXG4gICAgICAgICAgICBpZiAoIWlzSXNyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGNhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZS5raW5kKSAhPT0gQ2FjaGVkUm91dGVLaW5kLkFQUF9ST1VURSkge1xuICAgICAgICAgICAgICAgIHZhciBfY2FjaGVFbnRyeV92YWx1ZTE7XG4gICAgICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ldyBFcnJvcihgSW52YXJpYW50OiBhcHAtcm91dGUgcmVjZWl2ZWQgaW52YWxpZCBjYWNoZSBlbnRyeSAke2NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZTEgPSBjYWNoZUVudHJ5LnZhbHVlKSA9PSBudWxsID8gdm9pZCAwIDogX2NhY2hlRW50cnlfdmFsdWUxLmtpbmR9YCksIFwiX19ORVhUX0VSUk9SX0NPREVcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJFNzAxXCIsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ3gtbmV4dGpzLWNhY2hlJywgaXNPbkRlbWFuZFJldmFsaWRhdGUgPyAnUkVWQUxJREFURUQnIDogY2FjaGVFbnRyeS5pc01pc3MgPyAnTUlTUycgOiBjYWNoZUVudHJ5LmlzU3RhbGUgPyAnU1RBTEUnIDogJ0hJVCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRHJhZnQgbW9kZSBzaG91bGQgbmV2ZXIgYmUgY2FjaGVkXG4gICAgICAgICAgICBpZiAoaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ3ByaXZhdGUsIG5vLWNhY2hlLCBuby1zdG9yZSwgbWF4LWFnZT0wLCBtdXN0LXJldmFsaWRhdGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBmcm9tTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMoY2FjaGVFbnRyeS52YWx1ZS5oZWFkZXJzKTtcbiAgICAgICAgICAgIGlmICghKGdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykgJiYgaXNJc3IpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5kZWxldGUoTkVYVF9DQUNIRV9UQUdTX0hFQURFUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiBjYWNoZSBjb250cm9sIGlzIGFscmVhZHkgc2V0IG9uIHRoZSByZXNwb25zZSB3ZSBkb24ndFxuICAgICAgICAgICAgLy8gb3ZlcnJpZGUgaXQgdG8gYWxsb3cgdXNlcnMgdG8gY3VzdG9taXplIGl0IHZpYSBuZXh0LmNvbmZpZ1xuICAgICAgICAgICAgaWYgKGNhY2hlRW50cnkuY2FjaGVDb250cm9sICYmICFyZXMuZ2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJykgJiYgIWhlYWRlcnMuZ2V0KCdDYWNoZS1Db250cm9sJykpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLnNldCgnQ2FjaGUtQ29udHJvbCcsIGdldENhY2hlQ29udHJvbEhlYWRlcihjYWNoZUVudHJ5LmNhY2hlQ29udHJvbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgbmV3IFJlc3BvbnNlKGNhY2hlRW50cnkudmFsdWUuYm9keSwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBjYWNoZUVudHJ5LnZhbHVlLnN0YXR1cyB8fCAyMDBcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaGFuZGxlUmVzcG9uc2UoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaGFuZGxlUmVzcG9uc2UpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBOb0ZhbGxiYWNrRXJyb3IpKSB7XG4gICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IG5vcm1hbGl6ZWRTcmNQYWdlLFxuICAgICAgICAgICAgICAgIHJvdXRlVHlwZTogJ3JvdXRlJyxcbiAgICAgICAgICAgICAgICByZXZhbGlkYXRlUmVhc29uOiBnZXRSZXZhbGlkYXRlUmVhc29uKHtcbiAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyByZXRocm93IHNvIHRoYXQgd2UgY2FuIGhhbmRsZSBzZXJ2aW5nIGVycm9yIHBhZ2VcbiAgICAgICAgLy8gSWYgdGhpcyBpcyBkdXJpbmcgc3RhdGljIGdlbmVyYXRpb24sIHRocm93IHRoZSBlcnJvciBhZ2Fpbi5cbiAgICAgICAgaWYgKGlzSXNyKSB0aHJvdyBlcnI7XG4gICAgICAgIC8vIE90aGVyd2lzZSwgc2VuZCBhIDUwMCByZXNwb25zZS5cbiAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgbmV3IFJlc3BvbnNlKG51bGwsIHtcbiAgICAgICAgICAgIHN0YXR1czogNTAwXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Forders%2Froute&page=%2Fapi%2Forders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Forders%2Froute.ts&appDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/orders/route.ts":
/*!*************************************!*\
  !*** ./src/app/api/orders/route.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n/* harmony import */ var _lib_auth_session__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/session */ \"(rsc)/./src/lib/auth/session.ts\");\n/* harmony import */ var _lib_security_rateLimit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/security/rateLimit */ \"(rsc)/./src/lib/security/rateLimit.ts\");\n/* harmony import */ var _lib_services_marketingService__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/services/marketingService */ \"(rsc)/./src/lib/services/marketingService.ts\");\n/* harmony import */ var _lib_services_orderService__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/services/orderService */ \"(rsc)/./src/lib/services/orderService.ts\");\n/* harmony import */ var _lib_validation_order__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/validation/order */ \"(rsc)/./src/lib/validation/order.ts\");\n\n\n\n\n\n\nasync function POST(request) {\n    try {\n        (0,_lib_security_rateLimit__WEBPACK_IMPORTED_MODULE_2__.assertRateLimit)({\n            request,\n            key: \"orders:create\",\n            limit: 20,\n            windowMs: 10 * 60 * 1000\n        });\n        const session = (0,_lib_auth_session__WEBPACK_IMPORTED_MODULE_1__.requireAuth)(request);\n        const payload = (0,_lib_validation_order__WEBPACK_IMPORTED_MODULE_5__.parseOrderPayload)(await (0,_lib_api__WEBPACK_IMPORTED_MODULE_0__.readJson)(request));\n        const order = await (0,_lib_services_orderService__WEBPACK_IMPORTED_MODULE_4__.createOrder)({\n            ...payload,\n            userId: session.sub\n        });\n        await (0,_lib_services_marketingService__WEBPACK_IMPORTED_MODULE_3__.markCartsRecovered)(session.sub);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_0__.jsonSuccess)(order, 201);\n    } catch (error) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_0__.handleApiError)(error);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9vcmRlcnMvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFrRTtBQUNqQjtBQUNVO0FBQ1U7QUFDWDtBQUNDO0FBRXBELGVBQWVRLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRkwsd0VBQWVBLENBQUM7WUFDZEs7WUFDQUMsS0FBSztZQUNMQyxPQUFPO1lBQ1BDLFVBQVUsS0FBSyxLQUFLO1FBQ3RCO1FBRUEsTUFBTUMsVUFBVVYsOERBQVdBLENBQUNNO1FBQzVCLE1BQU1LLFVBQVVQLHdFQUFpQkEsQ0FBQyxNQUFNTCxrREFBUUEsQ0FBQ087UUFFakQsTUFBTU0sUUFBUSxNQUFNVCx1RUFBV0EsQ0FBQztZQUM5QixHQUFHUSxPQUFPO1lBQ1ZFLFFBQVFILFFBQVFJLEdBQUc7UUFDckI7UUFFQSxNQUFNWixrRkFBa0JBLENBQUNRLFFBQVFJLEdBQUc7UUFFcEMsT0FBT2hCLHFEQUFXQSxDQUFDYyxPQUFPO0lBQzVCLEVBQUUsT0FBT0csT0FBTztRQUNkLE9BQU9sQix3REFBY0EsQ0FBQ2tCO0lBQ3hCO0FBQ0YiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvYXBwL2FwaS9vcmRlcnMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaGFuZGxlQXBpRXJyb3IsIGpzb25TdWNjZXNzLCByZWFkSnNvbiB9IGZyb20gXCJAL2xpYi9hcGlcIjtcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSBcIkAvbGliL2F1dGgvc2Vzc2lvblwiO1xuaW1wb3J0IHsgYXNzZXJ0UmF0ZUxpbWl0IH0gZnJvbSBcIkAvbGliL3NlY3VyaXR5L3JhdGVMaW1pdFwiO1xuaW1wb3J0IHsgbWFya0NhcnRzUmVjb3ZlcmVkIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL21hcmtldGluZ1NlcnZpY2VcIjtcbmltcG9ydCB7IGNyZWF0ZU9yZGVyIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL29yZGVyU2VydmljZVwiO1xuaW1wb3J0IHsgcGFyc2VPcmRlclBheWxvYWQgfSBmcm9tIFwiQC9saWIvdmFsaWRhdGlvbi9vcmRlclwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgYXNzZXJ0UmF0ZUxpbWl0KHtcbiAgICAgIHJlcXVlc3QsXG4gICAgICBrZXk6IFwib3JkZXJzOmNyZWF0ZVwiLFxuICAgICAgbGltaXQ6IDIwLFxuICAgICAgd2luZG93TXM6IDEwICogNjAgKiAxMDAwXG4gICAgfSk7XG5cbiAgICBjb25zdCBzZXNzaW9uID0gcmVxdWlyZUF1dGgocmVxdWVzdCk7XG4gICAgY29uc3QgcGF5bG9hZCA9IHBhcnNlT3JkZXJQYXlsb2FkKGF3YWl0IHJlYWRKc29uKHJlcXVlc3QpKTtcblxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgY3JlYXRlT3JkZXIoe1xuICAgICAgLi4ucGF5bG9hZCxcbiAgICAgIHVzZXJJZDogc2Vzc2lvbi5zdWJcbiAgICB9KTtcblxuICAgIGF3YWl0IG1hcmtDYXJ0c1JlY292ZXJlZChzZXNzaW9uLnN1Yik7XG5cbiAgICByZXR1cm4ganNvblN1Y2Nlc3Mob3JkZXIsIDIwMSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGhhbmRsZUFwaUVycm9yKGVycm9yKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImhhbmRsZUFwaUVycm9yIiwianNvblN1Y2Nlc3MiLCJyZWFkSnNvbiIsInJlcXVpcmVBdXRoIiwiYXNzZXJ0UmF0ZUxpbWl0IiwibWFya0NhcnRzUmVjb3ZlcmVkIiwiY3JlYXRlT3JkZXIiLCJwYXJzZU9yZGVyUGF5bG9hZCIsIlBPU1QiLCJyZXF1ZXN0Iiwia2V5IiwibGltaXQiLCJ3aW5kb3dNcyIsInNlc3Npb24iLCJwYXlsb2FkIiwib3JkZXIiLCJ1c2VySWQiLCJzdWIiLCJlcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/orders/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/api.ts":
/*!************************!*\
  !*** ./src/lib/api.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApiError: () => (/* binding */ ApiError),\n/* harmony export */   handleApiError: () => (/* binding */ handleApiError),\n/* harmony export */   jsonError: () => (/* binding */ jsonError),\n/* harmony export */   jsonSuccess: () => (/* binding */ jsonSuccess),\n/* harmony export */   readJson: () => (/* binding */ readJson)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\nclass ApiError extends Error {\n    constructor(message, status = 400){\n        super(message);\n        this.status = status;\n    }\n}\nfunction jsonSuccess(data, status = 200) {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        data\n    }, {\n        status\n    });\n}\nfunction jsonError(message, status = 400) {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: message\n    }, {\n        status\n    });\n}\nasync function readJson(request) {\n    try {\n        return await request.json();\n    } catch  {\n        throw new ApiError(\"Invalid JSON body\", 400);\n    }\n}\nfunction handleApiError(error) {\n    if (error instanceof ApiError) {\n        return jsonError(error.message, error.status);\n    }\n    if (error instanceof Error) {\n        console.error(\"[API_ERROR]\", error);\n        return jsonError(\"Internal server error\", 500);\n    }\n    return jsonError(\"Internal server error\", 500);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2FwaS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBMkM7QUFFcEMsTUFBTUMsaUJBQWlCQztJQUc1QixZQUFZQyxPQUFlLEVBQUVDLFNBQVMsR0FBRyxDQUFFO1FBQ3pDLEtBQUssQ0FBQ0Q7UUFDTixJQUFJLENBQUNDLE1BQU0sR0FBR0E7SUFDaEI7QUFDRjtBQUVPLFNBQVNDLFlBQWVDLElBQU8sRUFBRUYsU0FBUyxHQUFHO0lBQ2xELE9BQU9KLHFEQUFZQSxDQUFDTyxJQUFJLENBQUM7UUFBRUQ7SUFBSyxHQUFHO1FBQUVGO0lBQU87QUFDOUM7QUFFTyxTQUFTSSxVQUFVTCxPQUFlLEVBQUVDLFNBQVMsR0FBRztJQUNyRCxPQUFPSixxREFBWUEsQ0FBQ08sSUFBSSxDQUFDO1FBQUVFLE9BQU9OO0lBQVEsR0FBRztRQUFFQztJQUFPO0FBQ3hEO0FBRU8sZUFBZU0sU0FBU0MsT0FBZ0I7SUFDN0MsSUFBSTtRQUNGLE9BQU8sTUFBTUEsUUFBUUosSUFBSTtJQUMzQixFQUFFLE9BQU07UUFDTixNQUFNLElBQUlOLFNBQVMscUJBQXFCO0lBQzFDO0FBQ0Y7QUFFTyxTQUFTVyxlQUFlSCxLQUFjO0lBQzNDLElBQUlBLGlCQUFpQlIsVUFBVTtRQUM3QixPQUFPTyxVQUFVQyxNQUFNTixPQUFPLEVBQUVNLE1BQU1MLE1BQU07SUFDOUM7SUFFQSxJQUFJSyxpQkFBaUJQLE9BQU87UUFDMUJXLFFBQVFKLEtBQUssQ0FBQyxlQUFlQTtRQUM3QixPQUFPRCxVQUFVLHlCQUF5QjtJQUM1QztJQUVBLE9BQU9BLFVBQVUseUJBQXlCO0FBQzVDIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2xpYi9hcGkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5cbmV4cG9ydCBjbGFzcyBBcGlFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgc3RhdHVzOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBzdGF0dXMgPSA0MDApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24ganNvblN1Y2Nlc3M8VD4oZGF0YTogVCwgc3RhdHVzID0gMjAwKSB7XG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGRhdGEgfSwgeyBzdGF0dXMgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBqc29uRXJyb3IobWVzc2FnZTogc3RyaW5nLCBzdGF0dXMgPSA0MDApIHtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IG1lc3NhZ2UgfSwgeyBzdGF0dXMgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWFkSnNvbihyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICB9IGNhdGNoIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJJbnZhbGlkIEpTT04gYm9keVwiLCA0MDApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVBcGlFcnJvcihlcnJvcjogdW5rbm93bikge1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcGlFcnJvcikge1xuICAgIHJldHVybiBqc29uRXJyb3IoZXJyb3IubWVzc2FnZSwgZXJyb3Iuc3RhdHVzKTtcbiAgfVxuXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltBUElfRVJST1JdXCIsIGVycm9yKTtcbiAgICByZXR1cm4ganNvbkVycm9yKFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIsIDUwMCk7XG4gIH1cblxuICByZXR1cm4ganNvbkVycm9yKFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIsIDUwMCk7XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiQXBpRXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJqc29uU3VjY2VzcyIsImRhdGEiLCJqc29uIiwianNvbkVycm9yIiwiZXJyb3IiLCJyZWFkSnNvbiIsInJlcXVlc3QiLCJoYW5kbGVBcGlFcnJvciIsImNvbnNvbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/api.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth/constants.ts":
/*!***********************************!*\
  !*** ./src/lib/auth/constants.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AFFILIATE_COOKIE_NAME: () => (/* binding */ AFFILIATE_COOKIE_NAME),\n/* harmony export */   AUTH_COOKIE_NAME: () => (/* binding */ AUTH_COOKIE_NAME),\n/* harmony export */   getAuthTokenTtlSeconds: () => (/* binding */ getAuthTokenTtlSeconds)\n/* harmony export */ });\nconst AUTH_COOKIE_NAME = \"livreo_session\";\nconst AFFILIATE_COOKIE_NAME = \"livreo_affiliate_ref\";\nfunction getAuthTokenTtlSeconds() {\n    return Number.parseInt(process.env.AUTH_TOKEN_TTL_SECONDS ?? \"604800\", 10);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgvY29uc3RhbnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFPLE1BQU1BLG1CQUFtQixpQkFBaUI7QUFDMUMsTUFBTUMsd0JBQXdCLHVCQUF1QjtBQUVyRCxTQUFTQztJQUNkLE9BQU9DLE9BQU9DLFFBQVEsQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxzQkFBc0IsSUFBSSxVQUFVO0FBQ3pFIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2xpYi9hdXRoL2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgQVVUSF9DT09LSUVfTkFNRSA9IFwibGl2cmVvX3Nlc3Npb25cIjtcbmV4cG9ydCBjb25zdCBBRkZJTElBVEVfQ09PS0lFX05BTUUgPSBcImxpdnJlb19hZmZpbGlhdGVfcmVmXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRoVG9rZW5UdGxTZWNvbmRzKCkge1xuICByZXR1cm4gTnVtYmVyLnBhcnNlSW50KHByb2Nlc3MuZW52LkFVVEhfVE9LRU5fVFRMX1NFQ09ORFMgPz8gXCI2MDQ4MDBcIiwgMTApO1xufVxuIl0sIm5hbWVzIjpbIkFVVEhfQ09PS0lFX05BTUUiLCJBRkZJTElBVEVfQ09PS0lFX05BTUUiLCJnZXRBdXRoVG9rZW5UdGxTZWNvbmRzIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJwcm9jZXNzIiwiZW52IiwiQVVUSF9UT0tFTl9UVExfU0VDT05EUyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth/constants.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth/crypto.ts":
/*!********************************!*\
  !*** ./src/lib/auth/crypto.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getBearerToken: () => (/* binding */ getBearerToken),\n/* harmony export */   getCookieToken: () => (/* binding */ getCookieToken),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   signSessionToken: () => (/* binding */ signSessionToken),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifySessionToken: () => (/* binding */ verifySessionToken)\n/* harmony export */ });\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:crypto */ \"node:crypto\");\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst scrypt = (0,node_util__WEBPACK_IMPORTED_MODULE_1__.promisify)(node_crypto__WEBPACK_IMPORTED_MODULE_0__.scrypt);\nconst HASH_PREFIX = \"scrypt\";\nasync function hashPassword(password) {\n    const salt = (0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.randomBytes)(16).toString(\"hex\");\n    const derived = await scrypt(password, salt, 64);\n    return `${HASH_PREFIX}$${salt}$${derived.toString(\"hex\")}`;\n}\nasync function verifyPassword(password, passwordHash) {\n    const [prefix, salt, storedHash] = passwordHash.split(\"$\");\n    if (prefix !== HASH_PREFIX || !salt || !storedHash) {\n        return false;\n    }\n    const derived = await scrypt(password, salt, 64);\n    const expected = Buffer.from(storedHash, \"hex\");\n    if (expected.length !== derived.length) {\n        return false;\n    }\n    return (0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.timingSafeEqual)(expected, derived);\n}\nfunction base64UrlEncode(value) {\n    return Buffer.from(value).toString(\"base64\").replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\nfunction base64UrlDecode(value) {\n    const normalized = value.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const padded = normalized + \"=\".repeat((4 - normalized.length % 4) % 4);\n    return Buffer.from(padded, \"base64\").toString(\"utf-8\");\n}\nfunction getAuthSecret() {\n    const secret = process.env.AUTH_SECRET ?? process.env.JWT_SECRET;\n    if (secret) {\n        return secret;\n    }\n    if (false) {}\n    return \"dev-only-insecure-secret\";\n}\nfunction signSessionToken(data) {\n    const now = Math.floor(Date.now() / 1000);\n    const ttl = Number.parseInt(process.env.AUTH_TOKEN_TTL_SECONDS ?? \"604800\", 10);\n    const header = {\n        alg: \"HS256\",\n        typ: \"JWT\"\n    };\n    const payload = {\n        ...data,\n        iat: now,\n        exp: now + ttl\n    };\n    const encodedHeader = base64UrlEncode(JSON.stringify(header));\n    const encodedPayload = base64UrlEncode(JSON.stringify(payload));\n    const raw = `${encodedHeader}.${encodedPayload}`;\n    const signature = (0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac)(\"sha256\", getAuthSecret()).update(raw).digest();\n    const encodedSignature = base64UrlEncode(signature);\n    return `${raw}.${encodedSignature}`;\n}\nfunction verifySessionToken(token) {\n    const [encodedHeader, encodedPayload, encodedSignature] = token.split(\".\");\n    if (!encodedHeader || !encodedPayload || !encodedSignature) {\n        return null;\n    }\n    const raw = `${encodedHeader}.${encodedPayload}`;\n    const expectedSignature = (0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.createHmac)(\"sha256\", getAuthSecret()).update(raw).digest();\n    const providedSignature = Buffer.from(encodedSignature.replace(/-/g, \"+\").replace(/_/g, \"/\"), \"base64\");\n    if (expectedSignature.length !== providedSignature.length || !(0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.timingSafeEqual)(expectedSignature, providedSignature)) {\n        return null;\n    }\n    try {\n        const payload = JSON.parse(base64UrlDecode(encodedPayload));\n        if (payload.exp <= Math.floor(Date.now() / 1000)) {\n            return null;\n        }\n        return payload;\n    } catch  {\n        return null;\n    }\n}\nfunction getBearerToken(request) {\n    const authHeader = request.headers.get(\"authorization\");\n    if (!authHeader) {\n        return null;\n    }\n    const [scheme, token] = authHeader.split(\" \");\n    if (scheme?.toLowerCase() !== \"bearer\" || !token) {\n        return null;\n    }\n    return token;\n}\nfunction getCookieToken(request, cookieName) {\n    const cookieHeader = request.headers.get(\"cookie\");\n    if (!cookieHeader) {\n        return null;\n    }\n    const cookies = cookieHeader.split(\";\").map((part)=>part.trim());\n    for (const cookie of cookies){\n        const [name, ...rest] = cookie.split(\"=\");\n        if (name === cookieName) {\n            return decodeURIComponent(rest.join(\"=\"));\n        }\n    }\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU87SUFDVDtJQUVBLE1BQU1DLFVBQVVELGFBQWExRCxLQUFLLENBQUMsS0FBSzRELEdBQUcsQ0FBQyxDQUFDQyxPQUFTQSxLQUFLQyxJQUFJO0lBQy9ELEtBQUssTUFBTUMsVUFBVUosUUFBUztRQUM1QixNQUFNLENBQUNLLE1BQU0sR0FBR0MsS0FBSyxHQUFHRixPQUFPL0QsS0FBSyxDQUFDO1FBQ3JDLElBQUlnRSxTQUFTUCxZQUFZO1lBQ3ZCLE9BQU9TLG1CQUFtQkQsS0FBS0UsSUFBSSxDQUFDO1FBQ3RDO0lBQ0Y7SUFFQSxPQUFPO0FBQ1QiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbGliL2F1dGgvY3J5cHRvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJhbmRvbUJ5dGVzLCBzY3J5cHQgYXMgc2NyeXB0Q2FsbGJhY2ssIHRpbWluZ1NhZmVFcXVhbCwgY3JlYXRlSG1hYyB9IGZyb20gXCJub2RlOmNyeXB0b1wiO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcIm5vZGU6dXRpbFwiO1xuXG5jb25zdCBzY3J5cHQgPSBwcm9taXNpZnkoc2NyeXB0Q2FsbGJhY2spO1xuY29uc3QgSEFTSF9QUkVGSVggPSBcInNjcnlwdFwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpIHtcbiAgY29uc3Qgc2FsdCA9IHJhbmRvbUJ5dGVzKDE2KS50b1N0cmluZyhcImhleFwiKTtcbiAgY29uc3QgZGVyaXZlZCA9IChhd2FpdCBzY3J5cHQocGFzc3dvcmQsIHNhbHQsIDY0KSkgYXMgQnVmZmVyO1xuICByZXR1cm4gYCR7SEFTSF9QUkVGSVh9JCR7c2FsdH0kJHtkZXJpdmVkLnRvU3RyaW5nKFwiaGV4XCIpfWA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCBwYXNzd29yZEhhc2g6IHN0cmluZykge1xuICBjb25zdCBbcHJlZml4LCBzYWx0LCBzdG9yZWRIYXNoXSA9IHBhc3N3b3JkSGFzaC5zcGxpdChcIiRcIik7XG4gIGlmIChwcmVmaXggIT09IEhBU0hfUFJFRklYIHx8ICFzYWx0IHx8ICFzdG9yZWRIYXNoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgZGVyaXZlZCA9IChhd2FpdCBzY3J5cHQocGFzc3dvcmQsIHNhbHQsIDY0KSkgYXMgQnVmZmVyO1xuICBjb25zdCBleHBlY3RlZCA9IEJ1ZmZlci5mcm9tKHN0b3JlZEhhc2gsIFwiaGV4XCIpO1xuXG4gIGlmIChleHBlY3RlZC5sZW5ndGggIT09IGRlcml2ZWQubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRpbWluZ1NhZmVFcXVhbChleHBlY3RlZCwgZGVyaXZlZCk7XG59XG5cbmZ1bmN0aW9uIGJhc2U2NFVybEVuY29kZSh2YWx1ZTogc3RyaW5nIHwgQnVmZmVyKSB7XG4gIHJldHVybiBCdWZmZXIuZnJvbSh2YWx1ZSlcbiAgICAudG9TdHJpbmcoXCJiYXNlNjRcIilcbiAgICAucmVwbGFjZSgvPS9nLCBcIlwiKVxuICAgIC5yZXBsYWNlKC9cXCsvZywgXCItXCIpXG4gICAgLnJlcGxhY2UoL1xcLy9nLCBcIl9cIik7XG59XG5cbmZ1bmN0aW9uIGJhc2U2NFVybERlY29kZSh2YWx1ZTogc3RyaW5nKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSB2YWx1ZS5yZXBsYWNlKC8tL2csIFwiK1wiKS5yZXBsYWNlKC9fL2csIFwiL1wiKTtcbiAgY29uc3QgcGFkZGVkID0gbm9ybWFsaXplZCArIFwiPVwiLnJlcGVhdCgoNCAtIChub3JtYWxpemVkLmxlbmd0aCAlIDQpKSAlIDQpO1xuICByZXR1cm4gQnVmZmVyLmZyb20ocGFkZGVkLCBcImJhc2U2NFwiKS50b1N0cmluZyhcInV0Zi04XCIpO1xufVxuXG5leHBvcnQgdHlwZSBTZXNzaW9uUGF5bG9hZCA9IHtcbiAgc3ViOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHJvbGU6IFwiY2xpZW50XCIgfCBcImFkbWluXCI7XG4gIG5hbWU6IHN0cmluZztcbiAgaWF0OiBudW1iZXI7XG4gIGV4cDogbnVtYmVyO1xufTtcblxuZnVuY3Rpb24gZ2V0QXV0aFNlY3JldCgpIHtcbiAgY29uc3Qgc2VjcmV0ID0gcHJvY2Vzcy5lbnYuQVVUSF9TRUNSRVQgPz8gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVDtcblxuICBpZiAoc2VjcmV0KSB7XG4gICAgcmV0dXJuIHNlY3JldDtcbiAgfVxuXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIEFVVEhfU0VDUkVUIG9yIEpXVF9TRUNSRVRcIik7XG4gIH1cblxuICByZXR1cm4gXCJkZXYtb25seS1pbnNlY3VyZS1zZWNyZXRcIjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpZ25TZXNzaW9uVG9rZW4oZGF0YTogT21pdDxTZXNzaW9uUGF5bG9hZCwgXCJpYXRcIiB8IFwiZXhwXCI+KSB7XG4gIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xuICBjb25zdCB0dGwgPSBOdW1iZXIucGFyc2VJbnQocHJvY2Vzcy5lbnYuQVVUSF9UT0tFTl9UVExfU0VDT05EUyA/PyBcIjYwNDgwMFwiLCAxMCk7XG5cbiAgY29uc3QgaGVhZGVyID0geyBhbGc6IFwiSFMyNTZcIiwgdHlwOiBcIkpXVFwiIH07XG4gIGNvbnN0IHBheWxvYWQ6IFNlc3Npb25QYXlsb2FkID0ge1xuICAgIC4uLmRhdGEsXG4gICAgaWF0OiBub3csXG4gICAgZXhwOiBub3cgKyB0dGxcbiAgfTtcblxuICBjb25zdCBlbmNvZGVkSGVhZGVyID0gYmFzZTY0VXJsRW5jb2RlKEpTT04uc3RyaW5naWZ5KGhlYWRlcikpO1xuICBjb25zdCBlbmNvZGVkUGF5bG9hZCA9IGJhc2U2NFVybEVuY29kZShKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7XG4gIGNvbnN0IHJhdyA9IGAke2VuY29kZWRIZWFkZXJ9LiR7ZW5jb2RlZFBheWxvYWR9YDtcblxuICBjb25zdCBzaWduYXR1cmUgPSBjcmVhdGVIbWFjKFwic2hhMjU2XCIsIGdldEF1dGhTZWNyZXQoKSkudXBkYXRlKHJhdykuZGlnZXN0KCk7XG4gIGNvbnN0IGVuY29kZWRTaWduYXR1cmUgPSBiYXNlNjRVcmxFbmNvZGUoc2lnbmF0dXJlKTtcblxuICByZXR1cm4gYCR7cmF3fS4ke2VuY29kZWRTaWduYXR1cmV9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeVNlc3Npb25Ub2tlbih0b2tlbjogc3RyaW5nKTogU2Vzc2lvblBheWxvYWQgfCBudWxsIHtcbiAgY29uc3QgW2VuY29kZWRIZWFkZXIsIGVuY29kZWRQYXlsb2FkLCBlbmNvZGVkU2lnbmF0dXJlXSA9IHRva2VuLnNwbGl0KFwiLlwiKTtcblxuICBpZiAoIWVuY29kZWRIZWFkZXIgfHwgIWVuY29kZWRQYXlsb2FkIHx8ICFlbmNvZGVkU2lnbmF0dXJlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByYXcgPSBgJHtlbmNvZGVkSGVhZGVyfS4ke2VuY29kZWRQYXlsb2FkfWA7XG4gIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gY3JlYXRlSG1hYyhcInNoYTI1NlwiLCBnZXRBdXRoU2VjcmV0KCkpLnVwZGF0ZShyYXcpLmRpZ2VzdCgpO1xuICBjb25zdCBwcm92aWRlZFNpZ25hdHVyZSA9IEJ1ZmZlci5mcm9tKFxuICAgIGVuY29kZWRTaWduYXR1cmUucmVwbGFjZSgvLS9nLCBcIitcIikucmVwbGFjZSgvXy9nLCBcIi9cIiksXG4gICAgXCJiYXNlNjRcIlxuICApO1xuXG4gIGlmIChcbiAgICBleHBlY3RlZFNpZ25hdHVyZS5sZW5ndGggIT09IHByb3ZpZGVkU2lnbmF0dXJlLmxlbmd0aCB8fFxuICAgICF0aW1pbmdTYWZlRXF1YWwoZXhwZWN0ZWRTaWduYXR1cmUsIHByb3ZpZGVkU2lnbmF0dXJlKVxuICApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UoYmFzZTY0VXJsRGVjb2RlKGVuY29kZWRQYXlsb2FkKSkgYXMgU2Vzc2lvblBheWxvYWQ7XG5cbiAgICBpZiAocGF5bG9hZC5leHAgPD0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBwYXlsb2FkO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmVhcmVyVG9rZW4ocmVxdWVzdDogUmVxdWVzdCkge1xuICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldChcImF1dGhvcml6YXRpb25cIik7XG4gIGlmICghYXV0aEhlYWRlcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgW3NjaGVtZSwgdG9rZW5dID0gYXV0aEhlYWRlci5zcGxpdChcIiBcIik7XG4gIGlmIChzY2hlbWU/LnRvTG93ZXJDYXNlKCkgIT09IFwiYmVhcmVyXCIgfHwgIXRva2VuKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gdG9rZW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb29raWVUb2tlbihyZXF1ZXN0OiBSZXF1ZXN0LCBjb29raWVOYW1lOiBzdHJpbmcpIHtcbiAgY29uc3QgY29va2llSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldChcImNvb2tpZVwiKTtcbiAgaWYgKCFjb29raWVIZWFkZXIpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGNvb2tpZXMgPSBjb29raWVIZWFkZXIuc3BsaXQoXCI7XCIpLm1hcCgocGFydCkgPT4gcGFydC50cmltKCkpO1xuICBmb3IgKGNvbnN0IGNvb2tpZSBvZiBjb29raWVzKSB7XG4gICAgY29uc3QgW25hbWUsIC4uLnJlc3RdID0gY29va2llLnNwbGl0KFwiPVwiKTtcbiAgICBpZiAobmFtZSA9PT0gY29va2llTmFtZSkge1xuICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN0LmpvaW4oXCI9XCIpKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cbiJdLCJuYW1lcyI6WyJyYW5kb21CeXRlcyIsInNjcnlwdCIsInNjcnlwdENhbGxiYWNrIiwidGltaW5nU2FmZUVxdWFsIiwiY3JlYXRlSG1hYyIsInByb21pc2lmeSIsIkhBU0hfUFJFRklYIiwiaGFzaFBhc3N3b3JkIiwicGFzc3dvcmQiLCJzYWx0IiwidG9TdHJpbmciLCJkZXJpdmVkIiwidmVyaWZ5UGFzc3dvcmQiLCJwYXNzd29yZEhhc2giLCJwcmVmaXgiLCJzdG9yZWRIYXNoIiwic3BsaXQiLCJleHBlY3RlZCIsIkJ1ZmZlciIsImZyb20iLCJsZW5ndGgiLCJiYXNlNjRVcmxFbmNvZGUiLCJ2YWx1ZSIsInJlcGxhY2UiLCJiYXNlNjRVcmxEZWNvZGUiLCJub3JtYWxpemVkIiwicGFkZGVkIiwicmVwZWF0IiwiZ2V0QXV0aFNlY3JldCIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJBVVRIX1NFQ1JFVCIsIkpXVF9TRUNSRVQiLCJFcnJvciIsInNpZ25TZXNzaW9uVG9rZW4iLCJkYXRhIiwibm93IiwiTWF0aCIsImZsb29yIiwiRGF0ZSIsInR0bCIsIk51bWJlciIsInBhcnNlSW50IiwiQVVUSF9UT0tFTl9UVExfU0VDT05EUyIsImhlYWRlciIsImFsZyIsInR5cCIsInBheWxvYWQiLCJpYXQiLCJleHAiLCJlbmNvZGVkSGVhZGVyIiwiSlNPTiIsInN0cmluZ2lmeSIsImVuY29kZWRQYXlsb2FkIiwicmF3Iiwic2lnbmF0dXJlIiwidXBkYXRlIiwiZGlnZXN0IiwiZW5jb2RlZFNpZ25hdHVyZSIsInZlcmlmeVNlc3Npb25Ub2tlbiIsInRva2VuIiwiZXhwZWN0ZWRTaWduYXR1cmUiLCJwcm92aWRlZFNpZ25hdHVyZSIsInBhcnNlIiwiZ2V0QmVhcmVyVG9rZW4iLCJyZXF1ZXN0IiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzY2hlbWUiLCJ0b0xvd2VyQ2FzZSIsImdldENvb2tpZVRva2VuIiwiY29va2llTmFtZSIsImNvb2tpZUhlYWRlciIsImNvb2tpZXMiLCJtYXAiLCJwYXJ0IiwidHJpbSIsImNvb2tpZSIsIm5hbWUiLCJyZXN0IiwiZGVjb2RlVVJJQ29tcG9uZW50Iiwiam9pbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth/crypto.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth/session.ts":
/*!*********************************!*\
  !*** ./src/lib/auth/session.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   optionalAuth: () => (/* binding */ optionalAuth),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n/* harmony import */ var _lib_auth_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/constants */ \"(rsc)/./src/lib/auth/constants.ts\");\n/* harmony import */ var _lib_auth_crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth/crypto */ \"(rsc)/./src/lib/auth/crypto.ts\");\n\n\n\nfunction getSessionToken(request) {\n    return (0,_lib_auth_crypto__WEBPACK_IMPORTED_MODULE_2__.getBearerToken)(request) ?? (0,_lib_auth_crypto__WEBPACK_IMPORTED_MODULE_2__.getCookieToken)(request, _lib_auth_constants__WEBPACK_IMPORTED_MODULE_1__.AUTH_COOKIE_NAME);\n}\nfunction requireAuth(request) {\n    const token = getSessionToken(request);\n    if (!token) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Missing authentication token\", 401);\n    }\n    const session = (0,_lib_auth_crypto__WEBPACK_IMPORTED_MODULE_2__.verifySessionToken)(token);\n    if (!session) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Invalid or expired token\", 401);\n    }\n    return session;\n}\nfunction optionalAuth(request) {\n    const token = getSessionToken(request);\n    if (!token) {\n        return null;\n    }\n    return (0,_lib_auth_crypto__WEBPACK_IMPORTED_MODULE_2__.verifySessionToken)(token);\n}\nfunction requireRole(session, roles) {\n    if (!roles.includes(session.role)) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Forbidden\", 403);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgvc2Vzc2lvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBcUM7QUFDbUI7QUFNN0I7QUFFM0IsU0FBU0ssZ0JBQWdCQyxPQUFnQjtJQUN2QyxPQUFPSixnRUFBY0EsQ0FBQ0ksWUFBWUgsZ0VBQWNBLENBQUNHLFNBQVNMLGlFQUFnQkE7QUFDNUU7QUFFTyxTQUFTTSxZQUFZRCxPQUFnQjtJQUMxQyxNQUFNRSxRQUFRSCxnQkFBZ0JDO0lBQzlCLElBQUksQ0FBQ0UsT0FBTztRQUNWLE1BQU0sSUFBSVIsOENBQVFBLENBQUMsZ0NBQWdDO0lBQ3JEO0lBRUEsTUFBTVMsVUFBVUwsb0VBQWtCQSxDQUFDSTtJQUNuQyxJQUFJLENBQUNDLFNBQVM7UUFDWixNQUFNLElBQUlULDhDQUFRQSxDQUFDLDRCQUE0QjtJQUNqRDtJQUVBLE9BQU9TO0FBQ1Q7QUFFTyxTQUFTQyxhQUFhSixPQUFnQjtJQUMzQyxNQUFNRSxRQUFRSCxnQkFBZ0JDO0lBQzlCLElBQUksQ0FBQ0UsT0FBTztRQUNWLE9BQU87SUFDVDtJQUVBLE9BQU9KLG9FQUFrQkEsQ0FBQ0k7QUFDNUI7QUFFTyxTQUFTRyxZQUFZRixPQUF1QixFQUFFRyxLQUFvQztJQUN2RixJQUFJLENBQUNBLE1BQU1DLFFBQVEsQ0FBQ0osUUFBUUssSUFBSSxHQUFHO1FBQ2pDLE1BQU0sSUFBSWQsOENBQVFBLENBQUMsYUFBYTtJQUNsQztBQUNGIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2xpYi9hdXRoL3Nlc3Npb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBpRXJyb3IgfSBmcm9tIFwiQC9saWIvYXBpXCI7XG5pbXBvcnQgeyBBVVRIX0NPT0tJRV9OQU1FIH0gZnJvbSBcIkAvbGliL2F1dGgvY29uc3RhbnRzXCI7XG5pbXBvcnQge1xuICBnZXRCZWFyZXJUb2tlbixcbiAgZ2V0Q29va2llVG9rZW4sXG4gIHZlcmlmeVNlc3Npb25Ub2tlbixcbiAgdHlwZSBTZXNzaW9uUGF5bG9hZFxufSBmcm9tIFwiQC9saWIvYXV0aC9jcnlwdG9cIjtcblxuZnVuY3Rpb24gZ2V0U2Vzc2lvblRva2VuKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgcmV0dXJuIGdldEJlYXJlclRva2VuKHJlcXVlc3QpID8/IGdldENvb2tpZVRva2VuKHJlcXVlc3QsIEFVVEhfQ09PS0lFX05BTUUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZUF1dGgocmVxdWVzdDogUmVxdWVzdCk6IFNlc3Npb25QYXlsb2FkIHtcbiAgY29uc3QgdG9rZW4gPSBnZXRTZXNzaW9uVG9rZW4ocmVxdWVzdCk7XG4gIGlmICghdG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJNaXNzaW5nIGF1dGhlbnRpY2F0aW9uIHRva2VuXCIsIDQwMSk7XG4gIH1cblxuICBjb25zdCBzZXNzaW9uID0gdmVyaWZ5U2Vzc2lvblRva2VuKHRva2VuKTtcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiSW52YWxpZCBvciBleHBpcmVkIHRva2VuXCIsIDQwMSk7XG4gIH1cblxuICByZXR1cm4gc2Vzc2lvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9wdGlvbmFsQXV0aChyZXF1ZXN0OiBSZXF1ZXN0KTogU2Vzc2lvblBheWxvYWQgfCBudWxsIHtcbiAgY29uc3QgdG9rZW4gPSBnZXRTZXNzaW9uVG9rZW4ocmVxdWVzdCk7XG4gIGlmICghdG9rZW4pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB2ZXJpZnlTZXNzaW9uVG9rZW4odG9rZW4pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZVJvbGUoc2Vzc2lvbjogU2Vzc2lvblBheWxvYWQsIHJvbGVzOiBBcnJheTxTZXNzaW9uUGF5bG9hZFtcInJvbGVcIl0+KSB7XG4gIGlmICghcm9sZXMuaW5jbHVkZXMoc2Vzc2lvbi5yb2xlKSkge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkZvcmJpZGRlblwiLCA0MDMpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiQXBpRXJyb3IiLCJBVVRIX0NPT0tJRV9OQU1FIiwiZ2V0QmVhcmVyVG9rZW4iLCJnZXRDb29raWVUb2tlbiIsInZlcmlmeVNlc3Npb25Ub2tlbiIsImdldFNlc3Npb25Ub2tlbiIsInJlcXVlc3QiLCJyZXF1aXJlQXV0aCIsInRva2VuIiwic2Vzc2lvbiIsIm9wdGlvbmFsQXV0aCIsInJlcXVpcmVSb2xlIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth/session.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/mongodb.ts":
/*!****************************!*\
  !*** ./src/lib/mongodb.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nconst globalForMongoose = global;\nconst cached = globalForMongoose.mongoose ?? {\n    conn: null,\n    promise: null\n};\nglobalForMongoose.mongoose = cached;\nasync function connectToDatabase() {\n    if (!MONGODB_URI) {\n        throw new Error(\"Missing MONGODB_URI in environment\");\n    }\n    if (cached.conn) {\n        return cached.conn;\n    }\n    if (!cached.promise) {\n        cached.promise = mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(MONGODB_URI, {\n            bufferCommands: false\n        });\n    }\n    cached.conn = await cached.promise;\n    return cached.conn;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL21vbmdvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWdDO0FBRWhDLE1BQU1DLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0YsV0FBVztBQU8zQyxNQUFNRyxvQkFBb0JDO0FBSTFCLE1BQU1DLFNBQVNGLGtCQUFrQkosUUFBUSxJQUFJO0lBQUVPLE1BQU07SUFBTUMsU0FBUztBQUFLO0FBRXpFSixrQkFBa0JKLFFBQVEsR0FBR007QUFFdEIsZUFBZUc7SUFDcEIsSUFBSSxDQUFDUixhQUFhO1FBQ2hCLE1BQU0sSUFBSVMsTUFBTTtJQUNsQjtJQUNBLElBQUlKLE9BQU9DLElBQUksRUFBRTtRQUNmLE9BQU9ELE9BQU9DLElBQUk7SUFDcEI7SUFFQSxJQUFJLENBQUNELE9BQU9FLE9BQU8sRUFBRTtRQUNuQkYsT0FBT0UsT0FBTyxHQUFHUix1REFBZ0IsQ0FBQ0MsYUFBYTtZQUM3Q1csZ0JBQWdCO1FBQ2xCO0lBQ0Y7SUFFQU4sT0FBT0MsSUFBSSxHQUFHLE1BQU1ELE9BQU9FLE9BQU87SUFDbEMsT0FBT0YsT0FBT0MsSUFBSTtBQUNwQiIsInNvdXJjZXMiOlsiL2hvbWUvbW91Y2hhcmlmL0RvY3VtZW50cy9JQUktQ09VUlMvUGVyc29uYWxQcm9qZWN0L1Byb2pldFYvTGl2cmVvL3NyYy9saWIvbW9uZ29kYi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbmNvbnN0IE1PTkdPREJfVVJJID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkk7XG5cbnR5cGUgTW9uZ29vc2VDYWNoZSA9IHtcbiAgY29ubjogdHlwZW9mIG1vbmdvb3NlIHwgbnVsbDtcbiAgcHJvbWlzZTogUHJvbWlzZTx0eXBlb2YgbW9uZ29vc2U+IHwgbnVsbDtcbn07XG5cbmNvbnN0IGdsb2JhbEZvck1vbmdvb3NlID0gZ2xvYmFsIGFzIHR5cGVvZiBnbG9iYWxUaGlzICYge1xuICBtb25nb29zZT86IE1vbmdvb3NlQ2FjaGU7XG59O1xuXG5jb25zdCBjYWNoZWQgPSBnbG9iYWxGb3JNb25nb29zZS5tb25nb29zZSA/PyB7IGNvbm46IG51bGwsIHByb21pc2U6IG51bGwgfTtcblxuZ2xvYmFsRm9yTW9uZ29vc2UubW9uZ29vc2UgPSBjYWNoZWQ7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpIHtcbiAgaWYgKCFNT05HT0RCX1VSSSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgTU9OR09EQl9VUkkgaW4gZW52aXJvbm1lbnRcIik7XG4gIH1cbiAgaWYgKGNhY2hlZC5jb25uKSB7XG4gICAgcmV0dXJuIGNhY2hlZC5jb25uO1xuICB9XG5cbiAgaWYgKCFjYWNoZWQucHJvbWlzZSkge1xuICAgIGNhY2hlZC5wcm9taXNlID0gbW9uZ29vc2UuY29ubmVjdChNT05HT0RCX1VSSSwge1xuICAgICAgYnVmZmVyQ29tbWFuZHM6IGZhbHNlXG4gICAgfSk7XG4gIH1cblxuICBjYWNoZWQuY29ubiA9IGF3YWl0IGNhY2hlZC5wcm9taXNlO1xuICByZXR1cm4gY2FjaGVkLmNvbm47XG59XG5cblxuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiTU9OR09EQl9VUkkiLCJwcm9jZXNzIiwiZW52IiwiZ2xvYmFsRm9yTW9uZ29vc2UiLCJnbG9iYWwiLCJjYWNoZWQiLCJjb25uIiwicHJvbWlzZSIsImNvbm5lY3RUb0RhdGFiYXNlIiwiRXJyb3IiLCJjb25uZWN0IiwiYnVmZmVyQ29tbWFuZHMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/mongodb.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/security/rateLimit.ts":
/*!***************************************!*\
  !*** ./src/lib/security/rateLimit.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   assertRateLimit: () => (/* binding */ assertRateLimit)\n/* harmony export */ });\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n\nconst buckets = new Map();\nfunction getClientIdentifier(request) {\n    const forwardedFor = request.headers.get(\"x-forwarded-for\");\n    const ip = forwardedFor?.split(\",\")[0]?.trim() || request.headers.get(\"x-real-ip\") || \"unknown\";\n    return ip;\n}\nfunction assertRateLimit(params) {\n    const identifier = getClientIdentifier(params.request);\n    const bucketKey = `${params.key}:${identifier}`;\n    const now = Date.now();\n    const existing = buckets.get(bucketKey);\n    if (!existing || existing.resetAt <= now) {\n        buckets.set(bucketKey, {\n            count: 1,\n            resetAt: now + params.windowMs\n        });\n        return;\n    }\n    if (existing.count >= params.limit) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(params.message ?? \"Too many requests\", 429);\n    }\n    existing.count += 1;\n    buckets.set(bucketKey, existing);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlY3VyaXR5L3JhdGVMaW1pdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFxQztBQU9yQyxNQUFNQyxVQUFVLElBQUlDO0FBRXBCLFNBQVNDLG9CQUFvQkMsT0FBZ0I7SUFDM0MsTUFBTUMsZUFBZUQsUUFBUUUsT0FBTyxDQUFDQyxHQUFHLENBQUM7SUFDekMsTUFBTUMsS0FBS0gsY0FBY0ksTUFBTSxJQUFJLENBQUMsRUFBRSxFQUFFQyxVQUFVTixRQUFRRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxnQkFBZ0I7SUFDdEYsT0FBT0M7QUFDVDtBQUVPLFNBQVNHLGdCQUFnQkMsTUFNL0I7SUFDQyxNQUFNQyxhQUFhVixvQkFBb0JTLE9BQU9SLE9BQU87SUFDckQsTUFBTVUsWUFBWSxHQUFHRixPQUFPRyxHQUFHLENBQUMsQ0FBQyxFQUFFRixZQUFZO0lBQy9DLE1BQU1HLE1BQU1DLEtBQUtELEdBQUc7SUFFcEIsTUFBTUUsV0FBV2pCLFFBQVFNLEdBQUcsQ0FBQ087SUFDN0IsSUFBSSxDQUFDSSxZQUFZQSxTQUFTQyxPQUFPLElBQUlILEtBQUs7UUFDeENmLFFBQVFtQixHQUFHLENBQUNOLFdBQVc7WUFBRU8sT0FBTztZQUFHRixTQUFTSCxNQUFNSixPQUFPVSxRQUFRO1FBQUM7UUFDbEU7SUFDRjtJQUVBLElBQUlKLFNBQVNHLEtBQUssSUFBSVQsT0FBT1csS0FBSyxFQUFFO1FBQ2xDLE1BQU0sSUFBSXZCLDhDQUFRQSxDQUFDWSxPQUFPWSxPQUFPLElBQUkscUJBQXFCO0lBQzVEO0lBRUFOLFNBQVNHLEtBQUssSUFBSTtJQUNsQnBCLFFBQVFtQixHQUFHLENBQUNOLFdBQVdJO0FBQ3pCIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2xpYi9zZWN1cml0eS9yYXRlTGltaXQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBpRXJyb3IgfSBmcm9tIFwiQC9saWIvYXBpXCI7XG5cbnR5cGUgQnVja2V0ID0ge1xuICBjb3VudDogbnVtYmVyO1xuICByZXNldEF0OiBudW1iZXI7XG59O1xuXG5jb25zdCBidWNrZXRzID0gbmV3IE1hcDxzdHJpbmcsIEJ1Y2tldD4oKTtcblxuZnVuY3Rpb24gZ2V0Q2xpZW50SWRlbnRpZmllcihyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIGNvbnN0IGZvcndhcmRlZEZvciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1mb3JcIik7XG4gIGNvbnN0IGlwID0gZm9yd2FyZGVkRm9yPy5zcGxpdChcIixcIilbMF0/LnRyaW0oKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KFwieC1yZWFsLWlwXCIpIHx8IFwidW5rbm93blwiO1xuICByZXR1cm4gaXA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRSYXRlTGltaXQocGFyYW1zOiB7XG4gIHJlcXVlc3Q6IFJlcXVlc3Q7XG4gIGtleTogc3RyaW5nO1xuICBsaW1pdDogbnVtYmVyO1xuICB3aW5kb3dNczogbnVtYmVyO1xuICBtZXNzYWdlPzogc3RyaW5nO1xufSkge1xuICBjb25zdCBpZGVudGlmaWVyID0gZ2V0Q2xpZW50SWRlbnRpZmllcihwYXJhbXMucmVxdWVzdCk7XG4gIGNvbnN0IGJ1Y2tldEtleSA9IGAke3BhcmFtcy5rZXl9OiR7aWRlbnRpZmllcn1gO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gIGNvbnN0IGV4aXN0aW5nID0gYnVja2V0cy5nZXQoYnVja2V0S2V5KTtcbiAgaWYgKCFleGlzdGluZyB8fCBleGlzdGluZy5yZXNldEF0IDw9IG5vdykge1xuICAgIGJ1Y2tldHMuc2V0KGJ1Y2tldEtleSwgeyBjb3VudDogMSwgcmVzZXRBdDogbm93ICsgcGFyYW1zLndpbmRvd01zIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChleGlzdGluZy5jb3VudCA+PSBwYXJhbXMubGltaXQpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IocGFyYW1zLm1lc3NhZ2UgPz8gXCJUb28gbWFueSByZXF1ZXN0c1wiLCA0MjkpO1xuICB9XG5cbiAgZXhpc3RpbmcuY291bnQgKz0gMTtcbiAgYnVja2V0cy5zZXQoYnVja2V0S2V5LCBleGlzdGluZyk7XG59XG4iXSwibmFtZXMiOlsiQXBpRXJyb3IiLCJidWNrZXRzIiwiTWFwIiwiZ2V0Q2xpZW50SWRlbnRpZmllciIsInJlcXVlc3QiLCJmb3J3YXJkZWRGb3IiLCJoZWFkZXJzIiwiZ2V0IiwiaXAiLCJzcGxpdCIsInRyaW0iLCJhc3NlcnRSYXRlTGltaXQiLCJwYXJhbXMiLCJpZGVudGlmaWVyIiwiYnVja2V0S2V5Iiwia2V5Iiwibm93IiwiRGF0ZSIsImV4aXN0aW5nIiwicmVzZXRBdCIsInNldCIsImNvdW50Iiwid2luZG93TXMiLCJsaW1pdCIsIm1lc3NhZ2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/security/rateLimit.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/invoiceService.ts":
/*!********************************************!*\
  !*** ./src/lib/services/invoiceService.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateInvoicePdf: () => (/* binding */ generateInvoicePdf)\n/* harmony export */ });\nfunction escapePdfText(value) {\n    return value.replace(/\\\\/g, \"\\\\\\\\\").replace(/\\(/g, \"\\\\(\").replace(/\\)/g, \"\\\\)\");\n}\nfunction buildSimplePdf(lines) {\n    let y = 800;\n    const content = lines.map((line)=>{\n        const safe = escapePdfText(line);\n        const out = `BT /F1 12 Tf 50 ${y} Td (${safe}) Tj ET`;\n        y -= 18;\n        return out;\n    }).join(\"\\n\");\n    const objects = [];\n    objects.push(\"1 0 obj << /Type /Catalog /Pages 2 0 R >> endobj\");\n    objects.push(\"2 0 obj << /Type /Pages /Kids [3 0 R] /Count 1 >> endobj\");\n    objects.push(\"3 0 obj << /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Resources << /Font << /F1 5 0 R >> >> /Contents 4 0 R >> endobj\");\n    objects.push(`4 0 obj << /Length ${Buffer.byteLength(content, \"utf8\")} >> stream\\n${content}\\nendstream endobj`);\n    objects.push(\"5 0 obj << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> endobj\");\n    let body = \"%PDF-1.4\\n\";\n    const offsets = [\n        0\n    ];\n    for (const obj of objects){\n        offsets.push(Buffer.byteLength(body, \"utf8\"));\n        body += `${obj}\\n`;\n    }\n    const xrefStart = Buffer.byteLength(body, \"utf8\");\n    body += `xref\\n0 ${objects.length + 1}\\n`;\n    body += \"0000000000 65535 f \\n\";\n    for(let index = 1; index <= objects.length; index += 1){\n        body += `${String(offsets[index]).padStart(10, \"0\")} 00000 n \\n`;\n    }\n    body += `trailer << /Size ${objects.length + 1} /Root 1 0 R >>\\nstartxref\\n${xrefStart}\\n%%EOF`;\n    return Buffer.from(body, \"utf8\");\n}\nfunction generateInvoicePdf(params) {\n    const lines = [\n        \"SENAME EDITIONS - FACTURE\",\n        `Facture: ${params.invoiceNumber}`,\n        `Commande: ${params.orderId}`,\n        `Date: ${params.createdAt.toISOString()}`,\n        `Client: ${params.customerName} <${params.customerEmail}>`,\n        `Type de vente: ${params.saleType}`,\n        `Methode de paiement: ${params.paymentMethod}`,\n        \"---------------------------------------------\"\n    ];\n    for (const item of params.items){\n        const title = item.title ?? \"Ouvrage\";\n        const subtotal = item.unitPrice * item.quantity;\n        lines.push(`${title} x${item.quantity} @ ${item.unitPrice.toFixed(2)} EUR = ${subtotal.toFixed(2)} EUR`);\n    }\n    lines.push(\"---------------------------------------------\");\n    lines.push(`TOTAL: ${params.total.toFixed(2)} EUR`);\n    lines.push(\"Merci pour votre achat.\");\n    return buildSimplePdf(lines);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL2ludm9pY2VTZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFFQSxTQUFTQSxjQUFjQyxLQUFhO0lBQ2xDLE9BQU9BLE1BQU1DLE9BQU8sQ0FBQyxPQUFPLFFBQVFBLE9BQU8sQ0FBQyxPQUFPLE9BQU9BLE9BQU8sQ0FBQyxPQUFPO0FBQzNFO0FBRUEsU0FBU0MsZUFBZUMsS0FBZTtJQUNyQyxJQUFJQyxJQUFJO0lBQ1IsTUFBTUMsVUFBVUYsTUFDYkcsR0FBRyxDQUFDLENBQUNDO1FBQ0osTUFBTUMsT0FBT1QsY0FBY1E7UUFDM0IsTUFBTUUsTUFBTSxDQUFDLGdCQUFnQixFQUFFTCxFQUFFLEtBQUssRUFBRUksS0FBSyxPQUFPLENBQUM7UUFDckRKLEtBQUs7UUFDTCxPQUFPSztJQUNULEdBQ0NDLElBQUksQ0FBQztJQUVSLE1BQU1DLFVBQW9CLEVBQUU7SUFDNUJBLFFBQVFDLElBQUksQ0FBQztJQUNiRCxRQUFRQyxJQUFJLENBQUM7SUFDYkQsUUFBUUMsSUFBSSxDQUNWO0lBRUZELFFBQVFDLElBQUksQ0FDVixDQUFDLG1CQUFtQixFQUFFQyxPQUFPQyxVQUFVLENBQUNULFNBQVMsUUFBUSxZQUFZLEVBQUVBLFFBQVEsa0JBQWtCLENBQUM7SUFFcEdNLFFBQVFDLElBQUksQ0FBQztJQUViLElBQUlHLE9BQU87SUFDWCxNQUFNQyxVQUFVO1FBQUM7S0FBRTtJQUNuQixLQUFLLE1BQU1DLE9BQU9OLFFBQVM7UUFDekJLLFFBQVFKLElBQUksQ0FBQ0MsT0FBT0MsVUFBVSxDQUFDQyxNQUFNO1FBQ3JDQSxRQUFRLEdBQUdFLElBQUksRUFBRSxDQUFDO0lBQ3BCO0lBRUEsTUFBTUMsWUFBWUwsT0FBT0MsVUFBVSxDQUFDQyxNQUFNO0lBQzFDQSxRQUFRLENBQUMsUUFBUSxFQUFFSixRQUFRUSxNQUFNLEdBQUcsRUFBRSxFQUFFLENBQUM7SUFDekNKLFFBQVE7SUFDUixJQUFLLElBQUlLLFFBQVEsR0FBR0EsU0FBU1QsUUFBUVEsTUFBTSxFQUFFQyxTQUFTLEVBQUc7UUFDdkRMLFFBQVEsR0FBR00sT0FBT0wsT0FBTyxDQUFDSSxNQUFNLEVBQUVFLFFBQVEsQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFDO0lBQ2xFO0lBRUFQLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRUosUUFBUVEsTUFBTSxHQUFHLEVBQUUsNEJBQTRCLEVBQUVELFVBQVUsT0FBTyxDQUFDO0lBQy9GLE9BQU9MLE9BQU9VLElBQUksQ0FBQ1IsTUFBTTtBQUMzQjtBQUVPLFNBQVNTLG1CQUFtQkMsTUFjbEM7SUFDQyxNQUFNdEIsUUFBUTtRQUNaO1FBQ0EsQ0FBQyxTQUFTLEVBQUVzQixPQUFPQyxhQUFhLEVBQUU7UUFDbEMsQ0FBQyxVQUFVLEVBQUVELE9BQU9FLE9BQU8sRUFBRTtRQUM3QixDQUFDLE1BQU0sRUFBRUYsT0FBT0csU0FBUyxDQUFDQyxXQUFXLElBQUk7UUFDekMsQ0FBQyxRQUFRLEVBQUVKLE9BQU9LLFlBQVksQ0FBQyxFQUFFLEVBQUVMLE9BQU9NLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxlQUFlLEVBQUVOLE9BQU9PLFFBQVEsRUFBRTtRQUNuQyxDQUFDLHFCQUFxQixFQUFFUCxPQUFPUSxhQUFhLEVBQUU7UUFDOUM7S0FDRDtJQUVELEtBQUssTUFBTUMsUUFBUVQsT0FBT1UsS0FBSyxDQUFFO1FBQy9CLE1BQU1DLFFBQVFGLEtBQUtFLEtBQUssSUFBSTtRQUM1QixNQUFNQyxXQUFXSCxLQUFLSSxTQUFTLEdBQUdKLEtBQUtLLFFBQVE7UUFDL0NwQyxNQUFNUyxJQUFJLENBQUMsR0FBR3dCLE1BQU0sRUFBRSxFQUFFRixLQUFLSyxRQUFRLENBQUMsR0FBRyxFQUFFTCxLQUFLSSxTQUFTLENBQUNFLE9BQU8sQ0FBQyxHQUFHLE9BQU8sRUFBRUgsU0FBU0csT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3pHO0lBRUFyQyxNQUFNUyxJQUFJLENBQUM7SUFDWFQsTUFBTVMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFYSxPQUFPZ0IsS0FBSyxDQUFDRCxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDbERyQyxNQUFNUyxJQUFJLENBQUM7SUFFWCxPQUFPVixlQUFlQztBQUN4QiIsInNvdXJjZXMiOlsiL2hvbWUvbW91Y2hhcmlmL0RvY3VtZW50cy9JQUktQ09VUlMvUGVyc29uYWxQcm9qZWN0L1Byb2pldFYvTGl2cmVvL3NyYy9saWIvc2VydmljZXMvaW52b2ljZVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBPcmRlckl0ZW0gfSBmcm9tIFwiQC9tb2RlbHMvT3JkZXJcIjtcblxuZnVuY3Rpb24gZXNjYXBlUGRmVGV4dCh2YWx1ZTogc3RyaW5nKSB7XG4gIHJldHVybiB2YWx1ZS5yZXBsYWNlKC9cXFxcL2csIFwiXFxcXFxcXFxcIikucmVwbGFjZSgvXFwoL2csIFwiXFxcXChcIikucmVwbGFjZSgvXFwpL2csIFwiXFxcXClcIik7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2ltcGxlUGRmKGxpbmVzOiBzdHJpbmdbXSkge1xuICBsZXQgeSA9IDgwMDtcbiAgY29uc3QgY29udGVudCA9IGxpbmVzXG4gICAgLm1hcCgobGluZSkgPT4ge1xuICAgICAgY29uc3Qgc2FmZSA9IGVzY2FwZVBkZlRleHQobGluZSk7XG4gICAgICBjb25zdCBvdXQgPSBgQlQgL0YxIDEyIFRmIDUwICR7eX0gVGQgKCR7c2FmZX0pIFRqIEVUYDtcbiAgICAgIHkgLT0gMTg7XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH0pXG4gICAgLmpvaW4oXCJcXG5cIik7XG5cbiAgY29uc3Qgb2JqZWN0czogc3RyaW5nW10gPSBbXTtcbiAgb2JqZWN0cy5wdXNoKFwiMSAwIG9iaiA8PCAvVHlwZSAvQ2F0YWxvZyAvUGFnZXMgMiAwIFIgPj4gZW5kb2JqXCIpO1xuICBvYmplY3RzLnB1c2goXCIyIDAgb2JqIDw8IC9UeXBlIC9QYWdlcyAvS2lkcyBbMyAwIFJdIC9Db3VudCAxID4+IGVuZG9ialwiKTtcbiAgb2JqZWN0cy5wdXNoKFxuICAgIFwiMyAwIG9iaiA8PCAvVHlwZSAvUGFnZSAvUGFyZW50IDIgMCBSIC9NZWRpYUJveCBbMCAwIDU5NSA4NDJdIC9SZXNvdXJjZXMgPDwgL0ZvbnQgPDwgL0YxIDUgMCBSID4+ID4+IC9Db250ZW50cyA0IDAgUiA+PiBlbmRvYmpcIlxuICApO1xuICBvYmplY3RzLnB1c2goXG4gICAgYDQgMCBvYmogPDwgL0xlbmd0aCAke0J1ZmZlci5ieXRlTGVuZ3RoKGNvbnRlbnQsIFwidXRmOFwiKX0gPj4gc3RyZWFtXFxuJHtjb250ZW50fVxcbmVuZHN0cmVhbSBlbmRvYmpgXG4gICk7XG4gIG9iamVjdHMucHVzaChcIjUgMCBvYmogPDwgL1R5cGUgL0ZvbnQgL1N1YnR5cGUgL1R5cGUxIC9CYXNlRm9udCAvSGVsdmV0aWNhID4+IGVuZG9ialwiKTtcblxuICBsZXQgYm9keSA9IFwiJVBERi0xLjRcXG5cIjtcbiAgY29uc3Qgb2Zmc2V0cyA9IFswXTtcbiAgZm9yIChjb25zdCBvYmogb2Ygb2JqZWN0cykge1xuICAgIG9mZnNldHMucHVzaChCdWZmZXIuYnl0ZUxlbmd0aChib2R5LCBcInV0ZjhcIikpO1xuICAgIGJvZHkgKz0gYCR7b2JqfVxcbmA7XG4gIH1cblxuICBjb25zdCB4cmVmU3RhcnQgPSBCdWZmZXIuYnl0ZUxlbmd0aChib2R5LCBcInV0ZjhcIik7XG4gIGJvZHkgKz0gYHhyZWZcXG4wICR7b2JqZWN0cy5sZW5ndGggKyAxfVxcbmA7XG4gIGJvZHkgKz0gXCIwMDAwMDAwMDAwIDY1NTM1IGYgXFxuXCI7XG4gIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPD0gb2JqZWN0cy5sZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICBib2R5ICs9IGAke1N0cmluZyhvZmZzZXRzW2luZGV4XSkucGFkU3RhcnQoMTAsIFwiMFwiKX0gMDAwMDAgbiBcXG5gO1xuICB9XG5cbiAgYm9keSArPSBgdHJhaWxlciA8PCAvU2l6ZSAke29iamVjdHMubGVuZ3RoICsgMX0gL1Jvb3QgMSAwIFIgPj5cXG5zdGFydHhyZWZcXG4ke3hyZWZTdGFydH1cXG4lJUVPRmA7XG4gIHJldHVybiBCdWZmZXIuZnJvbShib2R5LCBcInV0ZjhcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUludm9pY2VQZGYocGFyYW1zOiB7XG4gIGludm9pY2VOdW1iZXI6IHN0cmluZztcbiAgb3JkZXJJZDogc3RyaW5nO1xuICBjdXN0b21lck5hbWU6IHN0cmluZztcbiAgY3VzdG9tZXJFbWFpbDogc3RyaW5nO1xuICBzYWxlVHlwZTogXCJkaXJlY3RcIiB8IFwicHJlb3JkZXJcIjtcbiAgcGF5bWVudE1ldGhvZDogXCJzdHJpcGVcIiB8IFwicGF5cGFsXCIgfCBcIm1vYmlsZV9tb25leVwiO1xuICB0b3RhbDogbnVtYmVyO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIGl0ZW1zOiBBcnJheTxcbiAgICBPcmRlckl0ZW0gJiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICB9XG4gID47XG59KSB7XG4gIGNvbnN0IGxpbmVzID0gW1xuICAgIFwiU0VOQU1FIEVESVRJT07igJlTIC0gRkFDVFVSRVwiLFxuICAgIGBGYWN0dXJlOiAke3BhcmFtcy5pbnZvaWNlTnVtYmVyfWAsXG4gICAgYENvbW1hbmRlOiAke3BhcmFtcy5vcmRlcklkfWAsXG4gICAgYERhdGU6ICR7cGFyYW1zLmNyZWF0ZWRBdC50b0lTT1N0cmluZygpfWAsXG4gICAgYENsaWVudDogJHtwYXJhbXMuY3VzdG9tZXJOYW1lfSA8JHtwYXJhbXMuY3VzdG9tZXJFbWFpbH0+YCxcbiAgICBgVHlwZSBkZSB2ZW50ZTogJHtwYXJhbXMuc2FsZVR5cGV9YCxcbiAgICBgTWV0aG9kZSBkZSBwYWllbWVudDogJHtwYXJhbXMucGF5bWVudE1ldGhvZH1gLFxuICAgIFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCJcbiAgXTtcblxuICBmb3IgKGNvbnN0IGl0ZW0gb2YgcGFyYW1zLml0ZW1zKSB7XG4gICAgY29uc3QgdGl0bGUgPSBpdGVtLnRpdGxlID8/IFwiT3V2cmFnZVwiO1xuICAgIGNvbnN0IHN1YnRvdGFsID0gaXRlbS51bml0UHJpY2UgKiBpdGVtLnF1YW50aXR5O1xuICAgIGxpbmVzLnB1c2goYCR7dGl0bGV9IHgke2l0ZW0ucXVhbnRpdHl9IEAgJHtpdGVtLnVuaXRQcmljZS50b0ZpeGVkKDIpfSBFVVIgPSAke3N1YnRvdGFsLnRvRml4ZWQoMil9IEVVUmApO1xuICB9XG5cbiAgbGluZXMucHVzaChcIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgbGluZXMucHVzaChgVE9UQUw6ICR7cGFyYW1zLnRvdGFsLnRvRml4ZWQoMil9IEVVUmApO1xuICBsaW5lcy5wdXNoKFwiTWVyY2kgcG91ciB2b3RyZSBhY2hhdC5cIik7XG5cbiAgcmV0dXJuIGJ1aWxkU2ltcGxlUGRmKGxpbmVzKTtcbn1cbiJdLCJuYW1lcyI6WyJlc2NhcGVQZGZUZXh0IiwidmFsdWUiLCJyZXBsYWNlIiwiYnVpbGRTaW1wbGVQZGYiLCJsaW5lcyIsInkiLCJjb250ZW50IiwibWFwIiwibGluZSIsInNhZmUiLCJvdXQiLCJqb2luIiwib2JqZWN0cyIsInB1c2giLCJCdWZmZXIiLCJieXRlTGVuZ3RoIiwiYm9keSIsIm9mZnNldHMiLCJvYmoiLCJ4cmVmU3RhcnQiLCJsZW5ndGgiLCJpbmRleCIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZnJvbSIsImdlbmVyYXRlSW52b2ljZVBkZiIsInBhcmFtcyIsImludm9pY2VOdW1iZXIiLCJvcmRlcklkIiwiY3JlYXRlZEF0IiwidG9JU09TdHJpbmciLCJjdXN0b21lck5hbWUiLCJjdXN0b21lckVtYWlsIiwic2FsZVR5cGUiLCJwYXltZW50TWV0aG9kIiwiaXRlbSIsIml0ZW1zIiwidGl0bGUiLCJzdWJ0b3RhbCIsInVuaXRQcmljZSIsInF1YW50aXR5IiwidG9GaXhlZCIsInRvdGFsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/invoiceService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/marketingService.ts":
/*!**********************************************!*\
  !*** ./src/lib/services/marketingService.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   markCartsRecovered: () => (/* binding */ markCartsRecovered),\n/* harmony export */   markPromoCodeUsed: () => (/* binding */ markPromoCodeUsed),\n/* harmony export */   saveAbandonedCart: () => (/* binding */ saveAbandonedCart),\n/* harmony export */   subscribeNewsletter: () => (/* binding */ subscribeNewsletter),\n/* harmony export */   validatePromoCode: () => (/* binding */ validatePromoCode)\n/* harmony export */ });\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./src/lib/mongodb.ts\");\n/* harmony import */ var _models_AbandonedCart__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/models/AbandonedCart */ \"(rsc)/./src/models/AbandonedCart.ts\");\n/* harmony import */ var _models_NewsletterSubscription__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/models/NewsletterSubscription */ \"(rsc)/./src/models/NewsletterSubscription.ts\");\n/* harmony import */ var _models_PromoCode__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/models/PromoCode */ \"(rsc)/./src/models/PromoCode.ts\");\n\n\n\n\n\nasync function validatePromoCode(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n    const normalized = params.code.trim().toUpperCase();\n    const promo = await _models_PromoCode__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findOne({\n        code: normalized,\n        active: true\n    }).lean();\n    if (!promo) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Code promo invalide\", 404);\n    }\n    const now = new Date();\n    if (promo.expiresAt && promo.expiresAt <= now) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Code promo expir\", 400);\n    }\n    if (promo.usageLimit !== undefined && promo.usedCount >= promo.usageLimit) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"Code promo puis\", 400);\n    }\n    if (params.subtotal < promo.minSubtotal) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(`Montant minimum requis: ${promo.minSubtotal.toFixed(2)} `, 400);\n    }\n    let discount = 0;\n    if (promo.type === \"percent\") {\n        discount = params.subtotal * promo.value / 100;\n        if (promo.maxDiscount !== undefined) {\n            discount = Math.min(discount, promo.maxDiscount);\n        }\n    } else {\n        discount = promo.value;\n    }\n    discount = Math.max(0, Math.min(discount, params.subtotal));\n    return {\n        code: promo.code,\n        discount,\n        discountType: promo.type\n    };\n}\nasync function markPromoCodeUsed(code) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n    await _models_PromoCode__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findOneAndUpdate({\n        code: code.toUpperCase()\n    }, {\n        $inc: {\n            usedCount: 1\n        }\n    });\n}\nasync function subscribeNewsletter(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n    const email = params.email.toLowerCase();\n    const subscription = await _models_NewsletterSubscription__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findOneAndUpdate({\n        email\n    }, {\n        email,\n        active: true,\n        source: params.source ?? \"site\"\n    }, {\n        upsert: true,\n        new: true,\n        setDefaultsOnInsert: true\n    }).lean();\n    return {\n        id: subscription?._id.toString() ?? \"\",\n        email,\n        active: true\n    };\n}\nasync function saveAbandonedCart(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n    if (params.items.length === 0) {\n        return {\n            saved: false\n        };\n    }\n    await _models_AbandonedCart__WEBPACK_IMPORTED_MODULE_2__[\"default\"].create({\n        user: params.userId,\n        email: params.email?.toLowerCase(),\n        subtotal: params.subtotal,\n        items: params.items,\n        status: \"open\"\n    });\n    return {\n        saved: true\n    };\n}\nasync function markCartsRecovered(userId) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n    await _models_AbandonedCart__WEBPACK_IMPORTED_MODULE_2__[\"default\"].updateMany({\n        user: userId,\n        status: \"open\"\n    }, {\n        status: \"recovered\",\n        recoveredAt: new Date()\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL21hcmtldGluZ1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFxQztBQUNhO0FBQ007QUFDa0I7QUFDMUI7QUFFekMsZUFBZUssa0JBQWtCQyxNQUEwQztJQUNoRixNQUFNTCwrREFBaUJBO0lBRXZCLE1BQU1NLGFBQWFELE9BQU9FLElBQUksQ0FBQ0MsSUFBSSxHQUFHQyxXQUFXO0lBQ2pELE1BQU1DLFFBQVEsTUFBTVAseURBQWNBLENBQUNRLE9BQU8sQ0FBQztRQUFFSixNQUFNRDtRQUFZTSxRQUFRO0lBQUssR0FBR0MsSUFBSTtJQUNuRixJQUFJLENBQUNILE9BQU87UUFDVixNQUFNLElBQUlYLDhDQUFRQSxDQUFDLHVCQUF1QjtJQUM1QztJQUVBLE1BQU1lLE1BQU0sSUFBSUM7SUFDaEIsSUFBSUwsTUFBTU0sU0FBUyxJQUFJTixNQUFNTSxTQUFTLElBQUlGLEtBQUs7UUFDN0MsTUFBTSxJQUFJZiw4Q0FBUUEsQ0FBQyxxQkFBcUI7SUFDMUM7SUFDQSxJQUFJVyxNQUFNTyxVQUFVLEtBQUtDLGFBQWFSLE1BQU1TLFNBQVMsSUFBSVQsTUFBTU8sVUFBVSxFQUFFO1FBQ3pFLE1BQU0sSUFBSWxCLDhDQUFRQSxDQUFDLHFCQUFxQjtJQUMxQztJQUNBLElBQUlNLE9BQU9lLFFBQVEsR0FBR1YsTUFBTVcsV0FBVyxFQUFFO1FBQ3ZDLE1BQU0sSUFBSXRCLDhDQUFRQSxDQUNoQixDQUFDLHdCQUF3QixFQUFFVyxNQUFNVyxXQUFXLENBQUNDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUMzRDtJQUVKO0lBRUEsSUFBSUMsV0FBVztJQUNmLElBQUliLE1BQU1jLElBQUksS0FBSyxXQUFXO1FBQzVCRCxXQUFXLE9BQVFILFFBQVEsR0FBR1YsTUFBTWUsS0FBSyxHQUFJO1FBQzdDLElBQUlmLE1BQU1nQixXQUFXLEtBQUtSLFdBQVc7WUFDbkNLLFdBQVdJLEtBQUtDLEdBQUcsQ0FBQ0wsVUFBVWIsTUFBTWdCLFdBQVc7UUFDakQ7SUFDRixPQUFPO1FBQ0xILFdBQVdiLE1BQU1lLEtBQUs7SUFDeEI7SUFDQUYsV0FBV0ksS0FBS0UsR0FBRyxDQUFDLEdBQUdGLEtBQUtDLEdBQUcsQ0FBQ0wsVUFBVWxCLE9BQU9lLFFBQVE7SUFFekQsT0FBTztRQUNMYixNQUFNRyxNQUFNSCxJQUFJO1FBQ2hCZ0I7UUFDQU8sY0FBY3BCLE1BQU1jLElBQUk7SUFDMUI7QUFDRjtBQUVPLGVBQWVPLGtCQUFrQnhCLElBQVk7SUFDbEQsTUFBTVAsK0RBQWlCQTtJQUN2QixNQUFNRyx5REFBY0EsQ0FBQzZCLGdCQUFnQixDQUFDO1FBQUV6QixNQUFNQSxLQUFLRSxXQUFXO0lBQUcsR0FBRztRQUFFd0IsTUFBTTtZQUFFZCxXQUFXO1FBQUU7SUFBRTtBQUMvRjtBQUVPLGVBQWVlLG9CQUFvQjdCLE1BQTBDO0lBQ2xGLE1BQU1MLCtEQUFpQkE7SUFFdkIsTUFBTW1DLFFBQVE5QixPQUFPOEIsS0FBSyxDQUFDQyxXQUFXO0lBQ3RDLE1BQU1DLGVBQWUsTUFBTW5DLHNFQUEyQkEsQ0FBQzhCLGdCQUFnQixDQUNyRTtRQUFFRztJQUFNLEdBQ1I7UUFBRUE7UUFBT3ZCLFFBQVE7UUFBTTBCLFFBQVFqQyxPQUFPaUMsTUFBTSxJQUFJO0lBQU8sR0FDdkQ7UUFBRUMsUUFBUTtRQUFNQyxLQUFLO1FBQU1DLHFCQUFxQjtJQUFLLEdBQ3JENUIsSUFBSTtJQUVOLE9BQU87UUFDTDZCLElBQUlMLGNBQWNNLElBQUlDLGNBQWM7UUFDcENUO1FBQ0F2QixRQUFRO0lBQ1Y7QUFDRjtBQUVPLGVBQWVpQyxrQkFBa0J4QyxNQVl2QztJQUNDLE1BQU1MLCtEQUFpQkE7SUFFdkIsSUFBSUssT0FBT3lDLEtBQUssQ0FBQ0MsTUFBTSxLQUFLLEdBQUc7UUFDN0IsT0FBTztZQUFFQyxPQUFPO1FBQU07SUFDeEI7SUFFQSxNQUFNL0MsNkRBQWtCQSxDQUFDZ0QsTUFBTSxDQUFDO1FBQzlCQyxNQUFNN0MsT0FBTzhDLE1BQU07UUFDbkJoQixPQUFPOUIsT0FBTzhCLEtBQUssRUFBRUM7UUFDckJoQixVQUFVZixPQUFPZSxRQUFRO1FBQ3pCMEIsT0FBT3pDLE9BQU95QyxLQUFLO1FBQ25CTSxRQUFRO0lBQ1Y7SUFFQSxPQUFPO1FBQUVKLE9BQU87SUFBSztBQUN2QjtBQUVPLGVBQWVLLG1CQUFtQkYsTUFBYztJQUNyRCxNQUFNbkQsK0RBQWlCQTtJQUN2QixNQUFNQyw2REFBa0JBLENBQUNxRCxVQUFVLENBQ2pDO1FBQUVKLE1BQU1DO1FBQVFDLFFBQVE7SUFBTyxHQUMvQjtRQUFFQSxRQUFRO1FBQWFHLGFBQWEsSUFBSXhDO0lBQU87QUFFbkQiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbGliL3NlcnZpY2VzL21hcmtldGluZ1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBpRXJyb3IgfSBmcm9tIFwiQC9saWIvYXBpXCI7XG5pbXBvcnQgeyBjb25uZWN0VG9EYXRhYmFzZSB9IGZyb20gXCJAL2xpYi9tb25nb2RiXCI7XG5pbXBvcnQgQWJhbmRvbmVkQ2FydE1vZGVsIGZyb20gXCJAL21vZGVscy9BYmFuZG9uZWRDYXJ0XCI7XG5pbXBvcnQgTmV3c2xldHRlclN1YnNjcmlwdGlvbk1vZGVsIGZyb20gXCJAL21vZGVscy9OZXdzbGV0dGVyU3Vic2NyaXB0aW9uXCI7XG5pbXBvcnQgUHJvbW9Db2RlTW9kZWwgZnJvbSBcIkAvbW9kZWxzL1Byb21vQ29kZVwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVQcm9tb0NvZGUocGFyYW1zOiB7IGNvZGU6IHN0cmluZzsgc3VidG90YWw6IG51bWJlciB9KSB7XG4gIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XG5cbiAgY29uc3Qgbm9ybWFsaXplZCA9IHBhcmFtcy5jb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpO1xuICBjb25zdCBwcm9tbyA9IGF3YWl0IFByb21vQ29kZU1vZGVsLmZpbmRPbmUoeyBjb2RlOiBub3JtYWxpemVkLCBhY3RpdmU6IHRydWUgfSkubGVhbigpO1xuICBpZiAoIXByb21vKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiQ29kZSBwcm9tbyBpbnZhbGlkZVwiLCA0MDQpO1xuICB9XG5cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgaWYgKHByb21vLmV4cGlyZXNBdCAmJiBwcm9tby5leHBpcmVzQXQgPD0gbm93KSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiQ29kZSBwcm9tbyBleHBpcsOpXCIsIDQwMCk7XG4gIH1cbiAgaWYgKHByb21vLnVzYWdlTGltaXQgIT09IHVuZGVmaW5lZCAmJiBwcm9tby51c2VkQ291bnQgPj0gcHJvbW8udXNhZ2VMaW1pdCkge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkNvZGUgcHJvbW8gw6lwdWlzw6lcIiwgNDAwKTtcbiAgfVxuICBpZiAocGFyYW1zLnN1YnRvdGFsIDwgcHJvbW8ubWluU3VidG90YWwpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXG4gICAgICBgTW9udGFudCBtaW5pbXVtIHJlcXVpczogJHtwcm9tby5taW5TdWJ0b3RhbC50b0ZpeGVkKDIpfSDigqxgLFxuICAgICAgNDAwXG4gICAgKTtcbiAgfVxuXG4gIGxldCBkaXNjb3VudCA9IDA7XG4gIGlmIChwcm9tby50eXBlID09PSBcInBlcmNlbnRcIikge1xuICAgIGRpc2NvdW50ID0gKHBhcmFtcy5zdWJ0b3RhbCAqIHByb21vLnZhbHVlKSAvIDEwMDtcbiAgICBpZiAocHJvbW8ubWF4RGlzY291bnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlzY291bnQgPSBNYXRoLm1pbihkaXNjb3VudCwgcHJvbW8ubWF4RGlzY291bnQpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBkaXNjb3VudCA9IHByb21vLnZhbHVlO1xuICB9XG4gIGRpc2NvdW50ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oZGlzY291bnQsIHBhcmFtcy5zdWJ0b3RhbCkpO1xuXG4gIHJldHVybiB7XG4gICAgY29kZTogcHJvbW8uY29kZSxcbiAgICBkaXNjb3VudCxcbiAgICBkaXNjb3VudFR5cGU6IHByb21vLnR5cGVcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1hcmtQcm9tb0NvZGVVc2VkKGNvZGU6IHN0cmluZykge1xuICBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuICBhd2FpdCBQcm9tb0NvZGVNb2RlbC5maW5kT25lQW5kVXBkYXRlKHsgY29kZTogY29kZS50b1VwcGVyQ2FzZSgpIH0sIHsgJGluYzogeyB1c2VkQ291bnQ6IDEgfSB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN1YnNjcmliZU5ld3NsZXR0ZXIocGFyYW1zOiB7IGVtYWlsOiBzdHJpbmc7IHNvdXJjZT86IHN0cmluZyB9KSB7XG4gIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XG5cbiAgY29uc3QgZW1haWwgPSBwYXJhbXMuZW1haWwudG9Mb3dlckNhc2UoKTtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgTmV3c2xldHRlclN1YnNjcmlwdGlvbk1vZGVsLmZpbmRPbmVBbmRVcGRhdGUoXG4gICAgeyBlbWFpbCB9LFxuICAgIHsgZW1haWwsIGFjdGl2ZTogdHJ1ZSwgc291cmNlOiBwYXJhbXMuc291cmNlID8/IFwic2l0ZVwiIH0sXG4gICAgeyB1cHNlcnQ6IHRydWUsIG5ldzogdHJ1ZSwgc2V0RGVmYXVsdHNPbkluc2VydDogdHJ1ZSB9XG4gICkubGVhbigpO1xuXG4gIHJldHVybiB7XG4gICAgaWQ6IHN1YnNjcmlwdGlvbj8uX2lkLnRvU3RyaW5nKCkgPz8gXCJcIixcbiAgICBlbWFpbCxcbiAgICBhY3RpdmU6IHRydWVcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVBYmFuZG9uZWRDYXJ0KHBhcmFtczoge1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIGVtYWlsPzogc3RyaW5nO1xuICBzdWJ0b3RhbDogbnVtYmVyO1xuICBpdGVtczogQXJyYXk8e1xuICAgIGJvb2tJZDogc3RyaW5nO1xuICAgIHNsdWc6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIHF1YW50aXR5OiBudW1iZXI7XG4gICAgdW5pdFByaWNlOiBudW1iZXI7XG4gICAgc2FsZVR5cGU6IFwiZGlyZWN0XCIgfCBcInByZW9yZGVyXCIgfCBcImNyb3dkZnVuZGluZ1wiO1xuICB9Pjtcbn0pIHtcbiAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcblxuICBpZiAocGFyYW1zLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB7IHNhdmVkOiBmYWxzZSB9O1xuICB9XG5cbiAgYXdhaXQgQWJhbmRvbmVkQ2FydE1vZGVsLmNyZWF0ZSh7XG4gICAgdXNlcjogcGFyYW1zLnVzZXJJZCxcbiAgICBlbWFpbDogcGFyYW1zLmVtYWlsPy50b0xvd2VyQ2FzZSgpLFxuICAgIHN1YnRvdGFsOiBwYXJhbXMuc3VidG90YWwsXG4gICAgaXRlbXM6IHBhcmFtcy5pdGVtcyxcbiAgICBzdGF0dXM6IFwib3BlblwiXG4gIH0pO1xuXG4gIHJldHVybiB7IHNhdmVkOiB0cnVlIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXJrQ2FydHNSZWNvdmVyZWQodXNlcklkOiBzdHJpbmcpIHtcbiAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcbiAgYXdhaXQgQWJhbmRvbmVkQ2FydE1vZGVsLnVwZGF0ZU1hbnkoXG4gICAgeyB1c2VyOiB1c2VySWQsIHN0YXR1czogXCJvcGVuXCIgfSxcbiAgICB7IHN0YXR1czogXCJyZWNvdmVyZWRcIiwgcmVjb3ZlcmVkQXQ6IG5ldyBEYXRlKCkgfVxuICApO1xufVxuIl0sIm5hbWVzIjpbIkFwaUVycm9yIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJBYmFuZG9uZWRDYXJ0TW9kZWwiLCJOZXdzbGV0dGVyU3Vic2NyaXB0aW9uTW9kZWwiLCJQcm9tb0NvZGVNb2RlbCIsInZhbGlkYXRlUHJvbW9Db2RlIiwicGFyYW1zIiwibm9ybWFsaXplZCIsImNvZGUiLCJ0cmltIiwidG9VcHBlckNhc2UiLCJwcm9tbyIsImZpbmRPbmUiLCJhY3RpdmUiLCJsZWFuIiwibm93IiwiRGF0ZSIsImV4cGlyZXNBdCIsInVzYWdlTGltaXQiLCJ1bmRlZmluZWQiLCJ1c2VkQ291bnQiLCJzdWJ0b3RhbCIsIm1pblN1YnRvdGFsIiwidG9GaXhlZCIsImRpc2NvdW50IiwidHlwZSIsInZhbHVlIiwibWF4RGlzY291bnQiLCJNYXRoIiwibWluIiwibWF4IiwiZGlzY291bnRUeXBlIiwibWFya1Byb21vQ29kZVVzZWQiLCJmaW5kT25lQW5kVXBkYXRlIiwiJGluYyIsInN1YnNjcmliZU5ld3NsZXR0ZXIiLCJlbWFpbCIsInRvTG93ZXJDYXNlIiwic3Vic2NyaXB0aW9uIiwic291cmNlIiwidXBzZXJ0IiwibmV3Iiwic2V0RGVmYXVsdHNPbkluc2VydCIsImlkIiwiX2lkIiwidG9TdHJpbmciLCJzYXZlQWJhbmRvbmVkQ2FydCIsIml0ZW1zIiwibGVuZ3RoIiwic2F2ZWQiLCJjcmVhdGUiLCJ1c2VyIiwidXNlcklkIiwic3RhdHVzIiwibWFya0NhcnRzUmVjb3ZlcmVkIiwidXBkYXRlTWFueSIsInJlY292ZXJlZEF0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/marketingService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/orderService.ts":
/*!******************************************!*\
  !*** ./src/lib/services/orderService.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cancelOrder: () => (/* binding */ cancelOrder),\n/* harmony export */   createOrder: () => (/* binding */ createOrder),\n/* harmony export */   markOrderAsPaid: () => (/* binding */ markOrderAsPaid)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:crypto */ \"node:crypto\");\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_crypto__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./src/lib/mongodb.ts\");\n/* harmony import */ var _models_Book__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/models/Book */ \"(rsc)/./src/models/Book.ts\");\n/* harmony import */ var _models_Order__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/models/Order */ \"(rsc)/./src/models/Order.ts\");\n/* harmony import */ var _models_User__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/models/User */ \"(rsc)/./src/models/User.ts\");\n/* harmony import */ var _lib_services_invoiceService__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/services/invoiceService */ \"(rsc)/./src/lib/services/invoiceService.ts\");\n\n\n\n\n\n\n\n\nfunction buildInvoiceNumber() {\n    const d = new Date();\n    const y = d.getUTCFullYear();\n    const m = String(d.getUTCMonth() + 1).padStart(2, \"0\");\n    const day = String(d.getUTCDate()).padStart(2, \"0\");\n    const suffix = (0,node_crypto__WEBPACK_IMPORTED_MODULE_1__.randomBytes)(2).toString(\"hex\").toUpperCase();\n    return `INV-${y}${m}${day}-${suffix}`;\n}\nfunction isTransactionUnsupportedError(error) {\n    if (!(error instanceof Error)) return false;\n    return /Transaction numbers are only allowed on a replica set member or mongos/i.test(error.message);\n}\nasync function runWithOptionalTransaction(operation) {\n    const session = await mongoose__WEBPACK_IMPORTED_MODULE_0___default().startSession();\n    try {\n        session.startTransaction();\n        try {\n            const result = await operation(session);\n            await session.commitTransaction();\n            return result;\n        } catch (error) {\n            await session.abortTransaction();\n            if (isTransactionUnsupportedError(error)) {\n                return operation(null);\n            }\n            throw error;\n        }\n    } finally{\n        session.endSession();\n    }\n}\nasync function createOrder(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_3__.connectToDatabase)();\n    return runWithOptionalTransaction(async (session)=>{\n        const userQuery = _models_User__WEBPACK_IMPORTED_MODULE_6__[\"default\"].findById(params.userId, {\n            name: 1,\n            email: 1\n        });\n        if (session) userQuery.session(session);\n        const user = await userQuery;\n        if (!user) {\n            throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"User not found\", 404);\n        }\n        const items = [];\n        let total = 0;\n        for (const item of params.items){\n            const bookQuery = _models_Book__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(item.bookId);\n            if (session) bookQuery.session(session);\n            const book = await bookQuery;\n            if (!book) {\n                throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Book not found\", 404);\n            }\n            if (book.saleType !== params.saleType) {\n                throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Book sale type mismatch\", 400);\n            }\n            if (params.saleType === \"direct\" || params.saleType === \"preorder\") {\n                if (book.stock === undefined || book.stock < item.quantity) {\n                    throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Insufficient stock\", 409);\n                }\n            }\n            items.push({\n                book: book._id,\n                quantity: item.quantity,\n                unitPrice: book.price\n            });\n            total += book.price * item.quantity;\n        }\n        const invoiceNumber = buildInvoiceNumber();\n        const order = new _models_Order__WEBPACK_IMPORTED_MODULE_5__[\"default\"]({\n            user: params.userId,\n            items,\n            total,\n            status: \"pending\",\n            saleType: params.saleType,\n            paymentMethod: params.paymentMethod,\n            promoCode: params.promoCode,\n            invoiceNumber,\n            createdAt: new Date()\n        });\n        await order.save(session ? {\n            session\n        } : undefined);\n        return order;\n    });\n}\nasync function markOrderAsPaid(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_3__.connectToDatabase)();\n    return runWithOptionalTransaction(async (session)=>{\n        const orderQuery = _models_Order__WEBPACK_IMPORTED_MODULE_5__[\"default\"].findById(params.orderId);\n        if (session) orderQuery.session(session);\n        const order = await orderQuery;\n        if (!order) {\n            throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Order not found\", 404);\n        }\n        if (order.status === \"paid\") {\n            return order;\n        }\n        if (order.status !== \"pending\") {\n            throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Order cannot be paid in its current state\", 409);\n        }\n        const userQuery = _models_User__WEBPACK_IMPORTED_MODULE_6__[\"default\"].findById(order.user, {\n            name: 1,\n            email: 1\n        });\n        if (session) userQuery.session(session);\n        const user = await userQuery;\n        if (!user) {\n            throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"User not found\", 404);\n        }\n        const invoiceItems = [];\n        for (const item of order.items){\n            const bookQuery = _models_Book__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(item.book);\n            if (session) bookQuery.session(session);\n            const book = await bookQuery;\n            if (!book) {\n                throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Book not found\", 404);\n            }\n            if (book.saleType !== order.saleType) {\n                throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Book sale type mismatch\", 400);\n            }\n            if (book.stock === undefined || book.stock < item.quantity) {\n                throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Insufficient stock\", 409);\n            }\n            book.stock -= item.quantity;\n            await book.save(session ? {\n                session\n            } : undefined);\n            invoiceItems.push({\n                book: book._id,\n                quantity: item.quantity,\n                unitPrice: item.unitPrice,\n                title: book.title\n            });\n        }\n        const effectiveTransactionId = params.transactionId ?? `txn_${Date.now()}_${(0,node_crypto__WEBPACK_IMPORTED_MODULE_1__.randomBytes)(4).toString(\"hex\")}`;\n        const createdAt = new Date();\n        const invoicePdf = (0,_lib_services_invoiceService__WEBPACK_IMPORTED_MODULE_7__.generateInvoicePdf)({\n            invoiceNumber: order.invoiceNumber,\n            orderId: effectiveTransactionId,\n            customerName: user.name,\n            customerEmail: user.email,\n            saleType: order.saleType,\n            paymentMethod: params.paymentMethod,\n            total: order.total,\n            createdAt,\n            items: invoiceItems\n        });\n        order.status = \"paid\";\n        order.paymentMethod = params.paymentMethod;\n        order.transactionId = effectiveTransactionId;\n        order.paymentReference = params.paymentReference;\n        order.paidAt = createdAt;\n        order.invoicePdfBase64 = invoicePdf.toString(\"base64\");\n        await order.save(session ? {\n            session\n        } : undefined);\n        await _models_User__WEBPACK_IMPORTED_MODULE_6__[\"default\"].findByIdAndUpdate(order.user, {\n            $inc: {\n                rewardPoints: Math.max(1, Math.floor(order.total))\n            }\n        }, session ? {\n            session\n        } : {});\n        return order;\n    });\n}\nasync function cancelOrder(params) {\n    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_3__.connectToDatabase)();\n    const order = await _models_Order__WEBPACK_IMPORTED_MODULE_5__[\"default\"].findById(params.orderId);\n    if (!order) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Order not found\", 404);\n    }\n    if (order.user.toString() !== params.userId) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Forbidden\", 403);\n    }\n    if (order.status === \"paid\") {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Paid order cannot be cancelled\", 409);\n    }\n    if (order.status === \"cancelled\") {\n        return order;\n    }\n    if (order.status !== \"pending\") {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_2__.ApiError(\"Order cannot be cancelled in its current state\", 409);\n    }\n    order.status = \"cancelled\";\n    await order.save();\n    return order;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LDhDQUFRQSxDQUFDLGtDQUFrQztJQUN2RDtJQUNBLElBQUl5RCxNQUFNQyxNQUFNLEtBQUssYUFBYTtRQUNoQyxPQUFPRDtJQUNUO0lBQ0EsSUFBSUEsTUFBTUMsTUFBTSxLQUFLLFdBQVc7UUFDOUIsTUFBTSxJQUFJMUQsOENBQVFBLENBQUMsa0RBQWtEO0lBQ3ZFO0lBRUF5RCxNQUFNQyxNQUFNLEdBQUc7SUFDZixNQUFNRCxNQUFNSyxJQUFJO0lBQ2hCLE9BQU9MO0FBQ1QiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbGliL3NlcnZpY2VzL29yZGVyU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5pbXBvcnQgeyByYW5kb21CeXRlcyB9IGZyb20gXCJub2RlOmNyeXB0b1wiO1xuaW1wb3J0IHsgQXBpRXJyb3IgfSBmcm9tIFwiQC9saWIvYXBpXCI7XG5pbXBvcnQgeyBjb25uZWN0VG9EYXRhYmFzZSB9IGZyb20gXCJAL2xpYi9tb25nb2RiXCI7XG5pbXBvcnQgQm9va01vZGVsIGZyb20gXCJAL21vZGVscy9Cb29rXCI7XG5pbXBvcnQgT3JkZXJNb2RlbCwgeyB0eXBlIE9yZGVySXRlbSB9IGZyb20gXCJAL21vZGVscy9PcmRlclwiO1xuaW1wb3J0IFVzZXJNb2RlbCBmcm9tIFwiQC9tb2RlbHMvVXNlclwiO1xuaW1wb3J0IHsgZ2VuZXJhdGVJbnZvaWNlUGRmIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL2ludm9pY2VTZXJ2aWNlXCI7XG5cbmZ1bmN0aW9uIGJ1aWxkSW52b2ljZU51bWJlcigpIHtcbiAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IHkgPSBkLmdldFVUQ0Z1bGxZZWFyKCk7XG4gIGNvbnN0IG0gPSBTdHJpbmcoZC5nZXRVVENNb250aCgpICsgMSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICBjb25zdCBkYXkgPSBTdHJpbmcoZC5nZXRVVENEYXRlKCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgY29uc3Qgc3VmZml4ID0gcmFuZG9tQnl0ZXMoMikudG9TdHJpbmcoXCJoZXhcIikudG9VcHBlckNhc2UoKTtcbiAgcmV0dXJuIGBJTlYtJHt5fSR7bX0ke2RheX0tJHtzdWZmaXh9YDtcbn1cblxuZnVuY3Rpb24gaXNUcmFuc2FjdGlvblVuc3VwcG9ydGVkRXJyb3IoZXJyb3I6IHVua25vd24pIHtcbiAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIC9UcmFuc2FjdGlvbiBudW1iZXJzIGFyZSBvbmx5IGFsbG93ZWQgb24gYSByZXBsaWNhIHNldCBtZW1iZXIgb3IgbW9uZ29zL2kudGVzdChlcnJvci5tZXNzYWdlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcnVuV2l0aE9wdGlvbmFsVHJhbnNhY3Rpb248VD4oXG4gIG9wZXJhdGlvbjogKHNlc3Npb246IG1vbmdvb3NlLkNsaWVudFNlc3Npb24gfCBudWxsKSA9PiBQcm9taXNlPFQ+XG4pIHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IG1vbmdvb3NlLnN0YXJ0U2Vzc2lvbigpO1xuICB0cnkge1xuICAgIHNlc3Npb24uc3RhcnRUcmFuc2FjdGlvbigpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcGVyYXRpb24oc2Vzc2lvbik7XG4gICAgICBhd2FpdCBzZXNzaW9uLmNvbW1pdFRyYW5zYWN0aW9uKCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhd2FpdCBzZXNzaW9uLmFib3J0VHJhbnNhY3Rpb24oKTtcbiAgICAgIGlmIChpc1RyYW5zYWN0aW9uVW5zdXBwb3J0ZWRFcnJvcihlcnJvcikpIHtcbiAgICAgICAgcmV0dXJuIG9wZXJhdGlvbihudWxsKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBzZXNzaW9uLmVuZFNlc3Npb24oKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlT3JkZXIocGFyYW1zOiB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBpdGVtczogQXJyYXk8eyBib29rSWQ6IHN0cmluZzsgcXVhbnRpdHk6IG51bWJlciB9PjtcbiAgc2FsZVR5cGU6IFwiZGlyZWN0XCIgfCBcInByZW9yZGVyXCI7XG4gIHBheW1lbnRNZXRob2Q6IFwic3RyaXBlXCIgfCBcInBheXBhbFwiIHwgXCJtb2JpbGVfbW9uZXlcIjtcbiAgcHJvbW9Db2RlPzogc3RyaW5nO1xufSkge1xuICBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuICByZXR1cm4gcnVuV2l0aE9wdGlvbmFsVHJhbnNhY3Rpb24oYXN5bmMgKHNlc3Npb24pID0+IHtcbiAgICBjb25zdCB1c2VyUXVlcnkgPSBVc2VyTW9kZWwuZmluZEJ5SWQocGFyYW1zLnVzZXJJZCwgeyBuYW1lOiAxLCBlbWFpbDogMSB9KTtcbiAgICBpZiAoc2Vzc2lvbikgdXNlclF1ZXJ5LnNlc3Npb24oc2Vzc2lvbik7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJRdWVyeTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIlVzZXIgbm90IGZvdW5kXCIsIDQwNCk7XG4gICAgfVxuXG4gICAgY29uc3QgaXRlbXM6IE9yZGVySXRlbVtdID0gW107XG4gICAgbGV0IHRvdGFsID0gMDtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBwYXJhbXMuaXRlbXMpIHtcbiAgICAgIGNvbnN0IGJvb2tRdWVyeSA9IEJvb2tNb2RlbC5maW5kQnlJZChpdGVtLmJvb2tJZCk7XG4gICAgICBpZiAoc2Vzc2lvbikgYm9va1F1ZXJ5LnNlc3Npb24oc2Vzc2lvbik7XG4gICAgICBjb25zdCBib29rID0gYXdhaXQgYm9va1F1ZXJ5O1xuICAgICAgaWYgKCFib29rKSB7XG4gICAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkJvb2sgbm90IGZvdW5kXCIsIDQwNCk7XG4gICAgICB9XG4gICAgICBpZiAoYm9vay5zYWxlVHlwZSAhPT0gcGFyYW1zLnNhbGVUeXBlKSB7XG4gICAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkJvb2sgc2FsZSB0eXBlIG1pc21hdGNoXCIsIDQwMCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJhbXMuc2FsZVR5cGUgPT09IFwiZGlyZWN0XCIgfHwgcGFyYW1zLnNhbGVUeXBlID09PSBcInByZW9yZGVyXCIpIHtcbiAgICAgICAgaWYgKGJvb2suc3RvY2sgPT09IHVuZGVmaW5lZCB8fCBib29rLnN0b2NrIDwgaXRlbS5xdWFudGl0eSkge1xuICAgICAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkluc3VmZmljaWVudCBzdG9ja1wiLCA0MDkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICBib29rOiBib29rLl9pZCxcbiAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgIHVuaXRQcmljZTogYm9vay5wcmljZVxuICAgICAgfSk7XG5cbiAgICAgIHRvdGFsICs9IGJvb2sucHJpY2UgKiBpdGVtLnF1YW50aXR5O1xuICAgIH1cblxuICAgIGNvbnN0IGludm9pY2VOdW1iZXIgPSBidWlsZEludm9pY2VOdW1iZXIoKTtcbiAgICBjb25zdCBvcmRlciA9IG5ldyBPcmRlck1vZGVsKHtcbiAgICAgIHVzZXI6IHBhcmFtcy51c2VySWQsXG4gICAgICBpdGVtcyxcbiAgICAgIHRvdGFsLFxuICAgICAgc3RhdHVzOiBcInBlbmRpbmdcIixcbiAgICAgIHNhbGVUeXBlOiBwYXJhbXMuc2FsZVR5cGUsXG4gICAgICBwYXltZW50TWV0aG9kOiBwYXJhbXMucGF5bWVudE1ldGhvZCxcbiAgICAgIHByb21vQ29kZTogcGFyYW1zLnByb21vQ29kZSxcbiAgICAgIGludm9pY2VOdW1iZXIsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgICBhd2FpdCBvcmRlci5zYXZlKHNlc3Npb24gPyB7IHNlc3Npb24gfSA6IHVuZGVmaW5lZCk7XG5cbiAgICByZXR1cm4gb3JkZXI7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya09yZGVyQXNQYWlkKHBhcmFtczoge1xuICBvcmRlcklkOiBzdHJpbmc7XG4gIHBheW1lbnRNZXRob2Q6IFwic3RyaXBlXCIgfCBcInBheXBhbFwiIHwgXCJtb2JpbGVfbW9uZXlcIjtcbiAgdHJhbnNhY3Rpb25JZD86IHN0cmluZztcbiAgcGF5bWVudFJlZmVyZW5jZT86IHN0cmluZztcbn0pIHtcbiAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcbiAgcmV0dXJuIHJ1bldpdGhPcHRpb25hbFRyYW5zYWN0aW9uKGFzeW5jIChzZXNzaW9uKSA9PiB7XG4gICAgY29uc3Qgb3JkZXJRdWVyeSA9IE9yZGVyTW9kZWwuZmluZEJ5SWQocGFyYW1zLm9yZGVySWQpO1xuICAgIGlmIChzZXNzaW9uKSBvcmRlclF1ZXJ5LnNlc3Npb24oc2Vzc2lvbik7XG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBvcmRlclF1ZXJ5O1xuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIk9yZGVyIG5vdCBmb3VuZFwiLCA0MDQpO1xuICAgIH1cbiAgICBpZiAob3JkZXIuc3RhdHVzID09PSBcInBhaWRcIikge1xuICAgICAgcmV0dXJuIG9yZGVyO1xuICAgIH1cbiAgICBpZiAob3JkZXIuc3RhdHVzICE9PSBcInBlbmRpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiT3JkZXIgY2Fubm90IGJlIHBhaWQgaW4gaXRzIGN1cnJlbnQgc3RhdGVcIiwgNDA5KTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VyUXVlcnkgPSBVc2VyTW9kZWwuZmluZEJ5SWQob3JkZXIudXNlciwgeyBuYW1lOiAxLCBlbWFpbDogMSB9KTtcbiAgICBpZiAoc2Vzc2lvbikgdXNlclF1ZXJ5LnNlc3Npb24oc2Vzc2lvbik7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJRdWVyeTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIlVzZXIgbm90IGZvdW5kXCIsIDQwNCk7XG4gICAgfVxuXG4gICAgY29uc3QgaW52b2ljZUl0ZW1zOiBBcnJheTxPcmRlckl0ZW0gJiB7IHRpdGxlPzogc3RyaW5nIH0+ID0gW107XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIG9yZGVyLml0ZW1zKSB7XG4gICAgICBjb25zdCBib29rUXVlcnkgPSBCb29rTW9kZWwuZmluZEJ5SWQoaXRlbS5ib29rKTtcbiAgICAgIGlmIChzZXNzaW9uKSBib29rUXVlcnkuc2Vzc2lvbihzZXNzaW9uKTtcbiAgICAgIGNvbnN0IGJvb2sgPSBhd2FpdCBib29rUXVlcnk7XG4gICAgICBpZiAoIWJvb2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiQm9vayBub3QgZm91bmRcIiwgNDA0KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGJvb2suc2FsZVR5cGUgIT09IG9yZGVyLnNhbGVUeXBlKSB7XG4gICAgICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkJvb2sgc2FsZSB0eXBlIG1pc21hdGNoXCIsIDQwMCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChib29rLnN0b2NrID09PSB1bmRlZmluZWQgfHwgYm9vay5zdG9jayA8IGl0ZW0ucXVhbnRpdHkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiSW5zdWZmaWNpZW50IHN0b2NrXCIsIDQwOSk7XG4gICAgICB9XG5cbiAgICAgIGJvb2suc3RvY2sgLT0gaXRlbS5xdWFudGl0eTtcbiAgICAgIGF3YWl0IGJvb2suc2F2ZShzZXNzaW9uID8geyBzZXNzaW9uIH0gOiB1bmRlZmluZWQpO1xuXG4gICAgICBpbnZvaWNlSXRlbXMucHVzaCh7XG4gICAgICAgIGJvb2s6IGJvb2suX2lkLFxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgdW5pdFByaWNlOiBpdGVtLnVuaXRQcmljZSxcbiAgICAgICAgdGl0bGU6IGJvb2sudGl0bGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGVmZmVjdGl2ZVRyYW5zYWN0aW9uSWQgPSBwYXJhbXMudHJhbnNhY3Rpb25JZCA/PyBgdHhuXyR7RGF0ZS5ub3coKX1fJHtyYW5kb21CeXRlcyg0KS50b1N0cmluZyhcImhleFwiKX1gO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaW52b2ljZVBkZiA9IGdlbmVyYXRlSW52b2ljZVBkZih7XG4gICAgICBpbnZvaWNlTnVtYmVyOiBvcmRlci5pbnZvaWNlTnVtYmVyLFxuICAgICAgb3JkZXJJZDogZWZmZWN0aXZlVHJhbnNhY3Rpb25JZCxcbiAgICAgIGN1c3RvbWVyTmFtZTogdXNlci5uYW1lLFxuICAgICAgY3VzdG9tZXJFbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHNhbGVUeXBlOiBvcmRlci5zYWxlVHlwZSxcbiAgICAgIHBheW1lbnRNZXRob2Q6IHBhcmFtcy5wYXltZW50TWV0aG9kLFxuICAgICAgdG90YWw6IG9yZGVyLnRvdGFsLFxuICAgICAgY3JlYXRlZEF0LFxuICAgICAgaXRlbXM6IGludm9pY2VJdGVtc1xuICAgIH0pO1xuXG4gICAgb3JkZXIuc3RhdHVzID0gXCJwYWlkXCI7XG4gICAgb3JkZXIucGF5bWVudE1ldGhvZCA9IHBhcmFtcy5wYXltZW50TWV0aG9kO1xuICAgIG9yZGVyLnRyYW5zYWN0aW9uSWQgPSBlZmZlY3RpdmVUcmFuc2FjdGlvbklkO1xuICAgIG9yZGVyLnBheW1lbnRSZWZlcmVuY2UgPSBwYXJhbXMucGF5bWVudFJlZmVyZW5jZTtcbiAgICBvcmRlci5wYWlkQXQgPSBjcmVhdGVkQXQ7XG4gICAgb3JkZXIuaW52b2ljZVBkZkJhc2U2NCA9IGludm9pY2VQZGYudG9TdHJpbmcoXCJiYXNlNjRcIik7XG4gICAgYXdhaXQgb3JkZXIuc2F2ZShzZXNzaW9uID8geyBzZXNzaW9uIH0gOiB1bmRlZmluZWQpO1xuXG4gICAgYXdhaXQgVXNlck1vZGVsLmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgb3JkZXIudXNlcixcbiAgICAgIHsgJGluYzogeyByZXdhcmRQb2ludHM6IE1hdGgubWF4KDEsIE1hdGguZmxvb3Iob3JkZXIudG90YWwpKSB9IH0sXG4gICAgICBzZXNzaW9uID8geyBzZXNzaW9uIH0gOiB7fVxuICAgICk7XG5cbiAgICByZXR1cm4gb3JkZXI7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FuY2VsT3JkZXIocGFyYW1zOiB7IG9yZGVySWQ6IHN0cmluZzsgdXNlcklkOiBzdHJpbmcgfSkge1xuICBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuXG4gIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXJNb2RlbC5maW5kQnlJZChwYXJhbXMub3JkZXJJZCk7XG4gIGlmICghb3JkZXIpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJPcmRlciBub3QgZm91bmRcIiwgNDA0KTtcbiAgfVxuICBpZiAob3JkZXIudXNlci50b1N0cmluZygpICE9PSBwYXJhbXMudXNlcklkKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiRm9yYmlkZGVuXCIsIDQwMyk7XG4gIH1cbiAgaWYgKG9yZGVyLnN0YXR1cyA9PT0gXCJwYWlkXCIpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJQYWlkIG9yZGVyIGNhbm5vdCBiZSBjYW5jZWxsZWRcIiwgNDA5KTtcbiAgfVxuICBpZiAob3JkZXIuc3RhdHVzID09PSBcImNhbmNlbGxlZFwiKSB7XG4gICAgcmV0dXJuIG9yZGVyO1xuICB9XG4gIGlmIChvcmRlci5zdGF0dXMgIT09IFwicGVuZGluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKFwiT3JkZXIgY2Fubm90IGJlIGNhbmNlbGxlZCBpbiBpdHMgY3VycmVudCBzdGF0ZVwiLCA0MDkpO1xuICB9XG5cbiAgb3JkZXIuc3RhdHVzID0gXCJjYW5jZWxsZWRcIjtcbiAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuICByZXR1cm4gb3JkZXI7XG59XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJyYW5kb21CeXRlcyIsIkFwaUVycm9yIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJCb29rTW9kZWwiLCJPcmRlck1vZGVsIiwiVXNlck1vZGVsIiwiZ2VuZXJhdGVJbnZvaWNlUGRmIiwiYnVpbGRJbnZvaWNlTnVtYmVyIiwiZCIsIkRhdGUiLCJ5IiwiZ2V0VVRDRnVsbFllYXIiLCJtIiwiU3RyaW5nIiwiZ2V0VVRDTW9udGgiLCJwYWRTdGFydCIsImRheSIsImdldFVUQ0RhdGUiLCJzdWZmaXgiLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwiaXNUcmFuc2FjdGlvblVuc3VwcG9ydGVkRXJyb3IiLCJlcnJvciIsIkVycm9yIiwidGVzdCIsIm1lc3NhZ2UiLCJydW5XaXRoT3B0aW9uYWxUcmFuc2FjdGlvbiIsIm9wZXJhdGlvbiIsInNlc3Npb24iLCJzdGFydFNlc3Npb24iLCJzdGFydFRyYW5zYWN0aW9uIiwicmVzdWx0IiwiY29tbWl0VHJhbnNhY3Rpb24iLCJhYm9ydFRyYW5zYWN0aW9uIiwiZW5kU2Vzc2lvbiIsImNyZWF0ZU9yZGVyIiwicGFyYW1zIiwidXNlclF1ZXJ5IiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJuYW1lIiwiZW1haWwiLCJ1c2VyIiwiaXRlbXMiLCJ0b3RhbCIsIml0ZW0iLCJib29rUXVlcnkiLCJib29rSWQiLCJib29rIiwic2FsZVR5cGUiLCJzdG9jayIsInVuZGVmaW5lZCIsInF1YW50aXR5IiwicHVzaCIsIl9pZCIsInVuaXRQcmljZSIsInByaWNlIiwiaW52b2ljZU51bWJlciIsIm9yZGVyIiwic3RhdHVzIiwicGF5bWVudE1ldGhvZCIsInByb21vQ29kZSIsImNyZWF0ZWRBdCIsInNhdmUiLCJtYXJrT3JkZXJBc1BhaWQiLCJvcmRlclF1ZXJ5Iiwib3JkZXJJZCIsImludm9pY2VJdGVtcyIsInRpdGxlIiwiZWZmZWN0aXZlVHJhbnNhY3Rpb25JZCIsInRyYW5zYWN0aW9uSWQiLCJub3ciLCJpbnZvaWNlUGRmIiwiY3VzdG9tZXJOYW1lIiwiY3VzdG9tZXJFbWFpbCIsInBheW1lbnRSZWZlcmVuY2UiLCJwYWlkQXQiLCJpbnZvaWNlUGRmQmFzZTY0IiwiZmluZEJ5SWRBbmRVcGRhdGUiLCIkaW5jIiwicmV3YXJkUG9pbnRzIiwiTWF0aCIsIm1heCIsImZsb29yIiwiY2FuY2VsT3JkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/orderService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation/common.ts":
/*!**************************************!*\
  !*** ./src/lib/validation/common.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   asEmail: () => (/* binding */ asEmail),\n/* harmony export */   asEnum: () => (/* binding */ asEnum),\n/* harmony export */   asNumber: () => (/* binding */ asNumber),\n/* harmony export */   asObject: () => (/* binding */ asObject),\n/* harmony export */   asObjectId: () => (/* binding */ asObjectId),\n/* harmony export */   asOptionalEmail: () => (/* binding */ asOptionalEmail),\n/* harmony export */   asOptionalString: () => (/* binding */ asOptionalString),\n/* harmony export */   asPassword: () => (/* binding */ asPassword),\n/* harmony export */   asString: () => (/* binding */ asString)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n\n\nfunction asObject(input) {\n    if (!input || typeof input !== \"object\" || Array.isArray(input)) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(\"Body must be a JSON object\", 400);\n    }\n    return input;\n}\nfunction asString(value, field, { min = 1, max = 5000 } = {}) {\n    if (typeof value !== \"string\") {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be a string`, 400);\n    }\n    const trimmed = value.trim();\n    if (trimmed.length < min) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} is required`, 400);\n    }\n    if (trimmed.length > max) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} is too long`, 400);\n    }\n    return trimmed;\n}\nfunction asEmail(value, field = \"email\") {\n    const email = asString(value, field, {\n        min: 3,\n        max: 320\n    }).toLowerCase();\n    const isValid = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n    if (!isValid) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(\"Invalid email format\", 400);\n    }\n    return email;\n}\nfunction asPassword(value, field = \"password\") {\n    const password = asString(value, field, {\n        min: 8,\n        max: 128\n    });\n    return password;\n}\nfunction asNumber(value, field, { min, max } = {}) {\n    if (typeof value !== \"number\" || Number.isNaN(value)) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be a number`, 400);\n    }\n    if (min !== undefined && value < min) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be >= ${min}`, 400);\n    }\n    if (max !== undefined && value > max) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be <= ${max}`, 400);\n    }\n    return value;\n}\nfunction asObjectId(value, field) {\n    const id = asString(value, field, {\n        min: 1,\n        max: 64\n    });\n    if (!mongoose__WEBPACK_IMPORTED_MODULE_0___default().Types.ObjectId.isValid(id)) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be a valid ObjectId`, 400);\n    }\n    return id;\n}\nfunction asEnum(value, field, allowed) {\n    if (typeof value !== \"string\" || !allowed.includes(value)) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_1__.ApiError(`${field} must be one of: ${allowed.join(\", \")}`, 400);\n    }\n    return value;\n}\nfunction asOptionalString(value, field, max = 5000) {\n    if (value === undefined || value === null) {\n        return undefined;\n    }\n    return asString(value, field, {\n        min: 1,\n        max\n    });\n}\nfunction asOptionalEmail(value, field = \"email\") {\n    if (value === undefined || value === null) {\n        return undefined;\n    }\n    return asEmail(value, field);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRXNCLFFBQVFFLElBQUksQ0FBQyxPQUFPLEVBQUU7SUFDdkU7SUFFQSxPQUFPekI7QUFDVDtBQUVPLFNBQVMwQixpQkFBaUIxQixLQUFjLEVBQUVDLEtBQWEsRUFBRUUsTUFBTSxJQUFJO0lBQ3hFLElBQUlILFVBQVVpQixhQUFhakIsVUFBVSxNQUFNO1FBQ3pDLE9BQU9pQjtJQUNUO0lBRUEsT0FBT2xCLFNBQVNDLE9BQU9DLE9BQU87UUFBRUMsS0FBSztRQUFHQztJQUFJO0FBQzlDO0FBRU8sU0FBU3dCLGdCQUFnQjNCLEtBQWMsRUFBRUMsUUFBUSxPQUFPO0lBQzdELElBQUlELFVBQVVpQixhQUFhakIsVUFBVSxNQUFNO1FBQ3pDLE9BQU9pQjtJQUNUO0lBRUEsT0FBT1YsUUFBUVAsT0FBT0M7QUFDeEIiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbGliL3ZhbGlkYXRpb24vY29tbW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tIFwibW9uZ29vc2VcIjtcbmltcG9ydCB7IEFwaUVycm9yIH0gZnJvbSBcIkAvbGliL2FwaVwiO1xuXG5leHBvcnQgZnVuY3Rpb24gYXNPYmplY3QoaW5wdXQ6IHVua25vd24pIHtcbiAgaWYgKCFpbnB1dCB8fCB0eXBlb2YgaW5wdXQgIT09IFwib2JqZWN0XCIgfHwgQXJyYXkuaXNBcnJheShpbnB1dCkpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJCb2R5IG11c3QgYmUgYSBKU09OIG9iamVjdFwiLCA0MDApO1xuICB9XG5cbiAgcmV0dXJuIGlucHV0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNTdHJpbmcodmFsdWU6IHVua25vd24sIGZpZWxkOiBzdHJpbmcsIHsgbWluID0gMSwgbWF4ID0gNTAwMCB9ID0ge30pIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihgJHtmaWVsZH0gbXVzdCBiZSBhIHN0cmluZ2AsIDQwMCk7XG4gIH1cblxuICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICBpZiAodHJpbW1lZC5sZW5ndGggPCBtaW4pIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoYCR7ZmllbGR9IGlzIHJlcXVpcmVkYCwgNDAwKTtcbiAgfVxuICBpZiAodHJpbW1lZC5sZW5ndGggPiBtYXgpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoYCR7ZmllbGR9IGlzIHRvbyBsb25nYCwgNDAwKTtcbiAgfVxuXG4gIHJldHVybiB0cmltbWVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNFbWFpbCh2YWx1ZTogdW5rbm93biwgZmllbGQgPSBcImVtYWlsXCIpIHtcbiAgY29uc3QgZW1haWwgPSBhc1N0cmluZyh2YWx1ZSwgZmllbGQsIHsgbWluOiAzLCBtYXg6IDMyMCB9KS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBpc1ZhbGlkID0gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlbWFpbCk7XG4gIGlmICghaXNWYWxpZCkge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihcIkludmFsaWQgZW1haWwgZm9ybWF0XCIsIDQwMCk7XG4gIH1cblxuICByZXR1cm4gZW1haWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc1Bhc3N3b3JkKHZhbHVlOiB1bmtub3duLCBmaWVsZCA9IFwicGFzc3dvcmRcIikge1xuICBjb25zdCBwYXNzd29yZCA9IGFzU3RyaW5nKHZhbHVlLCBmaWVsZCwgeyBtaW46IDgsIG1heDogMTI4IH0pO1xuICByZXR1cm4gcGFzc3dvcmQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc051bWJlcih2YWx1ZTogdW5rbm93biwgZmllbGQ6IHN0cmluZywgeyBtaW4sIG1heCB9OiB7IG1pbj86IG51bWJlcjsgbWF4PzogbnVtYmVyIH0gPSB7fSkge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm51bWJlclwiIHx8IE51bWJlci5pc05hTih2YWx1ZSkpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoYCR7ZmllbGR9IG11c3QgYmUgYSBudW1iZXJgLCA0MDApO1xuICB9XG5cbiAgaWYgKG1pbiAhPT0gdW5kZWZpbmVkICYmIHZhbHVlIDwgbWluKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKGAke2ZpZWxkfSBtdXN0IGJlID49ICR7bWlufWAsIDQwMCk7XG4gIH1cblxuICBpZiAobWF4ICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgPiBtYXgpIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoYCR7ZmllbGR9IG11c3QgYmUgPD0gJHttYXh9YCwgNDAwKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzT2JqZWN0SWQodmFsdWU6IHVua25vd24sIGZpZWxkOiBzdHJpbmcpIHtcbiAgY29uc3QgaWQgPSBhc1N0cmluZyh2YWx1ZSwgZmllbGQsIHsgbWluOiAxLCBtYXg6IDY0IH0pO1xuICBpZiAoIW1vbmdvb3NlLlR5cGVzLk9iamVjdElkLmlzVmFsaWQoaWQpKSB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKGAke2ZpZWxkfSBtdXN0IGJlIGEgdmFsaWQgT2JqZWN0SWRgLCA0MDApO1xuICB9XG5cbiAgcmV0dXJuIGlkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNFbnVtPFQgZXh0ZW5kcyBzdHJpbmc+KFxuICB2YWx1ZTogdW5rbm93bixcbiAgZmllbGQ6IHN0cmluZyxcbiAgYWxsb3dlZDogcmVhZG9ubHkgVFtdXG4pOiBUIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiB8fCAhYWxsb3dlZC5pbmNsdWRlcyh2YWx1ZSBhcyBUKSkge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihgJHtmaWVsZH0gbXVzdCBiZSBvbmUgb2Y6ICR7YWxsb3dlZC5qb2luKFwiLCBcIil9YCwgNDAwKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZSBhcyBUO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNPcHRpb25hbFN0cmluZyh2YWx1ZTogdW5rbm93biwgZmllbGQ6IHN0cmluZywgbWF4ID0gNTAwMCkge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXR1cm4gYXNTdHJpbmcodmFsdWUsIGZpZWxkLCB7IG1pbjogMSwgbWF4IH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNPcHRpb25hbEVtYWlsKHZhbHVlOiB1bmtub3duLCBmaWVsZCA9IFwiZW1haWxcIikge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXR1cm4gYXNFbWFpbCh2YWx1ZSwgZmllbGQpO1xufVxuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiQXBpRXJyb3IiLCJhc09iamVjdCIsImlucHV0IiwiQXJyYXkiLCJpc0FycmF5IiwiYXNTdHJpbmciLCJ2YWx1ZSIsImZpZWxkIiwibWluIiwibWF4IiwidHJpbW1lZCIsInRyaW0iLCJsZW5ndGgiLCJhc0VtYWlsIiwiZW1haWwiLCJ0b0xvd2VyQ2FzZSIsImlzVmFsaWQiLCJ0ZXN0IiwiYXNQYXNzd29yZCIsInBhc3N3b3JkIiwiYXNOdW1iZXIiLCJOdW1iZXIiLCJpc05hTiIsInVuZGVmaW5lZCIsImFzT2JqZWN0SWQiLCJpZCIsIlR5cGVzIiwiT2JqZWN0SWQiLCJhc0VudW0iLCJhbGxvd2VkIiwiaW5jbHVkZXMiLCJqb2luIiwiYXNPcHRpb25hbFN0cmluZyIsImFzT3B0aW9uYWxFbWFpbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation/common.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation/order.ts":
/*!*************************************!*\
  !*** ./src/lib/validation/order.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseOrderPayload: () => (/* binding */ parseOrderPayload)\n/* harmony export */ });\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/api */ \"(rsc)/./src/lib/api.ts\");\n/* harmony import */ var _lib_validation_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/validation/common */ \"(rsc)/./src/lib/validation/common.ts\");\n\n\nconst SALE_TYPES = [\n    \"direct\",\n    \"preorder\"\n];\nconst PAYMENT_METHODS = [\n    \"stripe\",\n    \"paypal\",\n    \"mobile_money\"\n];\nfunction parseOrderPayload(input) {\n    const body = (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asObject)(input);\n    if (!Array.isArray(body.items) || body.items.length === 0) {\n        throw new _lib_api__WEBPACK_IMPORTED_MODULE_0__.ApiError(\"items must be a non-empty array\", 400);\n    }\n    const items = body.items.map((rawItem, index)=>{\n        const item = (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asObject)(rawItem);\n        return {\n            bookId: (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asObjectId)(item.bookId, `items[${index}].bookId`),\n            quantity: (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asNumber)(item.quantity, `items[${index}].quantity`, {\n                min: 1\n            })\n        };\n    });\n    return {\n        saleType: (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asEnum)(body.saleType, \"saleType\", SALE_TYPES),\n        paymentMethod: body.paymentMethod === undefined ? \"stripe\" : (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asEnum)(body.paymentMethod, \"paymentMethod\", PAYMENT_METHODS),\n        promoCode: (0,_lib_validation_common__WEBPACK_IMPORTED_MODULE_1__.asOptionalString)(body.promoCode, \"promoCode\", 40),\n        items\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ZhbGlkYXRpb24vb3JkZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXFDO0FBQzhEO0FBRW5HLE1BQU1NLGFBQWE7SUFBQztJQUFVO0NBQVc7QUFDekMsTUFBTUMsa0JBQWtCO0lBQUM7SUFBVTtJQUFVO0NBQWU7QUFFckQsU0FBU0Msa0JBQWtCQyxLQUFjO0lBQzlDLE1BQU1DLE9BQU9QLGdFQUFRQSxDQUFDTTtJQUV0QixJQUFJLENBQUNFLE1BQU1DLE9BQU8sQ0FBQ0YsS0FBS0csS0FBSyxLQUFLSCxLQUFLRyxLQUFLLENBQUNDLE1BQU0sS0FBSyxHQUFHO1FBQ3pELE1BQU0sSUFBSWQsOENBQVFBLENBQUMsbUNBQW1DO0lBQ3hEO0lBRUEsTUFBTWEsUUFBUUgsS0FBS0csS0FBSyxDQUFDRSxHQUFHLENBQUMsQ0FBQ0MsU0FBU0M7UUFDckMsTUFBTUMsT0FBT2YsZ0VBQVFBLENBQUNhO1FBRXRCLE9BQU87WUFDTEcsUUFBUWYsa0VBQVVBLENBQUNjLEtBQUtDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRUYsTUFBTSxRQUFRLENBQUM7WUFDeERHLFVBQVVsQixnRUFBUUEsQ0FBQ2dCLEtBQUtFLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRUgsTUFBTSxVQUFVLENBQUMsRUFBRTtnQkFBRUksS0FBSztZQUFFO1FBQ3pFO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xDLFVBQVVyQiw4REFBTUEsQ0FBQ1MsS0FBS1ksUUFBUSxFQUFFLFlBQVloQjtRQUM1Q2lCLGVBQ0ViLEtBQUthLGFBQWEsS0FBS0MsWUFDbkIsV0FDQXZCLDhEQUFNQSxDQUFDUyxLQUFLYSxhQUFhLEVBQUUsaUJBQWlCaEI7UUFDbERrQixXQUFXcEIsd0VBQWdCQSxDQUFDSyxLQUFLZSxTQUFTLEVBQUUsYUFBYTtRQUN6RFo7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL2xpYi92YWxpZGF0aW9uL29yZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwaUVycm9yIH0gZnJvbSBcIkAvbGliL2FwaVwiO1xuaW1wb3J0IHsgYXNFbnVtLCBhc051bWJlciwgYXNPYmplY3QsIGFzT2JqZWN0SWQsIGFzT3B0aW9uYWxTdHJpbmcgfSBmcm9tIFwiQC9saWIvdmFsaWRhdGlvbi9jb21tb25cIjtcblxuY29uc3QgU0FMRV9UWVBFUyA9IFtcImRpcmVjdFwiLCBcInByZW9yZGVyXCJdIGFzIGNvbnN0O1xuY29uc3QgUEFZTUVOVF9NRVRIT0RTID0gW1wic3RyaXBlXCIsIFwicGF5cGFsXCIsIFwibW9iaWxlX21vbmV5XCJdIGFzIGNvbnN0O1xuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VPcmRlclBheWxvYWQoaW5wdXQ6IHVua25vd24pIHtcbiAgY29uc3QgYm9keSA9IGFzT2JqZWN0KGlucHV0KTtcblxuICBpZiAoIUFycmF5LmlzQXJyYXkoYm9keS5pdGVtcykgfHwgYm9keS5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoXCJpdGVtcyBtdXN0IGJlIGEgbm9uLWVtcHR5IGFycmF5XCIsIDQwMCk7XG4gIH1cblxuICBjb25zdCBpdGVtcyA9IGJvZHkuaXRlbXMubWFwKChyYXdJdGVtLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IGl0ZW0gPSBhc09iamVjdChyYXdJdGVtKTtcblxuICAgIHJldHVybiB7XG4gICAgICBib29rSWQ6IGFzT2JqZWN0SWQoaXRlbS5ib29rSWQsIGBpdGVtc1ske2luZGV4fV0uYm9va0lkYCksXG4gICAgICBxdWFudGl0eTogYXNOdW1iZXIoaXRlbS5xdWFudGl0eSwgYGl0ZW1zWyR7aW5kZXh9XS5xdWFudGl0eWAsIHsgbWluOiAxIH0pXG4gICAgfTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBzYWxlVHlwZTogYXNFbnVtKGJvZHkuc2FsZVR5cGUsIFwic2FsZVR5cGVcIiwgU0FMRV9UWVBFUyksXG4gICAgcGF5bWVudE1ldGhvZDpcbiAgICAgIGJvZHkucGF5bWVudE1ldGhvZCA9PT0gdW5kZWZpbmVkXG4gICAgICAgID8gXCJzdHJpcGVcIlxuICAgICAgICA6IGFzRW51bShib2R5LnBheW1lbnRNZXRob2QsIFwicGF5bWVudE1ldGhvZFwiLCBQQVlNRU5UX01FVEhPRFMpLFxuICAgIHByb21vQ29kZTogYXNPcHRpb25hbFN0cmluZyhib2R5LnByb21vQ29kZSwgXCJwcm9tb0NvZGVcIiwgNDApLFxuICAgIGl0ZW1zXG4gIH07XG59XG4iXSwibmFtZXMiOlsiQXBpRXJyb3IiLCJhc0VudW0iLCJhc051bWJlciIsImFzT2JqZWN0IiwiYXNPYmplY3RJZCIsImFzT3B0aW9uYWxTdHJpbmciLCJTQUxFX1RZUEVTIiwiUEFZTUVOVF9NRVRIT0RTIiwicGFyc2VPcmRlclBheWxvYWQiLCJpbnB1dCIsImJvZHkiLCJBcnJheSIsImlzQXJyYXkiLCJpdGVtcyIsImxlbmd0aCIsIm1hcCIsInJhd0l0ZW0iLCJpbmRleCIsIml0ZW0iLCJib29rSWQiLCJxdWFudGl0eSIsIm1pbiIsInNhbGVUeXBlIiwicGF5bWVudE1ldGhvZCIsInVuZGVmaW5lZCIsInByb21vQ29kZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation/order.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/AbandonedCart.ts":
/*!*************************************!*\
  !*** ./src/models/AbandonedCart.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst AbandonedCartItemSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    bookId: {\n        type: String,\n        required: true\n    },\n    slug: {\n        type: String,\n        required: true\n    },\n    title: {\n        type: String,\n        required: true\n    },\n    quantity: {\n        type: Number,\n        required: true,\n        min: 1\n    },\n    unitPrice: {\n        type: Number,\n        required: true,\n        min: 0\n    },\n    saleType: {\n        type: String,\n        enum: [\n            \"direct\",\n            \"preorder\",\n            \"crowdfunding\"\n        ],\n        required: true\n    }\n}, {\n    _id: false\n});\nconst AbandonedCartSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    user: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: \"User\"\n    },\n    email: {\n        type: String,\n        lowercase: true,\n        trim: true\n    },\n    items: {\n        type: [\n            AbandonedCartItemSchema\n        ],\n        default: []\n    },\n    subtotal: {\n        type: Number,\n        required: true,\n        min: 0\n    },\n    status: {\n        type: String,\n        enum: [\n            \"open\",\n            \"recovered\"\n        ],\n        default: \"open\"\n    },\n    recoveredAt: {\n        type: Date\n    }\n}, {\n    timestamps: true\n});\nconst AbandonedCartModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).AbandonedCart || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"AbandonedCart\", AbandonedCartSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AbandonedCartModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL0FiYW5kb25lZENhcnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXVFO0FBb0J2RSxNQUFNRSwwQkFBMEIsSUFBSUQsNENBQU1BLENBQ3hDO0lBQ0VFLFFBQVE7UUFBRUMsTUFBTUM7UUFBUUMsVUFBVTtJQUFLO0lBQ3ZDQyxNQUFNO1FBQUVILE1BQU1DO1FBQVFDLFVBQVU7SUFBSztJQUNyQ0UsT0FBTztRQUFFSixNQUFNQztRQUFRQyxVQUFVO0lBQUs7SUFDdENHLFVBQVU7UUFBRUwsTUFBTU07UUFBUUosVUFBVTtRQUFNSyxLQUFLO0lBQUU7SUFDakRDLFdBQVc7UUFBRVIsTUFBTU07UUFBUUosVUFBVTtRQUFNSyxLQUFLO0lBQUU7SUFDbERFLFVBQVU7UUFBRVQsTUFBTUM7UUFBUVMsTUFBTTtZQUFDO1lBQVU7WUFBWTtTQUFlO1FBQUVSLFVBQVU7SUFBSztBQUN6RixHQUNBO0lBQUVTLEtBQUs7QUFBTTtBQUdmLE1BQU1DLHNCQUFzQixJQUFJZiw0Q0FBTUEsQ0FDcEM7SUFDRWdCLE1BQU07UUFBRWIsTUFBTUgsNENBQU1BLENBQUNpQixLQUFLLENBQUNDLFFBQVE7UUFBRUMsS0FBSztJQUFPO0lBQ2pEQyxPQUFPO1FBQUVqQixNQUFNQztRQUFRaUIsV0FBVztRQUFNQyxNQUFNO0lBQUs7SUFDbkRDLE9BQU87UUFBRXBCLE1BQU07WUFBQ0Y7U0FBd0I7UUFBRXVCLFNBQVMsRUFBRTtJQUFDO0lBQ3REQyxVQUFVO1FBQUV0QixNQUFNTTtRQUFRSixVQUFVO1FBQU1LLEtBQUs7SUFBRTtJQUNqRGdCLFFBQVE7UUFBRXZCLE1BQU1DO1FBQVFTLE1BQU07WUFBQztZQUFRO1NBQVk7UUFBRVcsU0FBUztJQUFPO0lBQ3JFRyxhQUFhO1FBQUV4QixNQUFNeUI7SUFBSztBQUM1QixHQUNBO0lBQUVDLFlBQVk7QUFBSztBQUdyQixNQUFNQyxxQkFDSi9CLHdEQUFlLENBQUNpQyxhQUFhLElBQzdCakMscURBQWMsQ0FBd0IsaUJBQWlCZ0I7QUFFekQsaUVBQWVlLGtCQUFrQkEsRUFBQyIsInNvdXJjZXMiOlsiL2hvbWUvbW91Y2hhcmlmL0RvY3VtZW50cy9JQUktQ09VUlMvUGVyc29uYWxQcm9qZWN0L1Byb2pldFYvTGl2cmVvL3NyYy9tb2RlbHMvQWJhbmRvbmVkQ2FydC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hLCB0eXBlIERvY3VtZW50LCB0eXBlIE1vZGVsIH0gZnJvbSBcIm1vbmdvb3NlXCI7XG5cbmludGVyZmFjZSBBYmFuZG9uZWRDYXJ0SXRlbSB7XG4gIGJvb2tJZDogc3RyaW5nO1xuICBzbHVnOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHF1YW50aXR5OiBudW1iZXI7XG4gIHVuaXRQcmljZTogbnVtYmVyO1xuICBzYWxlVHlwZTogXCJkaXJlY3RcIiB8IFwicHJlb3JkZXJcIiB8IFwiY3Jvd2RmdW5kaW5nXCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWJhbmRvbmVkQ2FydERvY3VtZW50IGV4dGVuZHMgRG9jdW1lbnQge1xuICB1c2VyPzogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQ7XG4gIGVtYWlsPzogc3RyaW5nO1xuICBpdGVtczogQWJhbmRvbmVkQ2FydEl0ZW1bXTtcbiAgc3VidG90YWw6IG51bWJlcjtcbiAgc3RhdHVzOiBcIm9wZW5cIiB8IFwicmVjb3ZlcmVkXCI7XG4gIHJlY292ZXJlZEF0PzogRGF0ZTtcbn1cblxuY29uc3QgQWJhbmRvbmVkQ2FydEl0ZW1TY2hlbWEgPSBuZXcgU2NoZW1hPEFiYW5kb25lZENhcnRJdGVtPihcbiAge1xuICAgIGJvb2tJZDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgc2x1ZzogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgdGl0bGU6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSB9LFxuICAgIHF1YW50aXR5OiB7IHR5cGU6IE51bWJlciwgcmVxdWlyZWQ6IHRydWUsIG1pbjogMSB9LFxuICAgIHVuaXRQcmljZTogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlLCBtaW46IDAgfSxcbiAgICBzYWxlVHlwZTogeyB0eXBlOiBTdHJpbmcsIGVudW06IFtcImRpcmVjdFwiLCBcInByZW9yZGVyXCIsIFwiY3Jvd2RmdW5kaW5nXCJdLCByZXF1aXJlZDogdHJ1ZSB9XG4gIH0sXG4gIHsgX2lkOiBmYWxzZSB9XG4pO1xuXG5jb25zdCBBYmFuZG9uZWRDYXJ0U2NoZW1hID0gbmV3IFNjaGVtYTxBYmFuZG9uZWRDYXJ0RG9jdW1lbnQ+KFxuICB7XG4gICAgdXNlcjogeyB0eXBlOiBTY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogXCJVc2VyXCIgfSxcbiAgICBlbWFpbDogeyB0eXBlOiBTdHJpbmcsIGxvd2VyY2FzZTogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIGl0ZW1zOiB7IHR5cGU6IFtBYmFuZG9uZWRDYXJ0SXRlbVNjaGVtYV0sIGRlZmF1bHQ6IFtdIH0sXG4gICAgc3VidG90YWw6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSwgbWluOiAwIH0sXG4gICAgc3RhdHVzOiB7IHR5cGU6IFN0cmluZywgZW51bTogW1wib3BlblwiLCBcInJlY292ZXJlZFwiXSwgZGVmYXVsdDogXCJvcGVuXCIgfSxcbiAgICByZWNvdmVyZWRBdDogeyB0eXBlOiBEYXRlIH1cbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbmNvbnN0IEFiYW5kb25lZENhcnRNb2RlbDogTW9kZWw8QWJhbmRvbmVkQ2FydERvY3VtZW50PiA9XG4gIG1vbmdvb3NlLm1vZGVscy5BYmFuZG9uZWRDYXJ0IHx8XG4gIG1vbmdvb3NlLm1vZGVsPEFiYW5kb25lZENhcnREb2N1bWVudD4oXCJBYmFuZG9uZWRDYXJ0XCIsIEFiYW5kb25lZENhcnRTY2hlbWEpO1xuXG5leHBvcnQgZGVmYXVsdCBBYmFuZG9uZWRDYXJ0TW9kZWw7XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJTY2hlbWEiLCJBYmFuZG9uZWRDYXJ0SXRlbVNjaGVtYSIsImJvb2tJZCIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInNsdWciLCJ0aXRsZSIsInF1YW50aXR5IiwiTnVtYmVyIiwibWluIiwidW5pdFByaWNlIiwic2FsZVR5cGUiLCJlbnVtIiwiX2lkIiwiQWJhbmRvbmVkQ2FydFNjaGVtYSIsInVzZXIiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiZW1haWwiLCJsb3dlcmNhc2UiLCJ0cmltIiwiaXRlbXMiLCJkZWZhdWx0Iiwic3VidG90YWwiLCJzdGF0dXMiLCJyZWNvdmVyZWRBdCIsIkRhdGUiLCJ0aW1lc3RhbXBzIiwiQWJhbmRvbmVkQ2FydE1vZGVsIiwibW9kZWxzIiwiQWJhbmRvbmVkQ2FydCIsIm1vZGVsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/models/AbandonedCart.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/Book.ts":
/*!****************************!*\
  !*** ./src/models/Book.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst BookSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    title: {\n        type: String,\n        required: true,\n        trim: true\n    },\n    subtitle: {\n        type: String,\n        trim: true\n    },\n    slug: {\n        type: String,\n        required: true,\n        unique: true,\n        lowercase: true\n    },\n    description: {\n        type: String,\n        required: true\n    },\n    price: {\n        type: Number,\n        required: true,\n        min: 0\n    },\n    saleType: {\n        type: String,\n        enum: [\n            \"direct\",\n            \"preorder\",\n            \"crowdfunding\"\n        ],\n        required: true\n    },\n    releaseDate: {\n        type: Date\n    },\n    coverImage: {\n        type: String,\n        required: true\n    },\n    galleryImages: {\n        type: [\n            String\n        ],\n        default: []\n    },\n    isbn: {\n        type: String\n    },\n    pages: {\n        type: Number,\n        min: 1\n    },\n    stock: {\n        type: Number,\n        min: 0\n    },\n    fundingGoal: {\n        type: Number,\n        min: 0\n    },\n    fundingRaised: {\n        type: Number,\n        min: 0,\n        default: 0\n    },\n    excerptUrl: {\n        type: String\n    },\n    authorName: {\n        type: String\n    },\n    tags: {\n        type: [\n            String\n        ],\n        default: []\n    },\n    preorderNotifiedAt: {\n        type: Date\n    },\n    campaignEndNotifiedAt: {\n        type: Date\n    }\n}, {\n    timestamps: true\n});\nconst BookModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).Book || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"Book\", BookSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BookModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL0Jvb2sudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXVFO0FBMEJ2RSxNQUFNRSxhQUFhLElBQUlELDRDQUFNQSxDQUMzQjtJQUNFRSxPQUFPO1FBQUVDLE1BQU1DO1FBQVFDLFVBQVU7UUFBTUMsTUFBTTtJQUFLO0lBQ2xEQyxVQUFVO1FBQUVKLE1BQU1DO1FBQVFFLE1BQU07SUFBSztJQUNyQ0UsTUFBTTtRQUFFTCxNQUFNQztRQUFRQyxVQUFVO1FBQU1JLFFBQVE7UUFBTUMsV0FBVztJQUFLO0lBQ3BFQyxhQUFhO1FBQUVSLE1BQU1DO1FBQVFDLFVBQVU7SUFBSztJQUM1Q08sT0FBTztRQUFFVCxNQUFNVTtRQUFRUixVQUFVO1FBQU1TLEtBQUs7SUFBRTtJQUM5Q0MsVUFBVTtRQUNSWixNQUFNQztRQUNOWSxNQUFNO1lBQUM7WUFBVTtZQUFZO1NBQWU7UUFDNUNYLFVBQVU7SUFDWjtJQUNBWSxhQUFhO1FBQUVkLE1BQU1lO0lBQUs7SUFDMUJDLFlBQVk7UUFBRWhCLE1BQU1DO1FBQVFDLFVBQVU7SUFBSztJQUMzQ2UsZUFBZTtRQUFFakIsTUFBTTtZQUFDQztTQUFPO1FBQUVpQixTQUFTLEVBQUU7SUFBQztJQUM3Q0MsTUFBTTtRQUFFbkIsTUFBTUM7SUFBTztJQUNyQm1CLE9BQU87UUFBRXBCLE1BQU1VO1FBQVFDLEtBQUs7SUFBRTtJQUM5QlUsT0FBTztRQUFFckIsTUFBTVU7UUFBUUMsS0FBSztJQUFFO0lBQzlCVyxhQUFhO1FBQUV0QixNQUFNVTtRQUFRQyxLQUFLO0lBQUU7SUFDcENZLGVBQWU7UUFBRXZCLE1BQU1VO1FBQVFDLEtBQUs7UUFBR08sU0FBUztJQUFFO0lBQ2xETSxZQUFZO1FBQUV4QixNQUFNQztJQUFPO0lBQzNCd0IsWUFBWTtRQUFFekIsTUFBTUM7SUFBTztJQUMzQnlCLE1BQU07UUFBRTFCLE1BQU07WUFBQ0M7U0FBTztRQUFFaUIsU0FBUyxFQUFFO0lBQUM7SUFDcENTLG9CQUFvQjtRQUFFM0IsTUFBTWU7SUFBSztJQUNqQ2EsdUJBQXVCO1FBQUU1QixNQUFNZTtJQUFLO0FBQ3RDLEdBQ0E7SUFBRWMsWUFBWTtBQUFLO0FBR3JCLE1BQU1DLFlBQ0psQyx3REFBZSxDQUFDb0MsSUFBSSxJQUFJcEMscURBQWMsQ0FBZSxRQUFRRTtBQUUvRCxpRUFBZWdDLFNBQVNBLEVBQUMiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbW9kZWxzL0Jvb2sudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSwgdHlwZSBEb2N1bWVudCwgdHlwZSBNb2RlbCB9IGZyb20gXCJtb25nb29zZVwiO1xuXG5leHBvcnQgdHlwZSBTYWxlVHlwZSA9IFwiZGlyZWN0XCIgfCBcInByZW9yZGVyXCIgfCBcImNyb3dkZnVuZGluZ1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJvb2tEb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgdGl0bGU6IHN0cmluZztcbiAgc3VidGl0bGU/OiBzdHJpbmc7XG4gIHNsdWc6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgcHJpY2U6IG51bWJlcjtcbiAgc2FsZVR5cGU6IFNhbGVUeXBlO1xuICByZWxlYXNlRGF0ZT86IERhdGU7XG4gIGNvdmVySW1hZ2U6IHN0cmluZztcbiAgZ2FsbGVyeUltYWdlczogc3RyaW5nW107XG4gIGlzYm4/OiBzdHJpbmc7XG4gIHBhZ2VzPzogbnVtYmVyO1xuICBzdG9jaz86IG51bWJlcjtcbiAgZnVuZGluZ0dvYWw/OiBudW1iZXI7XG4gIGZ1bmRpbmdSYWlzZWQ/OiBudW1iZXI7XG4gIGV4Y2VycHRVcmw/OiBzdHJpbmc7XG4gIGF1dGhvck5hbWU/OiBzdHJpbmc7XG4gIHRhZ3M/OiBzdHJpbmdbXTtcbiAgcHJlb3JkZXJOb3RpZmllZEF0PzogRGF0ZTtcbiAgY2FtcGFpZ25FbmROb3RpZmllZEF0PzogRGF0ZTtcbn1cblxuY29uc3QgQm9va1NjaGVtYSA9IG5ldyBTY2hlbWE8Qm9va0RvY3VtZW50PihcbiAge1xuICAgIHRpdGxlOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUsIHRyaW06IHRydWUgfSxcbiAgICBzdWJ0aXRsZTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBzbHVnOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUsIHVuaXF1ZTogdHJ1ZSwgbG93ZXJjYXNlOiB0cnVlIH0sXG4gICAgZGVzY3JpcHRpb246IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSB9LFxuICAgIHByaWNlOiB7IHR5cGU6IE51bWJlciwgcmVxdWlyZWQ6IHRydWUsIG1pbjogMCB9LFxuICAgIHNhbGVUeXBlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBlbnVtOiBbXCJkaXJlY3RcIiwgXCJwcmVvcmRlclwiLCBcImNyb3dkZnVuZGluZ1wiXSxcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfSxcbiAgICByZWxlYXNlRGF0ZTogeyB0eXBlOiBEYXRlIH0sXG4gICAgY292ZXJJbWFnZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgZ2FsbGVyeUltYWdlczogeyB0eXBlOiBbU3RyaW5nXSwgZGVmYXVsdDogW10gfSxcbiAgICBpc2JuOiB7IHR5cGU6IFN0cmluZyB9LFxuICAgIHBhZ2VzOiB7IHR5cGU6IE51bWJlciwgbWluOiAxIH0sXG4gICAgc3RvY2s6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfSxcbiAgICBmdW5kaW5nR29hbDogeyB0eXBlOiBOdW1iZXIsIG1pbjogMCB9LFxuICAgIGZ1bmRpbmdSYWlzZWQ6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAsIGRlZmF1bHQ6IDAgfSxcbiAgICBleGNlcnB0VXJsOiB7IHR5cGU6IFN0cmluZyB9LFxuICAgIGF1dGhvck5hbWU6IHsgdHlwZTogU3RyaW5nIH0sXG4gICAgdGFnczogeyB0eXBlOiBbU3RyaW5nXSwgZGVmYXVsdDogW10gfSxcbiAgICBwcmVvcmRlck5vdGlmaWVkQXQ6IHsgdHlwZTogRGF0ZSB9LFxuICAgIGNhbXBhaWduRW5kTm90aWZpZWRBdDogeyB0eXBlOiBEYXRlIH1cbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbmNvbnN0IEJvb2tNb2RlbDogTW9kZWw8Qm9va0RvY3VtZW50PiA9XG4gIG1vbmdvb3NlLm1vZGVscy5Cb29rIHx8IG1vbmdvb3NlLm1vZGVsPEJvb2tEb2N1bWVudD4oXCJCb29rXCIsIEJvb2tTY2hlbWEpO1xuXG5leHBvcnQgZGVmYXVsdCBCb29rTW9kZWw7XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJTY2hlbWEiLCJCb29rU2NoZW1hIiwidGl0bGUiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJ0cmltIiwic3VidGl0bGUiLCJzbHVnIiwidW5pcXVlIiwibG93ZXJjYXNlIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsIk51bWJlciIsIm1pbiIsInNhbGVUeXBlIiwiZW51bSIsInJlbGVhc2VEYXRlIiwiRGF0ZSIsImNvdmVySW1hZ2UiLCJnYWxsZXJ5SW1hZ2VzIiwiZGVmYXVsdCIsImlzYm4iLCJwYWdlcyIsInN0b2NrIiwiZnVuZGluZ0dvYWwiLCJmdW5kaW5nUmFpc2VkIiwiZXhjZXJwdFVybCIsImF1dGhvck5hbWUiLCJ0YWdzIiwicHJlb3JkZXJOb3RpZmllZEF0IiwiY2FtcGFpZ25FbmROb3RpZmllZEF0IiwidGltZXN0YW1wcyIsIkJvb2tNb2RlbCIsIm1vZGVscyIsIkJvb2siLCJtb2RlbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/models/Book.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/NewsletterSubscription.ts":
/*!**********************************************!*\
  !*** ./src/models/NewsletterSubscription.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst NewsletterSubscriptionSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    email: {\n        type: String,\n        required: true,\n        unique: true,\n        lowercase: true,\n        trim: true\n    },\n    active: {\n        type: Boolean,\n        default: true\n    },\n    source: {\n        type: String\n    }\n}, {\n    timestamps: true\n});\nconst NewsletterSubscriptionModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).NewsletterSubscription || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"NewsletterSubscription\", NewsletterSubscriptionSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewsletterSubscriptionModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL05ld3NsZXR0ZXJTdWJzY3JpcHRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXVFO0FBUXZFLE1BQU1FLCtCQUErQixJQUFJRCw0Q0FBTUEsQ0FDN0M7SUFDRUUsT0FBTztRQUFFQyxNQUFNQztRQUFRQyxVQUFVO1FBQU1DLFFBQVE7UUFBTUMsV0FBVztRQUFNQyxNQUFNO0lBQUs7SUFDakZDLFFBQVE7UUFBRU4sTUFBTU87UUFBU0MsU0FBUztJQUFLO0lBQ3ZDQyxRQUFRO1FBQUVULE1BQU1DO0lBQU87QUFDekIsR0FDQTtJQUFFUyxZQUFZO0FBQUs7QUFHckIsTUFBTUMsOEJBQ0pmLHdEQUFlLENBQUNpQixzQkFBc0IsSUFDdENqQixxREFBYyxDQUNaLDBCQUNBRTtBQUdKLGlFQUFlYSwyQkFBMkJBLEVBQUMiLCJzb3VyY2VzIjpbIi9ob21lL21vdWNoYXJpZi9Eb2N1bWVudHMvSUFJLUNPVVJTL1BlcnNvbmFsUHJvamVjdC9Qcm9qZXRWL0xpdnJlby9zcmMvbW9kZWxzL05ld3NsZXR0ZXJTdWJzY3JpcHRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSwgdHlwZSBEb2N1bWVudCwgdHlwZSBNb2RlbCB9IGZyb20gXCJtb25nb29zZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5ld3NsZXR0ZXJTdWJzY3JpcHRpb25Eb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgZW1haWw6IHN0cmluZztcbiAgYWN0aXZlOiBib29sZWFuO1xuICBzb3VyY2U/OiBzdHJpbmc7XG59XG5cbmNvbnN0IE5ld3NsZXR0ZXJTdWJzY3JpcHRpb25TY2hlbWEgPSBuZXcgU2NoZW1hPE5ld3NsZXR0ZXJTdWJzY3JpcHRpb25Eb2N1bWVudD4oXG4gIHtcbiAgICBlbWFpbDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlLCB1bmlxdWU6IHRydWUsIGxvd2VyY2FzZTogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIGFjdGl2ZTogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiB0cnVlIH0sXG4gICAgc291cmNlOiB7IHR5cGU6IFN0cmluZyB9XG4gIH0sXG4gIHsgdGltZXN0YW1wczogdHJ1ZSB9XG4pO1xuXG5jb25zdCBOZXdzbGV0dGVyU3Vic2NyaXB0aW9uTW9kZWw6IE1vZGVsPE5ld3NsZXR0ZXJTdWJzY3JpcHRpb25Eb2N1bWVudD4gPVxuICBtb25nb29zZS5tb2RlbHMuTmV3c2xldHRlclN1YnNjcmlwdGlvbiB8fFxuICBtb25nb29zZS5tb2RlbDxOZXdzbGV0dGVyU3Vic2NyaXB0aW9uRG9jdW1lbnQ+KFxuICAgIFwiTmV3c2xldHRlclN1YnNjcmlwdGlvblwiLFxuICAgIE5ld3NsZXR0ZXJTdWJzY3JpcHRpb25TY2hlbWFcbiAgKTtcblxuZXhwb3J0IGRlZmF1bHQgTmV3c2xldHRlclN1YnNjcmlwdGlvbk1vZGVsO1xuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiU2NoZW1hIiwiTmV3c2xldHRlclN1YnNjcmlwdGlvblNjaGVtYSIsImVtYWlsIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidW5pcXVlIiwibG93ZXJjYXNlIiwidHJpbSIsImFjdGl2ZSIsIkJvb2xlYW4iLCJkZWZhdWx0Iiwic291cmNlIiwidGltZXN0YW1wcyIsIk5ld3NsZXR0ZXJTdWJzY3JpcHRpb25Nb2RlbCIsIm1vZGVscyIsIk5ld3NsZXR0ZXJTdWJzY3JpcHRpb24iLCJtb2RlbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/models/NewsletterSubscription.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/Order.ts":
/*!*****************************!*\
  !*** ./src/models/Order.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst OrderItemSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    book: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: \"Book\",\n        required: true\n    },\n    quantity: {\n        type: Number,\n        required: true,\n        min: 1\n    },\n    unitPrice: {\n        type: Number,\n        required: true,\n        min: 0\n    }\n}, {\n    _id: false\n});\nconst OrderSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    user: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: \"User\",\n        required: true\n    },\n    items: {\n        type: [\n            OrderItemSchema\n        ],\n        default: []\n    },\n    total: {\n        type: Number,\n        required: true,\n        min: 0\n    },\n    status: {\n        type: String,\n        enum: [\n            \"pending\",\n            \"paid\",\n            \"cancelled\",\n            \"refunded\"\n        ],\n        default: \"pending\"\n    },\n    saleType: {\n        type: String,\n        enum: [\n            \"direct\",\n            \"preorder\"\n        ],\n        required: true\n    },\n    paymentMethod: {\n        type: String,\n        enum: [\n            \"stripe\",\n            \"paypal\",\n            \"mobile_money\"\n        ],\n        required: true\n    },\n    transactionId: {\n        type: String\n    },\n    paymentReference: {\n        type: String\n    },\n    promoCode: {\n        type: String\n    },\n    invoiceNumber: {\n        type: String,\n        required: true,\n        unique: true\n    },\n    invoicePdfBase64: {\n        type: String\n    },\n    paidAt: {\n        type: Date\n    }\n}, {\n    timestamps: true\n});\nconst OrderModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).Order || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"Order\", OrderSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (OrderModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL09yZGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF1RTtBQXVCdkUsTUFBTUUsa0JBQWtCLElBQUlELDRDQUFNQSxDQUNoQztJQUNFRSxNQUFNO1FBQUVDLE1BQU1ILDRDQUFNQSxDQUFDSSxLQUFLLENBQUNDLFFBQVE7UUFBRUMsS0FBSztRQUFRQyxVQUFVO0lBQUs7SUFDakVDLFVBQVU7UUFBRUwsTUFBTU07UUFBUUYsVUFBVTtRQUFNRyxLQUFLO0lBQUU7SUFDakRDLFdBQVc7UUFBRVIsTUFBTU07UUFBUUYsVUFBVTtRQUFNRyxLQUFLO0lBQUU7QUFDcEQsR0FDQTtJQUFFRSxLQUFLO0FBQU07QUFHZixNQUFNQyxjQUFjLElBQUliLDRDQUFNQSxDQUM1QjtJQUNFYyxNQUFNO1FBQUVYLE1BQU1ILDRDQUFNQSxDQUFDSSxLQUFLLENBQUNDLFFBQVE7UUFBRUMsS0FBSztRQUFRQyxVQUFVO0lBQUs7SUFDakVRLE9BQU87UUFBRVosTUFBTTtZQUFDRjtTQUFnQjtRQUFFZSxTQUFTLEVBQUU7SUFBQztJQUM5Q0MsT0FBTztRQUFFZCxNQUFNTTtRQUFRRixVQUFVO1FBQU1HLEtBQUs7SUFBRTtJQUM5Q1EsUUFBUTtRQUNOZixNQUFNZ0I7UUFDTkMsTUFBTTtZQUFDO1lBQVc7WUFBUTtZQUFhO1NBQVc7UUFDbERKLFNBQVM7SUFDWDtJQUNBSyxVQUFVO1FBQ1JsQixNQUFNZ0I7UUFDTkMsTUFBTTtZQUFDO1lBQVU7U0FBVztRQUM1QmIsVUFBVTtJQUNaO0lBQ0FlLGVBQWU7UUFDYm5CLE1BQU1nQjtRQUNOQyxNQUFNO1lBQUM7WUFBVTtZQUFVO1NBQWU7UUFDMUNiLFVBQVU7SUFDWjtJQUNBZ0IsZUFBZTtRQUFFcEIsTUFBTWdCO0lBQU87SUFDOUJLLGtCQUFrQjtRQUFFckIsTUFBTWdCO0lBQU87SUFDakNNLFdBQVc7UUFBRXRCLE1BQU1nQjtJQUFPO0lBQzFCTyxlQUFlO1FBQUV2QixNQUFNZ0I7UUFBUVosVUFBVTtRQUFNb0IsUUFBUTtJQUFLO0lBQzVEQyxrQkFBa0I7UUFBRXpCLE1BQU1nQjtJQUFPO0lBQ2pDVSxRQUFRO1FBQUUxQixNQUFNMkI7SUFBSztBQUN2QixHQUNBO0lBQUVDLFlBQVk7QUFBSztBQUdyQixNQUFNQyxhQUNKakMsd0RBQWUsQ0FBQ21DLEtBQUssSUFBSW5DLHFEQUFjLENBQWdCLFNBQVNjO0FBRWxFLGlFQUFlbUIsVUFBVUEsRUFBQyIsInNvdXJjZXMiOlsiL2hvbWUvbW91Y2hhcmlmL0RvY3VtZW50cy9JQUktQ09VUlMvUGVyc29uYWxQcm9qZWN0L1Byb2pldFYvTGl2cmVvL3NyYy9tb2RlbHMvT3JkZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSwgdHlwZSBEb2N1bWVudCwgdHlwZSBNb2RlbCB9IGZyb20gXCJtb25nb29zZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9yZGVySXRlbSB7XG4gIGJvb2s6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkO1xuICBxdWFudGl0eTogbnVtYmVyO1xuICB1bml0UHJpY2U6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcmRlckRvY3VtZW50IGV4dGVuZHMgRG9jdW1lbnQge1xuICB1c2VyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZDtcbiAgaXRlbXM6IE9yZGVySXRlbVtdO1xuICB0b3RhbDogbnVtYmVyO1xuICBzdGF0dXM6IFwicGVuZGluZ1wiIHwgXCJwYWlkXCIgfCBcImNhbmNlbGxlZFwiIHwgXCJyZWZ1bmRlZFwiO1xuICBzYWxlVHlwZTogXCJkaXJlY3RcIiB8IFwicHJlb3JkZXJcIjtcbiAgcGF5bWVudE1ldGhvZDogXCJzdHJpcGVcIiB8IFwicGF5cGFsXCIgfCBcIm1vYmlsZV9tb25leVwiO1xuICB0cmFuc2FjdGlvbklkPzogc3RyaW5nO1xuICBwYXltZW50UmVmZXJlbmNlPzogc3RyaW5nO1xuICBwcm9tb0NvZGU/OiBzdHJpbmc7XG4gIGludm9pY2VOdW1iZXI6IHN0cmluZztcbiAgaW52b2ljZVBkZkJhc2U2ND86IHN0cmluZztcbiAgcGFpZEF0PzogRGF0ZTtcbn1cblxuY29uc3QgT3JkZXJJdGVtU2NoZW1hID0gbmV3IFNjaGVtYTxPcmRlckl0ZW0+KFxuICB7XG4gICAgYm9vazogeyB0eXBlOiBTY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogXCJCb29rXCIsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgcXVhbnRpdHk6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSwgbWluOiAxIH0sXG4gICAgdW5pdFByaWNlOiB7IHR5cGU6IE51bWJlciwgcmVxdWlyZWQ6IHRydWUsIG1pbjogMCB9XG4gIH0sXG4gIHsgX2lkOiBmYWxzZSB9XG4pO1xuXG5jb25zdCBPcmRlclNjaGVtYSA9IG5ldyBTY2hlbWE8T3JkZXJEb2N1bWVudD4oXG4gIHtcbiAgICB1c2VyOiB7IHR5cGU6IFNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiBcIlVzZXJcIiwgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICBpdGVtczogeyB0eXBlOiBbT3JkZXJJdGVtU2NoZW1hXSwgZGVmYXVsdDogW10gfSxcbiAgICB0b3RhbDogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlLCBtaW46IDAgfSxcbiAgICBzdGF0dXM6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFtcInBlbmRpbmdcIiwgXCJwYWlkXCIsIFwiY2FuY2VsbGVkXCIsIFwicmVmdW5kZWRcIl0sXG4gICAgICBkZWZhdWx0OiBcInBlbmRpbmdcIlxuICAgIH0sXG4gICAgc2FsZVR5cGU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFtcImRpcmVjdFwiLCBcInByZW9yZGVyXCJdLFxuICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgIHBheW1lbnRNZXRob2Q6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFtcInN0cmlwZVwiLCBcInBheXBhbFwiLCBcIm1vYmlsZV9tb25leVwiXSxcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfSxcbiAgICB0cmFuc2FjdGlvbklkOiB7IHR5cGU6IFN0cmluZyB9LFxuICAgIHBheW1lbnRSZWZlcmVuY2U6IHsgdHlwZTogU3RyaW5nIH0sXG4gICAgcHJvbW9Db2RlOiB7IHR5cGU6IFN0cmluZyB9LFxuICAgIGludm9pY2VOdW1iZXI6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdW5pcXVlOiB0cnVlIH0sXG4gICAgaW52b2ljZVBkZkJhc2U2NDogeyB0eXBlOiBTdHJpbmcgfSxcbiAgICBwYWlkQXQ6IHsgdHlwZTogRGF0ZSB9XG4gIH0sXG4gIHsgdGltZXN0YW1wczogdHJ1ZSB9XG4pO1xuXG5jb25zdCBPcmRlck1vZGVsOiBNb2RlbDxPcmRlckRvY3VtZW50PiA9XG4gIG1vbmdvb3NlLm1vZGVscy5PcmRlciB8fCBtb25nb29zZS5tb2RlbDxPcmRlckRvY3VtZW50PihcIk9yZGVyXCIsIE9yZGVyU2NoZW1hKTtcblxuZXhwb3J0IGRlZmF1bHQgT3JkZXJNb2RlbDtcbiJdLCJuYW1lcyI6WyJtb25nb29zZSIsIlNjaGVtYSIsIk9yZGVySXRlbVNjaGVtYSIsImJvb2siLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwicXVhbnRpdHkiLCJOdW1iZXIiLCJtaW4iLCJ1bml0UHJpY2UiLCJfaWQiLCJPcmRlclNjaGVtYSIsInVzZXIiLCJpdGVtcyIsImRlZmF1bHQiLCJ0b3RhbCIsInN0YXR1cyIsIlN0cmluZyIsImVudW0iLCJzYWxlVHlwZSIsInBheW1lbnRNZXRob2QiLCJ0cmFuc2FjdGlvbklkIiwicGF5bWVudFJlZmVyZW5jZSIsInByb21vQ29kZSIsImludm9pY2VOdW1iZXIiLCJ1bmlxdWUiLCJpbnZvaWNlUGRmQmFzZTY0IiwicGFpZEF0IiwiRGF0ZSIsInRpbWVzdGFtcHMiLCJPcmRlck1vZGVsIiwibW9kZWxzIiwiT3JkZXIiLCJtb2RlbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/models/Order.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/PromoCode.ts":
/*!*********************************!*\
  !*** ./src/models/PromoCode.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst PromoCodeSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    code: {\n        type: String,\n        required: true,\n        unique: true,\n        uppercase: true,\n        trim: true\n    },\n    type: {\n        type: String,\n        enum: [\n            \"percent\",\n            \"fixed\"\n        ],\n        required: true\n    },\n    value: {\n        type: Number,\n        required: true,\n        min: 0\n    },\n    minSubtotal: {\n        type: Number,\n        min: 0,\n        default: 0\n    },\n    maxDiscount: {\n        type: Number,\n        min: 0\n    },\n    usageLimit: {\n        type: Number,\n        min: 1\n    },\n    usedCount: {\n        type: Number,\n        min: 0,\n        default: 0\n    },\n    active: {\n        type: Boolean,\n        default: true\n    },\n    expiresAt: {\n        type: Date\n    }\n}, {\n    timestamps: true\n});\nconst PromoCodeModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).PromoCode || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"PromoCode\", PromoCodeSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PromoCodeModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL1Byb21vQ29kZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBdUU7QUFjdkUsTUFBTUUsa0JBQWtCLElBQUlELDRDQUFNQSxDQUNoQztJQUNFRSxNQUFNO1FBQUVDLE1BQU1DO1FBQVFDLFVBQVU7UUFBTUMsUUFBUTtRQUFNQyxXQUFXO1FBQU1DLE1BQU07SUFBSztJQUNoRkwsTUFBTTtRQUFFQSxNQUFNQztRQUFRSyxNQUFNO1lBQUM7WUFBVztTQUFRO1FBQUVKLFVBQVU7SUFBSztJQUNqRUssT0FBTztRQUFFUCxNQUFNUTtRQUFRTixVQUFVO1FBQU1PLEtBQUs7SUFBRTtJQUM5Q0MsYUFBYTtRQUFFVixNQUFNUTtRQUFRQyxLQUFLO1FBQUdFLFNBQVM7SUFBRTtJQUNoREMsYUFBYTtRQUFFWixNQUFNUTtRQUFRQyxLQUFLO0lBQUU7SUFDcENJLFlBQVk7UUFBRWIsTUFBTVE7UUFBUUMsS0FBSztJQUFFO0lBQ25DSyxXQUFXO1FBQUVkLE1BQU1RO1FBQVFDLEtBQUs7UUFBR0UsU0FBUztJQUFFO0lBQzlDSSxRQUFRO1FBQUVmLE1BQU1nQjtRQUFTTCxTQUFTO0lBQUs7SUFDdkNNLFdBQVc7UUFBRWpCLE1BQU1rQjtJQUFLO0FBQzFCLEdBQ0E7SUFBRUMsWUFBWTtBQUFLO0FBR3JCLE1BQU1DLGlCQUNKeEIsd0RBQWUsQ0FBQzBCLFNBQVMsSUFBSTFCLHFEQUFjLENBQW9CLGFBQWFFO0FBRTlFLGlFQUFlc0IsY0FBY0EsRUFBQyIsInNvdXJjZXMiOlsiL2hvbWUvbW91Y2hhcmlmL0RvY3VtZW50cy9JQUktQ09VUlMvUGVyc29uYWxQcm9qZWN0L1Byb2pldFYvTGl2cmVvL3NyYy9tb2RlbHMvUHJvbW9Db2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSwgeyBTY2hlbWEsIHR5cGUgRG9jdW1lbnQsIHR5cGUgTW9kZWwgfSBmcm9tIFwibW9uZ29vc2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9tb0NvZGVEb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgY29kZTogc3RyaW5nO1xuICB0eXBlOiBcInBlcmNlbnRcIiB8IFwiZml4ZWRcIjtcbiAgdmFsdWU6IG51bWJlcjtcbiAgbWluU3VidG90YWw6IG51bWJlcjtcbiAgbWF4RGlzY291bnQ/OiBudW1iZXI7XG4gIHVzYWdlTGltaXQ/OiBudW1iZXI7XG4gIHVzZWRDb3VudDogbnVtYmVyO1xuICBhY3RpdmU6IGJvb2xlYW47XG4gIGV4cGlyZXNBdD86IERhdGU7XG59XG5cbmNvbnN0IFByb21vQ29kZVNjaGVtYSA9IG5ldyBTY2hlbWE8UHJvbW9Db2RlRG9jdW1lbnQ+KFxuICB7XG4gICAgY29kZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlLCB1bmlxdWU6IHRydWUsIHVwcGVyY2FzZTogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIHR5cGU6IHsgdHlwZTogU3RyaW5nLCBlbnVtOiBbXCJwZXJjZW50XCIsIFwiZml4ZWRcIl0sIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgdmFsdWU6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSwgbWluOiAwIH0sXG4gICAgbWluU3VidG90YWw6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAsIGRlZmF1bHQ6IDAgfSxcbiAgICBtYXhEaXNjb3VudDogeyB0eXBlOiBOdW1iZXIsIG1pbjogMCB9LFxuICAgIHVzYWdlTGltaXQ6IHsgdHlwZTogTnVtYmVyLCBtaW46IDEgfSxcbiAgICB1c2VkQ291bnQ6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAsIGRlZmF1bHQ6IDAgfSxcbiAgICBhY3RpdmU6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogdHJ1ZSB9LFxuICAgIGV4cGlyZXNBdDogeyB0eXBlOiBEYXRlIH1cbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbmNvbnN0IFByb21vQ29kZU1vZGVsOiBNb2RlbDxQcm9tb0NvZGVEb2N1bWVudD4gPVxuICBtb25nb29zZS5tb2RlbHMuUHJvbW9Db2RlIHx8IG1vbmdvb3NlLm1vZGVsPFByb21vQ29kZURvY3VtZW50PihcIlByb21vQ29kZVwiLCBQcm9tb0NvZGVTY2hlbWEpO1xuXG5leHBvcnQgZGVmYXVsdCBQcm9tb0NvZGVNb2RlbDtcbiJdLCJuYW1lcyI6WyJtb25nb29zZSIsIlNjaGVtYSIsIlByb21vQ29kZVNjaGVtYSIsImNvZGUiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJ1bmlxdWUiLCJ1cHBlcmNhc2UiLCJ0cmltIiwiZW51bSIsInZhbHVlIiwiTnVtYmVyIiwibWluIiwibWluU3VidG90YWwiLCJkZWZhdWx0IiwibWF4RGlzY291bnQiLCJ1c2FnZUxpbWl0IiwidXNlZENvdW50IiwiYWN0aXZlIiwiQm9vbGVhbiIsImV4cGlyZXNBdCIsIkRhdGUiLCJ0aW1lc3RhbXBzIiwiUHJvbW9Db2RlTW9kZWwiLCJtb2RlbHMiLCJQcm9tb0NvZGUiLCJtb2RlbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/models/PromoCode.ts\n");

/***/ }),

/***/ "(rsc)/./src/models/User.ts":
/*!****************************!*\
  !*** ./src/models/User.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst UserSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    name: {\n        type: String,\n        required: true,\n        trim: true\n    },\n    email: {\n        type: String,\n        required: true,\n        unique: true,\n        lowercase: true\n    },\n    passwordHash: {\n        type: String,\n        required: true\n    },\n    role: {\n        type: String,\n        enum: [\n            \"client\",\n            \"admin\"\n        ],\n        default: \"client\"\n    },\n    wishlist: [\n        {\n            type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n            ref: \"Book\"\n        }\n    ],\n    rewardPoints: {\n        type: Number,\n        min: 0,\n        default: 0\n    },\n    referredBy: {\n        type: String,\n        trim: true\n    }\n}, {\n    timestamps: true\n});\nconst UserModel = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).User || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"User\", UserSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UserModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbW9kZWxzL1VzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXVFO0FBWXZFLE1BQU1FLGFBQWEsSUFBSUQsNENBQU1BLENBQzNCO0lBQ0VFLE1BQU07UUFBRUMsTUFBTUM7UUFBUUMsVUFBVTtRQUFNQyxNQUFNO0lBQUs7SUFDakRDLE9BQU87UUFBRUosTUFBTUM7UUFBUUMsVUFBVTtRQUFNRyxRQUFRO1FBQU1DLFdBQVc7SUFBSztJQUNyRUMsY0FBYztRQUFFUCxNQUFNQztRQUFRQyxVQUFVO0lBQUs7SUFDN0NNLE1BQU07UUFBRVIsTUFBTUM7UUFBUVEsTUFBTTtZQUFDO1lBQVU7U0FBUTtRQUFFQyxTQUFTO0lBQVM7SUFDbkVDLFVBQVU7UUFBQztZQUFFWCxNQUFNSCw0Q0FBTUEsQ0FBQ2UsS0FBSyxDQUFDQyxRQUFRO1lBQUVDLEtBQUs7UUFBTztLQUFFO0lBQ3hEQyxjQUFjO1FBQUVmLE1BQU1nQjtRQUFRQyxLQUFLO1FBQUdQLFNBQVM7SUFBRTtJQUNqRFEsWUFBWTtRQUFFbEIsTUFBTUM7UUFBUUUsTUFBTTtJQUFLO0FBQ3pDLEdBQ0E7SUFBRWdCLFlBQVk7QUFBSztBQUdyQixNQUFNQyxZQUNKeEIsd0RBQWUsQ0FBQzBCLElBQUksSUFBSTFCLHFEQUFjLENBQWUsUUFBUUU7QUFFL0QsaUVBQWVzQixTQUFTQSxFQUFDIiwic291cmNlcyI6WyIvaG9tZS9tb3VjaGFyaWYvRG9jdW1lbnRzL0lBSS1DT1VSUy9QZXJzb25hbFByb2plY3QvUHJvamV0Vi9MaXZyZW8vc3JjL21vZGVscy9Vc2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSwgeyBTY2hlbWEsIHR5cGUgRG9jdW1lbnQsIHR5cGUgTW9kZWwgfSBmcm9tIFwibW9uZ29vc2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBVc2VyRG9jdW1lbnQgZXh0ZW5kcyBEb2N1bWVudCB7XG4gIG5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmRIYXNoOiBzdHJpbmc7XG4gIHJvbGU6IFwiY2xpZW50XCIgfCBcImFkbWluXCI7XG4gIHdpc2hsaXN0OiBtb25nb29zZS5UeXBlcy5PYmplY3RJZFtdO1xuICByZXdhcmRQb2ludHM6IG51bWJlcjtcbiAgcmVmZXJyZWRCeT86IHN0cmluZztcbn1cblxuY29uc3QgVXNlclNjaGVtYSA9IG5ldyBTY2hlbWE8VXNlckRvY3VtZW50PihcbiAge1xuICAgIG5hbWU6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIGVtYWlsOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUsIHVuaXF1ZTogdHJ1ZSwgbG93ZXJjYXNlOiB0cnVlIH0sXG4gICAgcGFzc3dvcmRIYXNoOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICByb2xlOiB7IHR5cGU6IFN0cmluZywgZW51bTogW1wiY2xpZW50XCIsIFwiYWRtaW5cIl0sIGRlZmF1bHQ6IFwiY2xpZW50XCIgfSxcbiAgICB3aXNobGlzdDogW3sgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6IFwiQm9va1wiIH1dLFxuICAgIHJld2FyZFBvaW50czogeyB0eXBlOiBOdW1iZXIsIG1pbjogMCwgZGVmYXVsdDogMCB9LFxuICAgIHJlZmVycmVkQnk6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH1cbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbmNvbnN0IFVzZXJNb2RlbDogTW9kZWw8VXNlckRvY3VtZW50PiA9XG4gIG1vbmdvb3NlLm1vZGVscy5Vc2VyIHx8IG1vbmdvb3NlLm1vZGVsPFVzZXJEb2N1bWVudD4oXCJVc2VyXCIsIFVzZXJTY2hlbWEpO1xuXG5leHBvcnQgZGVmYXVsdCBVc2VyTW9kZWw7XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJTY2hlbWEiLCJVc2VyU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJlbWFpbCIsInVuaXF1ZSIsImxvd2VyY2FzZSIsInBhc3N3b3JkSGFzaCIsInJvbGUiLCJlbnVtIiwiZGVmYXVsdCIsIndpc2hsaXN0IiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJld2FyZFBvaW50cyIsIk51bWJlciIsIm1pbiIsInJlZmVycmVkQnkiLCJ0aW1lc3RhbXBzIiwiVXNlck1vZGVsIiwibW9kZWxzIiwiVXNlciIsIm1vZGVsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/models/User.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "./work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Forders%2Froute&page=%2Fapi%2Forders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Forders%2Froute.ts&appDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmoucharif%2FDocuments%2FIAI-COURS%2FPersonalProject%2FProjetV%2FLivreo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();