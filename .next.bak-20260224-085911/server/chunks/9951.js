exports.id=9951,exports.ids=[9951],exports.modules={5410:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(56037),e=c.n(d);let f=new d.Schema({book:{type:d.Schema.Types.ObjectId,ref:"Book",required:!0},user:{type:d.Schema.Types.ObjectId,ref:"User",required:!0},rating:{type:Number,required:!0,min:1,max:5},content:{type:String,required:!0},reviewerName:{type:String,trim:!0},reviewerEmail:{type:String,lowercase:!0,trim:!0},status:{type:String,enum:["pending","approved","rejected"],default:"pending"},authorReply:{type:String},reportCount:{type:Number,default:0,min:0},reportedBy:[{type:d.Schema.Types.ObjectId,ref:"User"}]},{timestamps:!0}),g=e().models.Comment||e().model("Comment",f)},7026:(a,b,c)=>{"use strict";c.d(b,{N4:()=>p,fS:()=>n,wA:()=>o});var d=c(56037),e=c.n(d),f=c(77598),g=c(82468),h=c(11790),i=c(53386),j=c(32047),k=c(77812),l=c(67207);async function m(a){let b=await e().startSession();try{b.startTransaction();try{let c=await a(b);return await b.commitTransaction(),c}catch(c){if(await b.abortTransaction(),c instanceof Error&&/Transaction numbers are only allowed on a replica set member or mongos/i.test(c.message))return a(null);throw c}}finally{b.endSession()}}async function n(a){return await (0,h.$)(),m(async b=>{let c=k.A.findById(a.userId,{name:1,email:1});if(b&&c.session(b),!await c)throw new g.hD("User not found",404);let d=[],e=0;for(let c of a.items){let f=i.A.findById(c.bookId);b&&f.session(b);let h=await f;if(!h)throw new g.hD("Book not found",404);if(h.saleType!==a.saleType)throw new g.hD("Book sale type mismatch",400);if(("direct"===a.saleType||"preorder"===a.saleType)&&(void 0===h.stock||h.stock<c.quantity))throw new g.hD("Insufficient stock",409);d.push({book:h._id,quantity:c.quantity,unitPrice:h.price}),e+=h.price*c.quantity}let h=function(){let a=new Date,b=a.getUTCFullYear(),c=String(a.getUTCMonth()+1).padStart(2,"0"),d=String(a.getUTCDate()).padStart(2,"0"),e=(0,f.randomBytes)(2).toString("hex").toUpperCase();return`INV-${b}${c}${d}-${e}`}(),l=new j.A({user:a.userId,items:d,total:e,status:"pending",saleType:a.saleType,paymentMethod:a.paymentMethod,promoCode:a.promoCode,invoiceNumber:h,createdAt:new Date});return await l.save(b?{session:b}:void 0),l})}async function o(a){return await (0,h.$)(),m(async b=>{let c=j.A.findById(a.orderId);b&&c.session(b);let d=await c;if(!d)throw new g.hD("Order not found",404);if("paid"===d.status)return d;if("pending"!==d.status)throw new g.hD("Order cannot be paid in its current state",409);let e=k.A.findById(d.user,{name:1,email:1});b&&e.session(b);let h=await e;if(!h)throw new g.hD("User not found",404);let m=[];for(let a of d.items){let c=i.A.findById(a.book);b&&c.session(b);let e=await c;if(!e)throw new g.hD("Book not found",404);if(e.saleType!==d.saleType)throw new g.hD("Book sale type mismatch",400);if(void 0===e.stock||e.stock<a.quantity)throw new g.hD("Insufficient stock",409);e.stock-=a.quantity,await e.save(b?{session:b}:void 0),m.push({book:e._id,quantity:a.quantity,unitPrice:a.unitPrice,title:e.title})}let n=a.transactionId??`txn_${Date.now()}_${(0,f.randomBytes)(4).toString("hex")}`,o=new Date,p=(0,l.f)({invoiceNumber:d.invoiceNumber,orderId:n,customerName:h.name,customerEmail:h.email,saleType:d.saleType,paymentMethod:a.paymentMethod,total:d.total,createdAt:o,items:m});return d.status="paid",d.paymentMethod=a.paymentMethod,d.transactionId=n,d.paymentReference=a.paymentReference,d.paidAt=o,d.invoicePdfBase64=p.toString("base64"),await d.save(b?{session:b}:void 0),await k.A.findByIdAndUpdate(d.user,{$inc:{rewardPoints:Math.max(1,Math.floor(d.total))}},b?{session:b}:{}),d})}async function p(a){await (0,h.$)();let b=await j.A.findById(a.orderId);if(!b)throw new g.hD("Order not found",404);if(b.user.toString()!==a.userId)throw new g.hD("Forbidden",403);if("paid"===b.status)throw new g.hD("Paid order cannot be cancelled",409);if("cancelled"===b.status)return b;if("pending"!==b.status)throw new g.hD("Order cannot be cancelled in its current state",409);return b.status="cancelled",await b.save(),b}},8825:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(56037),e=c.n(d);let f=new d.Schema({book:{type:d.Schema.Types.ObjectId,ref:"Book",required:!0},user:{type:d.Schema.Types.ObjectId,ref:"User"},amount:{type:Number,required:!0,min:1},reward:{type:String},contributorName:{type:String},isPublic:{type:Boolean,default:!0},status:{type:String,enum:["pending","paid","refunded"],default:"pending"}},{timestamps:!0}),g=e().models.Contribution||e().model("Contribution",f)},11790:(a,b,c)=>{"use strict";c.d(b,{$:()=>i});var d=c(56037),e=c.n(d);let f=process.env.MONGODB_URI,g=global,h=g.mongoose??{conn:null,promise:null};async function i(){if(!f)throw Error("Missing MONGODB_URI in environment");return h.conn||(h.promise||(h.promise=e().connect(f,{bufferCommands:!1})),h.conn=await h.promise),h.conn}g.mongoose=h},27611:(a,b,c)=>{"use strict";c.d(b,{BV:()=>v,Ej:()=>z,FZ:()=>B,KU:()=>A,Kl:()=>q,Kv:()=>p,Mp:()=>t,Tk:()=>r,Z7:()=>y,dE:()=>x,eB:()=>u,lm:()=>o,ph:()=>s,pi:()=>w,us:()=>m,v_:()=>n});var d=c(82468),e=c(11790),f=c(53386),g=c(5410),h=c(8825),i=c(32047),j=c(35385),k=c(77812),l=c(7026);async function m(){return await (0,e.$)(),(await k.A.find({},{name:1,email:1,role:1}).sort({_id:-1}).lean()).map(a=>({id:a._id.toString(),name:a.name,email:a.email,role:a.role}))}async function n(a){await (0,e.$)();let b=await k.A.findByIdAndUpdate(a.userId,{role:a.role},{new:!0,projection:{name:1,email:1,role:1}}).lean();if(!b)throw new d.hD("User not found",404);return{id:b._id.toString(),name:b.name,email:b.email,role:b.role}}async function o(){return await (0,e.$)(),(await i.A.find({},{user:1,total:1,status:1,saleType:1,paymentMethod:1,invoiceNumber:1}).sort({_id:-1}).limit(200).lean()).map(a=>({id:a._id.toString(),userId:a.user.toString(),total:a.total,status:a.status,saleType:a.saleType,paymentMethod:a.paymentMethod,invoiceNumber:a.invoiceNumber}))}async function p(a){if(await (0,e.$)(),"paid"===a.status){let b=await (0,l.wA)({orderId:a.orderId,paymentMethod:"mobile_money",transactionId:`admin_${Date.now()}`});return{id:b._id.toString(),userId:b.user.toString(),total:b.total,status:b.status,saleType:b.saleType,paymentMethod:b.paymentMethod,invoiceNumber:b.invoiceNumber}}let b=await i.A.findById(a.orderId,{user:1,total:1,status:1,saleType:1,paymentMethod:1,invoiceNumber:1});if(!b)throw new d.hD("Order not found",404);if(b.status!==a.status){let a=Math.max(1,Math.floor(b.total));"paid"===b.status&&await k.A.findByIdAndUpdate(b.user,{$inc:{rewardPoints:-a}})}b.status=a.status,await b.save();let c=b.toObject();return{id:c._id.toString(),userId:c.user.toString(),total:c.total,status:c.status,saleType:c.saleType,paymentMethod:c.paymentMethod,invoiceNumber:c.invoiceNumber}}async function q(){return await (0,e.$)(),(await g.A.find({},{user:1,book:1,rating:1,content:1,status:1,authorReply:1,reportCount:1,reviewerName:1,reviewerEmail:1}).sort({_id:-1}).limit(200).populate({path:"user",select:"name email"}).populate({path:"book",select:"title slug"}).lean()).map(a=>({userRef:a.user,bookRef:a.book,id:a._id.toString(),userId:"function"==typeof a.user?._id?.toString?a.user._id.toString():"",userName:a.user?.name??"Lecteur",userEmail:a.user?.email??"",bookId:"function"==typeof a.book?._id?.toString?a.book._id.toString():"",bookTitle:a.book?.title??"Ouvrage",bookSlug:a.book?.slug??"",reviewerName:a.reviewerName,reviewerEmail:a.reviewerEmail,rating:a.rating,content:a.content,status:a.status,authorReply:a.authorReply,reportCount:a.reportCount??0})).map(({userRef:a,bookRef:b,...c})=>c)}async function r(a){await (0,e.$)();let b=await g.A.findByIdAndUpdate(a.commentId,{status:a.status},{new:!0,projection:{user:1,book:1,rating:1,content:1,status:1,authorReply:1,reportCount:1,reviewerName:1,reviewerEmail:1}}).populate({path:"user",select:"name email"}).populate({path:"book",select:"title slug"}).lean();if(!b)throw new d.hD("Comment not found",404);return{id:b._id.toString(),userId:"function"==typeof b.user?._id?.toString?b.user._id.toString():"",userName:b.user?.name??"Lecteur",userEmail:b.user?.email??"",bookId:"function"==typeof b.book?._id?.toString?b.book._id.toString():"",bookTitle:b.book?.title??"Ouvrage",bookSlug:b.book?.slug??"",reviewerName:b.reviewerName,reviewerEmail:b.reviewerEmail,rating:b.rating,content:b.content,status:b.status,authorReply:b.authorReply,reportCount:b.reportCount??0}}async function s(){return await (0,e.$)(),(await h.A.find({},{user:1,book:1,amount:1,reward:1,contributorName:1,isPublic:1,status:1}).sort({_id:-1}).limit(200).lean()).map(a=>({id:a._id.toString(),userId:a.user?a.user.toString():null,bookId:a.book.toString(),amount:a.amount,reward:a.reward,contributorName:a.contributorName,isPublic:a.isPublic,status:a.status}))}async function t(a){await (0,e.$)();let b=await h.A.findById(a.contributionId,{user:1,book:1,amount:1,reward:1,contributorName:1,isPublic:1,status:1});if(!b)throw new d.hD("Contribution not found",404);return b.status!==a.status&&("paid"!==b.status&&"paid"===a.status&&(await f.A.findByIdAndUpdate(b.book,{$inc:{fundingRaised:b.amount}}),b.user&&await k.A.findByIdAndUpdate(b.user,{$inc:{rewardPoints:Math.max(1,Math.floor(b.amount))}})),"paid"===b.status&&"paid"!==a.status&&(await f.A.findByIdAndUpdate(b.book,{$inc:{fundingRaised:-b.amount}}),b.user&&await k.A.findByIdAndUpdate(b.user,{$inc:{rewardPoints:-Math.max(1,Math.floor(b.amount))}}))),b.status=a.status,await b.save(),{id:b._id.toString(),userId:b.user?b.user.toString():null,bookId:b.book.toString(),amount:b.amount,reward:b.reward,contributorName:b.contributorName,isPublic:b.isPublic,status:b.status}}async function u(){return await (0,e.$)(),(await f.A.find({},{title:1,slug:1,subtitle:1,description:1,price:1,saleType:1,stock:1,fundingGoal:1,fundingRaised:1,coverImage:1,releaseDate:1,excerptUrl:1}).sort({_id:-1}).lean()).map(a=>({id:a._id.toString(),title:a.title,slug:a.slug,subtitle:a.subtitle,description:a.description,price:a.price,saleType:a.saleType,stock:a.stock,fundingGoal:a.fundingGoal,fundingRaised:a.fundingRaised,coverImage:a.coverImage,releaseDate:a.releaseDate,excerptUrl:a.excerptUrl}))}async function v(a){await (0,e.$)();let b=await f.A.findByIdAndDelete(a).lean();if(!b)throw new d.hD("Book not found",404);return{id:b._id.toString()}}async function w(a){await (0,e.$)();let b=await f.A.findById(a.bookId,{saleType:1,stock:1,fundingGoal:1}).lean();if(!b)throw new d.hD("Book not found",404);let c=a.saleType??b.saleType,g=a.stock??b.stock,h=a.fundingGoal??b.fundingGoal;if(("direct"===c||"preorder"===c)&&null==g)throw new d.hD("stock is required for direct/preorder books",400);if("crowdfunding"===c&&null==h)throw new d.hD("fundingGoal is required for crowdfunding books",400);let i={};void 0!==a.title&&(i.title=a.title),void 0!==a.slug&&(i.slug=a.slug.toLowerCase()),void 0!==a.subtitle&&(i.subtitle=a.subtitle),void 0!==a.description&&(i.description=a.description),void 0!==a.coverImage&&(i.coverImage=a.coverImage),void 0!==a.saleType&&(i.saleType=a.saleType),void 0!==a.releaseDate&&(i.releaseDate=a.releaseDate?new Date(a.releaseDate):null),void 0!==a.excerptUrl&&(i.excerptUrl=a.excerptUrl),void 0!==a.price&&(i.price=a.price),void 0!==a.stock&&(i.stock=a.stock),void 0!==a.fundingGoal&&(i.fundingGoal=a.fundingGoal),void 0!==a.fundingRaised&&(i.fundingRaised=a.fundingRaised);let j=await f.A.findByIdAndUpdate(a.bookId,i,{new:!0,projection:{title:1,slug:1,subtitle:1,description:1,price:1,saleType:1,stock:1,fundingGoal:1,fundingRaised:1,coverImage:1,releaseDate:1,excerptUrl:1}}).lean();if(!j)throw new d.hD("Book not found",404);return{id:j._id.toString(),title:j.title,slug:j.slug,subtitle:j.subtitle,description:j.description,price:j.price,saleType:j.saleType,stock:j.stock,fundingGoal:j.fundingGoal,fundingRaised:j.fundingRaised,coverImage:j.coverImage,releaseDate:j.releaseDate,excerptUrl:j.excerptUrl}}async function x(){await (0,e.$)();let[a,b,c,d,j,l,m,n,o,p]=await Promise.all([k.A.countDocuments({}),f.A.countDocuments({}),i.A.countDocuments({}),h.A.countDocuments({}),g.A.countDocuments({status:"pending"}),i.A.aggregate([{$match:{status:"paid"}},{$group:{_id:null,total:{$sum:"$total"}}}]),h.A.aggregate([{$match:{status:"paid"}},{$group:{_id:null,total:{$sum:"$amount"}}}]),i.A.aggregate([{$match:{status:"paid"}},{$group:{_id:"$saleType",count:{$sum:1},total:{$sum:"$total"}}}]),i.A.aggregate([{$match:{status:"paid"}},{$unwind:"$items"},{$group:{_id:"$items.book",quantitySold:{$sum:"$items.quantity"},revenue:{$sum:{$multiply:["$items.quantity","$items.unitPrice"]}}}},{$sort:{quantitySold:-1}},{$limit:5},{$lookup:{from:"books",localField:"_id",foreignField:"_id",as:"book"}},{$project:{_id:0,bookId:{$toString:"$_id"},title:{$ifNull:[{$arrayElemAt:["$book.title",0]},"Ouvrage supprim\xe9"]},quantitySold:1,revenue:1}}]),h.A.aggregate([{$match:{status:{$in:["pending","paid"]}}},{$group:{_id:"$book",collected:{$sum:"$amount"}}},{$sort:{collected:-1}},{$limit:8},{$lookup:{from:"books",localField:"_id",foreignField:"_id",as:"book"}},{$project:{_id:0,bookId:{$toString:"$_id"},title:{$ifNull:[{$arrayElemAt:["$book.title",0]},"Campagne supprim\xe9e"]},collected:1,goal:{$ifNull:[{$arrayElemAt:["$book.fundingGoal",0]},0]}}}])]),q=["direct","preorder","crowdfunding"].map(a=>{let b=n.find(b=>b._id===a);return{type:a,count:b?.count??0,total:b?.total??0}});return{usersCount:a,booksCount:b,ordersCount:c,contributionsCount:d,pendingCommentsCount:j,paidRevenue:l[0]?.total??0,paidContributions:m[0]?.total??0,salesByType:q,topBooks:o,campaignFunding:p}}async function y(a){let b=process.env.ADMIN_BOOTSTRAP_SECRET;if(!b)throw new d.hD("ADMIN_BOOTSTRAP_SECRET is not configured",500);if(a.secret!==b)throw new d.hD("Invalid bootstrap secret",401);await (0,e.$)();let c=await k.A.findOneAndUpdate({email:a.email.toLowerCase()},{role:"admin"},{new:!0,projection:{name:1,email:1,role:1}}).lean();if(!c)throw new d.hD("User not found",404);return{id:c._id.toString(),name:c.name,email:c.email,role:c.role}}async function z(){return await (0,e.$)(),(await j.A.find({}).sort({_id:-1}).limit(300).lean()).map(a=>({id:a._id.toString(),code:a.code,type:a.type,value:a.value,minSubtotal:a.minSubtotal??0,maxDiscount:a.maxDiscount,usageLimit:a.usageLimit,usedCount:a.usedCount??0,active:a.active,expiresAt:a.expiresAt}))}async function A(a){await (0,e.$)();let b=await j.A.create({code:a.code.toUpperCase(),type:a.type,value:a.value,minSubtotal:a.minSubtotal,maxDiscount:a.maxDiscount,usageLimit:a.usageLimit,expiresAt:a.expiresAt?new Date(a.expiresAt):void 0});return{id:b._id.toString(),code:b.code,type:b.type,value:b.value,minSubtotal:b.minSubtotal??0,maxDiscount:b.maxDiscount,usageLimit:b.usageLimit,usedCount:b.usedCount??0,active:b.active,expiresAt:b.expiresAt}}async function B(a){await (0,e.$)();let b={};void 0!==a.active&&(b.active=a.active);let c=await j.A.findByIdAndUpdate(a.promoId,b,{new:!0}).lean();if(!c)throw new d.hD("Promo not found",404);return{id:c._id.toString(),code:c.code,type:c.type,value:c.value,minSubtotal:c.minSubtotal??0,maxDiscount:c.maxDiscount,usageLimit:c.usageLimit,usedCount:c.usedCount??0,active:c.active,expiresAt:c.expiresAt}}},32047:(a,b,c)=>{"use strict";c.d(b,{A:()=>h});var d=c(56037),e=c.n(d);let f=new d.Schema({book:{type:d.Schema.Types.ObjectId,ref:"Book",required:!0},quantity:{type:Number,required:!0,min:1},unitPrice:{type:Number,required:!0,min:0}},{_id:!1}),g=new d.Schema({user:{type:d.Schema.Types.ObjectId,ref:"User",required:!0},items:{type:[f],default:[]},total:{type:Number,required:!0,min:0},status:{type:String,enum:["pending","paid","cancelled","refunded"],default:"pending"},saleType:{type:String,enum:["direct","preorder"],required:!0},paymentMethod:{type:String,enum:["stripe","paypal","mobile_money"],required:!0},transactionId:{type:String},paymentReference:{type:String},promoCode:{type:String},invoiceNumber:{type:String,required:!0,unique:!0},invoicePdfBase64:{type:String},paidAt:{type:Date}},{timestamps:!0}),h=e().models.Order||e().model("Order",g)},35385:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(56037),e=c.n(d);let f=new d.Schema({code:{type:String,required:!0,unique:!0,uppercase:!0,trim:!0},type:{type:String,enum:["percent","fixed"],required:!0},value:{type:Number,required:!0,min:0},minSubtotal:{type:Number,min:0,default:0},maxDiscount:{type:Number,min:0},usageLimit:{type:Number,min:1},usedCount:{type:Number,min:0,default:0},active:{type:Boolean,default:!0},expiresAt:{type:Date}},{timestamps:!0}),g=e().models.PromoCode||e().model("PromoCode",f)},53386:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(56037),e=c.n(d);let f=new d.Schema({title:{type:String,required:!0,trim:!0},subtitle:{type:String,trim:!0},slug:{type:String,required:!0,unique:!0,lowercase:!0},description:{type:String,required:!0},price:{type:Number,required:!0,min:0},saleType:{type:String,enum:["direct","preorder","crowdfunding"],required:!0},releaseDate:{type:Date},coverImage:{type:String,required:!0},galleryImages:{type:[String],default:[]},isbn:{type:String},pages:{type:Number,min:1},stock:{type:Number,min:0},fundingGoal:{type:Number,min:0},fundingRaised:{type:Number,min:0,default:0},excerptUrl:{type:String},authorName:{type:String},tags:{type:[String],default:[]},preorderNotifiedAt:{type:Date},campaignEndNotifiedAt:{type:Date}},{timestamps:!0}),g=e().models.Book||e().model("Book",f)},67207:(a,b,c)=>{"use strict";function d(a){let b=["SENAME EDITIONâ€™S - FACTURE",`Facture: ${a.invoiceNumber}`,`Commande: ${a.orderId}`,`Date: ${a.createdAt.toISOString()}`,`Client: ${a.customerName} <${a.customerEmail}>`,`Type de vente: ${a.saleType}`,`Methode de paiement: ${a.paymentMethod}`,"---------------------------------------------"];for(let c of a.items){let a=c.title??"Ouvrage",d=c.unitPrice*c.quantity;b.push(`${a} x${c.quantity} @ ${c.unitPrice.toFixed(2)} EUR = ${d.toFixed(2)} EUR`)}return b.push("---------------------------------------------"),b.push(`TOTAL: ${a.total.toFixed(2)} EUR`),b.push("Merci pour votre achat."),function(a){let b=800,c=a.map(a=>{let c=a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)"),d=`BT /F1 12 Tf 50 ${b} Td (${c}) Tj ET`;return b-=18,d}).join("\n"),d=[];d.push("1 0 obj << /Type /Catalog /Pages 2 0 R >> endobj"),d.push("2 0 obj << /Type /Pages /Kids [3 0 R] /Count 1 >> endobj"),d.push("3 0 obj << /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Resources << /Font << /F1 5 0 R >> >> /Contents 4 0 R >> endobj"),d.push(`4 0 obj << /Length ${Buffer.byteLength(c,"utf8")} >> stream
${c}
endstream endobj`),d.push("5 0 obj << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> endobj");let e="%PDF-1.4\n",f=[0];for(let a of d)f.push(Buffer.byteLength(e,"utf8")),e+=`${a}
`;let g=Buffer.byteLength(e,"utf8");e+=`xref
0 ${d.length+1}
0000000000 65535 f 
`;for(let a=1;a<=d.length;a+=1)e+=`${String(f[a]).padStart(10,"0")} 00000 n 
`;return e+=`trailer << /Size ${d.length+1} /Root 1 0 R >>
startxref
${g}
%%EOF`,Buffer.from(e,"utf8")}(b)}c.d(b,{f:()=>d})},77812:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(56037),e=c.n(d);let f=new d.Schema({name:{type:String,required:!0,trim:!0},email:{type:String,required:!0,unique:!0,lowercase:!0},passwordHash:{type:String,required:!0},role:{type:String,enum:["client","admin"],default:"client"},wishlist:[{type:d.Schema.Types.ObjectId,ref:"Book"}],rewardPoints:{type:Number,min:0,default:0},referredBy:{type:String,trim:!0}},{timestamps:!0}),g=e().models.User||e().model("User",f)},78335:()=>{},82468:(a,b,c)=>{"use strict";c.d(b,{Cv:()=>f,Vh:()=>h,hD:()=>e,hS:()=>i});var d=c(10641);class e extends Error{constructor(a,b=400){super(a),this.status=b}}function f(a,b=200){return d.NextResponse.json({data:a},{status:b})}function g(a,b=400){return d.NextResponse.json({error:a},{status:b})}async function h(a){try{return await a.json()}catch{throw new e("Invalid JSON body",400)}}function i(a){return a instanceof e?g(a.message,a.status):(a instanceof Error&&console.error("[API_ERROR]",a),g("Internal server error",500))}},96487:()=>{}};