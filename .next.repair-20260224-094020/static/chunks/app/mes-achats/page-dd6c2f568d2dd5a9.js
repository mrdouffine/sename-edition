(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8959],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},2256:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),n=r(2619),a=r.n(n),l=r(2115),c=r(3596),o=r(9678),i=r(6159);let d={pending:"En attente",paid:"Pay\xe9e",cancelled:"Annul\xe9e",refunded:"Rembours\xe9e"},u={direct:"Achat direct",preorder:"Pr\xe9commande"};function m(){let e=(0,i.N)(),[t,r]=(0,l.useState)(!0),[n,m]=(0,l.useState)(null),[x,p]=(0,l.useState)([]);return((0,l.useEffect)(()=>{!async function(){r(!0),m(null);try{var e,t;let r=await (0,o.v)("/api/me/orders"),s=await r.json();if(!r.ok){401===r.status&&(0,c.Tp)(),m(null!=(e=s.error)?e:"Impossible de charger les achats");return}p(null!=(t=s.data)?t:[])}catch(e){m("Erreur r\xe9seau")}finally{r(!1)}}()},[]),e)?(0,s.jsxs)("main",{className:"mx-auto min-h-screen w-full max-w-5xl px-4 py-10 sm:px-6 sm:py-12",children:[(0,s.jsxs)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-2 sm:mb-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-black sm:text-3xl",children:"Mes achats"}),(0,s.jsx)(a(),{href:"/mon-compte",className:"text-sm font-semibold uppercase tracking-wider hover:text-primary",children:"Retour compte"})]}),t?(0,s.jsx)("p",{className:"text-sm text-[#6b6959]",children:"Chargement..."}):null,n?(0,s.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:n}):null,t||n||0!==x.length?null:(0,s.jsx)("div",{className:"rounded-xl border border-[#e5e5e0] bg-white p-6",children:"Aucun achat pour le moment."}),(0,s.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,s.jsxs)("article",{className:"rounded-xl border border-[#e5e5e0] bg-white p-5",children:[(0,s.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-2 border-b border-[#ece9dc] pb-4",children:[(0,s.jsxs)("p",{className:"text-xs font-bold uppercase tracking-[0.2em] text-[#8d895e]",children:["Commande #",e.id.slice(-6)]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs font-bold uppercase",children:[(0,s.jsx)("span",{className:"rounded-full bg-[#f5f4f0] px-3 py-1",children:u[e.saleType]}),(0,s.jsx)("span",{className:"rounded-full bg-primary/30 px-3 py-1",children:d[e.status]})]})]}),(0,s.jsx)("div",{className:"space-y-3",children:e.items.map((t,r)=>{var n,l,c,o,i;return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(null==(n=t.book)?void 0:n.slug)?(0,s.jsx)(a(),{href:"/ouvrages/".concat(t.book.slug),className:"font-semibold underline decoration-primary",children:null!=(o=null==(l=t.book)?void 0:l.title)?o:"Ouvrage"}):(0,s.jsx)("p",{className:"font-semibold",children:null!=(i=null==(c=t.book)?void 0:c.title)?i:"Ouvrage"}),(0,s.jsxs)("p",{className:"text-[#6b6959]",children:["Quantit\xe9: ",t.quantity," • Prix unitaire: ",t.unitPrice.toFixed(2)," €"]})]}),(0,s.jsxs)("p",{className:"font-bold",children:[(t.unitPrice*t.quantity).toFixed(2)," €"]})]},"".concat(e.id,"-").concat(r))})}),(0,s.jsxs)("div",{className:"mt-4 border-t border-[#ece9dc] pt-4 text-right",children:[(0,s.jsxs)("p",{className:"text-xs text-[#8d895e]",children:["Facture: ",e.invoiceNumber]}),(0,s.jsx)("p",{className:"text-sm text-[#6b6959]",children:"Total"}),(0,s.jsxs)("p",{className:"text-xl font-black",children:[e.total.toFixed(2)," €"]}),(0,s.jsx)("a",{href:"/api/orders/".concat(e.id,"/invoice"),className:"mt-2 inline-block rounded border border-[#d8d7d0] px-3 py-1 text-xs font-bold uppercase tracking-wider",target:"_blank",rel:"noreferrer",children:"T\xe9l\xe9charger facture PDF"})]})]},e.id))})]}):null}},3596:(e,t,r)=>{"use strict";r.d(t,{NR:()=>n,Tp:()=>l,_5:()=>c,c4:()=>a});let s="livreo_auth_token";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if("session"===t){window.sessionStorage.setItem(s,e),window.localStorage.removeItem(s);return}window.localStorage.setItem(s,e),window.sessionStorage.removeItem(s)}function a(){let e=window.sessionStorage.getItem(s);return e||window.localStorage.getItem(s)}function l(){window.localStorage.removeItem(s),window.sessionStorage.removeItem(s)}function c(){let e=a();if(!e)return null;let t=e.split(".");if(3!==t.length||!t[1])return null;try{let e=JSON.parse(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=t+"=".repeat((4-t.length%4)%4);return window.atob(r)}(t[1]));if(e.exp<=Math.floor(Date.now()/1e3))return null;return e}catch(e){return null}}},4835:(e,t,r)=>{"use strict";function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";return!e||!e.startsWith("/")||e.startsWith("//")?t:e}r.d(t,{o:()=>s})},5519:(e,t,r)=>{Promise.resolve().then(r.bind(r,2256))},6159:(e,t,r)=>{"use strict";r.d(t,{N:()=>c});var s=r(2115),n=r(63),a=r(3596),l=r(4835);function c(){let e=(0,n.usePathname)(),t=(0,n.useSearchParams)(),[r,c]=(0,s.useState)(!1),o=t.toString();return(0,s.useEffect)(()=>{if((0,a._5)())return void c(!0);c(!1);let t=null!=e?e:"/",r=(0,l.o)("".concat(t).concat(o?"?".concat(o):""),t);window.location.replace("/connexion?next=".concat(encodeURIComponent(r)))},[r,e,o]),r}},9678:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(3596);async function n(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,s.c4)(),a=new Headers(null!=(t=r.headers)?t:{});return n&&a.set("Authorization","Bearer ".concat(n)),fetch(e,{...r,headers:a})}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=5519)),_N_E=e.O()}]);